var k=Object.defineProperty;var N=(i,e,t)=>e in i?k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(N(i,typeof e!="symbol"?e+"":e,t),t);import{D as m,c as g,a as b,A as v,b as E,d as w,e as c,C as p,E as S,h as M,f as x,g as T}from"./index-7a5698a7.js";import{i as H,k as K,q as j,au as U,av as $,s as q,x as z,u as J,G,F as Q,L as X,I as Y,M as Z,P as _,aB as ee,R as te,y as se,r as ae,J as ie,S as re,z as oe,B as ne,aQ as de,aC as le,t as ce,v as ue,w as he,U as fe,aU as pe,aG as me,aJ as ye,l as be,m as we,aN as ve,aL as Se,aK as Ae,aM as De,j as Ce,ax as ke,az as Ne,aw as ge,ay as Ee,aA as Me,n as xe,at as Te,a8 as Oe,aa as Re,a9 as Fe,aj as Le,K as Ve,a4 as Ie,a5 as We,ae as Pe,ad as Be,W as He,_ as Ke,Y as je,Z as Ue,T as $e,N as qe,an as ze,aq as Je,ah as Ge,ar as Qe,Q as Xe,V as Ye,a1 as Ze,af as _e,a0 as et,$ as tt,ak as st,al as at,as as it,am as rt,ab as ot,a6 as nt,a3 as dt,a2 as lt,ac as ct,ap as ut,ai as ht,ag as ft,ao as pt,a7 as mt,X as yt,o as bt,p as wt,aD as vt,aR as St,H as At,O as Dt,aW as Ct,aI as kt,aP as Nt,aS as gt,aV as Et,aH as Mt,aO as xt,aE as Tt,aT as Ot,aF as Rt}from"./index-7a5698a7.js";function V(i,e){return customElements.define(i.name,class extends(i.baseClass??HTMLElement){constructor(){super();l(this,"api");l(this,"session");l(this,"props");i.observedAttributes===void 0&&(i.observedAttributes=[]),this.props={};for(const s of i.observedAttributes)this.props[s]=new m}static get observedAttributes(){return i.observedAttributes}attributeChangedCallback(s,r,o){r!==o&&this.props[s].update(o)}connectedCallback(){const s=document.createDocumentFragment();this.session=g(),this.api=b(this.session);const r=e(this.props,this.api);for(const o of this.session.attachCalls)o();v.attach(r,s),this.attachShadow({mode:i.shadowRootMode??"open",delegatesFocus:i.shadowRootDelegatesFocus}).appendChild(s)}disconnectedCallback(){this.session.sessionToken.cancel()}}),E(i.name,i.observedAttributes,void 0,(t,s)=>{for(const r in s)r in t.props||(t.props[r]=s[r])})}async function f(i,e={}){if(i==null)return"";if(Array.isArray(i)){const t=[];for(const s of i)t.push(await f(s));return t.join("")}if(i instanceof Promise)return f(await i);if(["number","string","bigint","boolean"].includes(typeof i))return i.toString();if(i instanceof m)return f(i.value);if(i instanceof w)return f(i.value);if(i instanceof c)return f(i.getData());{const t=i;if(!t.isIntrinsic)return f(t.factory(t.props,t.children,b({attachCalls:[],sessionToken:new p,tokens:[]})));if(e.tagBlacklist&&e.tagBlacklist.includes(t.name)||e.tagWhitelist&&!e.tagWhitelist.includes(t.name))return"";let s=" ",r="";t.children&&(r=await f(t.children));for(const o in t.props)e.attributeBlacklist&&e.attributeBlacklist.includes(o)||e.attributeWhitelist&&!e.attributeWhitelist.includes(o)||t.props[o]!=null&&(s+=`${o}="${t.props[o].toString()}" `);return`<${t.name}${s.trimEnd()}>${r}</${t.name}>`}}class O{constructor(e){l(this,"roots");l(this,"onChange");l(this,"sessionToken");this.roots=e.vdom,this.sessionToken=e.sessionToken,this.onChange=new S}*[Symbol.iterator](){for(const e of this.roots)yield*this.iterateVDOM(e,void 0)}*iterateVDOM(e,t){if(e.type==="virtual"){for(const s of e.children)yield*this.iterateVDOM(s,t);return}if(yield{node:e,parent:t},e.children)for(const s of e.children)yield*this.iterateVDOM(s,e)}}function I(i,e){const t=new O({vdom:[],sessionToken:e});let s=new p;e.addCancellable(()=>{s&&s.cancel()});const r={type:"virtual",children:[]};return u(i,s,t.onChange,r),t.roots=r.children,t}function u(i,e,t,s){var r,o;if(i==null)return{tokens:[]};if(Array.isArray(i)){const a={insertAt:-1,insertCount:0,tokens:[]};for(const n of i){const d=u(n,e,t,s);a.tokens.push(...d.tokens)}return a}if(i instanceof Promise){const a={type:"virtual",children:[]};return i.then(n=>{u(n,e,t,a),t.fire({changedNode:s})}),s.children.push(a),{tokens:[]}}if(["number","string","bigint","boolean"].includes(typeof i))return s.children.push({type:"text",text:i.toString()}),{tokens:[]};if(i instanceof m||i instanceof w){const a={type:"virtual",children:[]};i.listen(d=>{a.children=[],n.tokens.forEach(h=>h.cancel()),n=u(d,e,t,a),t.fire({changedNode:s})},e),s.children.push(a);let n=u(i.value,e,t,a);return n}else if(i instanceof c){const a={type:"virtual",children:[]};i.listen(()=>{a.children=[],n.tokens.forEach(d=>d.cancel()),n=u(i.getData(),e,t,a),t.fire({changedNode:s})},e),s.children.push(a);let n=u(i.getData(),e,t,a);return n}else{const a=i;if(!a.isIntrinsic){const d=new p,h={attachCalls:[],sessionToken:d,tokens:[]},D=b(h);e.addCancellable(()=>{d.cancel()}),d.addCancellable(()=>{for(const y of h.tokens)y.cancel()});const C=u(a.factory(a.props,a.children,D),d,t,s);for(const y of h.attachCalls)y();return{tokens:[...C.tokens,d]}}const n={type:"element",tag:a.name,children:[]};return n.attributes=a.props?R(n,a.props,e,t):void 0,s.children.push(n),(r=a.props)!=null&&r.onAttach&&a.props.onAttach(),(o=a.props)!=null&&o.onDetach&&e.addCancellable(()=>{a.props.onDetach()}),a.children&&u(a.children,e,t,n),{tokens:[]}}}function R(i,e,t,s){const r={};for(const o in e){let a;e.hasOwnProperty(o)&&(o==="style"?a=M(e[o],t):o==="class"?a=x(e[o],t):a=e[o],a instanceof m?(a.listen(()=>{r[o]=a.value,s.fire({changedNode:i})},t),r[o]=a.value):a instanceof w?(a.listen(()=>{r[o]=a.value,s.fire({changedNode:i})},t),r[o]=a.value):a instanceof c?(a.listen(()=>{r[o]=a.getData().join(";"),s.fire({changedNode:i})},t),r[o]=a.getData().join(";")):r[o]=a)}return r}class A{constructor(e,t){l(this,"childrenKey");l(this,"roots");l(this,"updateEvent");l(this,"watchCount",0);l(this,"watchToken");this.childrenKey=e,this.roots=c.toArrayDataSource(t),this.updateEvent=new S}watch(e){if(this.watchCount++,e.addCancellable(()=>{this.watchCount--,this.watchCount===0&&(this.watchToken.cancel(),this.watchToken=void 0)}),!this.watchToken){this.watchToken=new p;const t=new Map;this.roots instanceof c&&this.roots.listen(s=>{this.watchHandleChange(s,void 0,t)},this.watchToken);for(const s of this.roots)for(const{node:r}of this.iterateLevelWithMetaData(s,this.roots.length.value))r[this.childrenKey]instanceof c&&(t.set(r,new p),this.watchToken.chain(t.get(r)),r[this.childrenKey].listenAndRepeat(o=>{this.watchHandleChange(o,r,t)},t.get(r)))}}watchHandleChange(e,t,s){var r;switch(e.operation){case"add":let o=0;for(const n of e.items)this.updateEvent.fire({changedNode:n,index:e.index+o++,parentNode:t,operation:"added"}),n[this.childrenKey]instanceof c&&(s.set(n,new p),this.watchToken.chain(s.get(n)),n[this.childrenKey].listenAndRepeat(d=>{this.watchHandleChange(d,n,s)},s.get(n)));break;case"remove":let a=0;for(const n of e.items)(r=s.get(n))==null||r.cancel(),this.updateEvent.fire({changedNode:n,index:e.index+a++,parentNode:t,operation:"deleted"});break;case"merge":throw new Error("Not implemented");case"replace":this.updateEvent.fire({changedNode:e.target,index:e.index,parentNode:t,operation:"deleted"}),this.updateEvent.fire({changedNode:e.items[0],index:e.index,parentNode:t,operation:"added"});break}}listen(e,t){return this.watch(t),this.updateEvent.subscribe(e,t).cancel}listenAndRepeat(e,t){for(const{parent:s,node:r,index:o}of this.iterateLevelWithMetaData(this.roots,0))e({changedNode:r,index:o,parentNode:s,operation:"added"});return this.listen(e,t)}adaptNodeList(e,t,s=new c){const r=new Map;return e.listenAndRepeat(o=>{switch(o.operation){case"add":for(const a of o.items)this.addItem(r,t,a,s);break;case"remove":for(const a of o.items)this.removeItem(s,r,a);break;case"merge":throw new Error("Not implemented");case"replace":this.removeItem(s,r,o.target),this.addItem(r,t,o.items[0],s);break}},t),s}adaptNodeTree(e,t,s,r,o){t=c.toArrayDataSource(t);const a=t.map(s);return e&&(e[r]=a),t.listenAndRepeat(n=>{switch(n.operation){case"add":let d=n.index;for(const h of n.items)this.adaptNodeTree(a.get(d++),h[r],s,r,o);break;case"merge":throw new Error("Not implemented");case"replace":this.adaptNodeTree(a[n.index],n.items[0][r],s,r,o);break}},o),a}map(e,t=this.childrenKey,s){return new A(t,this.adaptNodeTree(void 0,this.roots,e,t,s))}addItem(e,t,s,r){r.push(s),e.set(s,new p),t.chain(e.get(s));const o=c.toArrayDataSource(s[this.childrenKey]);this.adaptNodeList(o,e.get(s),r)}removeItem(e,t,s){t.get(s).cancel(),e.remove(s)}createArrayDataSourceOfNodes(e){return this.adaptNodeList(this.roots,e)}*[Symbol.iterator](){for(const e of this.roots)yield*this.iterateLevel(e)}*iterateWithMetaData(){let e=0;for(const t of this.roots)yield*this.iterateLevelWithMetaData(t,this.roots.length.value,void 0,e)}*iterateLevelWithMetaData(e,t,s,r=0,o=0){yield{node:e,parent:s,index:r,level:o,lastIndex:t};let a=0;for(const n of e[this.childrenKey])yield*this.iterateLevelWithMetaData(n,T(e[this.childrenKey].length),e,a++,o+1)}*iterateLevel(e){yield e;for(const t of e[this.childrenKey])yield*this.iterateLevel(t)}}function W(i,e){return function(t){function s(r,o,a){return a.onAttach(()=>{i==null||i()}),a.onDetach(()=>{e==null||e()}),o}return v.factory(s,null,t)}}export{H as ArrayAurumElement,c as ArrayDataSource,v as Aurum,K as AurumElement,j as AurumRouter,p as CancellationToken,U as DataFlow,$ as DataFlowBoth,m as DataSource,q as DefaultRoute,z as DefaultSwitchCase,w as DuplexDataSource,J as ErrorBoundary,S as EventEmitter,G as FilteredArrayView,Q as FlattenedArrayView,X as LimitedArrayView,Y as MapDataSource,Z as MappedArrayView,_ as ObjectDataSource,ee as OperationType,te as RemoteProtocol,se as ReversedArrayView,ae as Route,ie as SetDataSource,re as SingularAurumElement,oe as SlicedArrayView,ne as SortedArrayView,de as StorageStream,le as Stream,ce as Suspense,ue as Switch,he as SwitchCase,A as TreeDataSource,fe as UniqueArrayView,pe as UrlStorage,O as VDOM,V as Webcomponent,me as animate,W as attachNotifier,ye as aurumClassName,be as aurumElementModelIdentitiy,we as aurumToHTML,f as aurumToString,I as aurumToVDOM,ve as camelCaseToKebabCase,Se as combineAttribute,Ae as combineClass,De as combineStyle,b as createAPI,Ce as createLifeCycle,g as createRenderSession,ke as ddsDebounce,Ne as ddsFilter,ge as ddsMap,Ee as ddsOneWayFlow,Me as ddsUnique,xe as debugMode,Te as dsAccumulate,Oe as dsAwait,Re as dsAwaitLatest,Fe as dsAwaitOrdered,Le as dsBuffer,Ve as dsCriticalSection,Ie as dsCutOff,We as dsCutOffDynamic,Pe as dsDebounce,Be as dsDelay,He as dsDiff,Ke as dsEven,je as dsFilter,Ue as dsFilterAsync,$e as dsFork,qe as dsForkInline,ze as dsHistory,Je as dsLoadBalance,Ge as dsLock,Qe as dsLog,Xe as dsMap,Ye as dsMapAsync,Ze as dsMax,_e as dsMicroDebounce,et as dsMin,tt as dsOdd,st as dsPick,at as dsPipe,it as dsPipeAll,rt as dsPipeUp,ot as dsReduce,nt as dsSemaphore,dt as dsSkip,lt as dsSkipDynamic,ct as dsStringJoin,ut as dsTap,ht as dsThrottle,ft as dsThrottleFrame,pt as dsThroughputMeter,mt as dsUnique,yt as dsUpdateToken,bt as enableDebugMode,wt as getRemoteFunction,T as getValueOf,vt as intervalEmitter,St as localStorageStream,At as processTransform,Dt as processTransformDuplex,Ct as promiseIterator,kt as registerAnimationLoop,Nt as resolveChildren,gt as sessionStorageStream,Et as transformAsyncIterator,Mt as tweenEmitter,xt as unwrapObjectRecursive,Tt as urlHashEmitter,Ot as urlStorageStream,Rt as windowSizeEmitter};
