var V=Object.defineProperty;var D=(r,e,t)=>e in r?V(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>(D(r,typeof e!="symbol"?e+"":e,t),t);import{D as y,c as N,a as S,A as w,b as M,d as v,e as u,C as m,g as C,f as K,E as b,h as g,i as R,j,s as x}from"./index-a2e59c4c.js";import{k as J,m as G,q as Q,at as X,au as Y,t as Z,x as _,G as ee,F as te,L as se,I as ae,M as ie,aA as re,R as ne,y as oe,r as le,J as de,S as ue,z as ce,B as he,aO as fe,aB as pe,u as me,v as ye,w as we,U as be,aS as ve,aG as Ae,aJ as Se,n as Ce,o as Ee,aL as ke,aK as Oe,aM as Ve,l as De,aw as Ne,ay as Me,av as Ke,ax as ge,az as Re,as as je,a7 as xe,a9 as Te,a8 as Fe,ai as Ie,K as Le,a3 as We,a4 as Pe,ad as $e,ac as Be,V as He,Z as Ue,X as ze,Y as qe,Q as Je,N as Ge,am as Qe,ap as Xe,ag as Ye,aq as Ze,P as _e,T as et,a0 as tt,ae as st,$ as at,_ as it,aj as rt,ak as nt,ar as ot,al as lt,aa as dt,a5 as ut,a2 as ct,a1 as ht,ab as ft,ao as pt,ah as mt,af as yt,an as wt,a6 as bt,W as vt,p as At,aC as St,aP as Ct,H as Et,O as kt,aW as Ot,aV as Vt,aU as Dt,aI as Nt,aN as Mt,aX as Kt,aQ as gt,aT as Rt,aH as jt,aE as xt,aD as Tt,aR as Ft,aF as It}from"./index-a2e59c4c.js";function $(r,e){return customElements.define(r.name,class extends(r.baseClass??HTMLElement){constructor(){super();d(this,"api");d(this,"session");d(this,"props");r.observedAttributes===void 0&&(r.observedAttributes=[]),this.props={};for(const s of r.observedAttributes)this.props[s]=new y}static get observedAttributes(){return r.observedAttributes}attributeChangedCallback(s,a,i){a!==i&&this.props[s].update(i)}connectedCallback(){const s=document.createDocumentFragment();this.session=N(),this.api=S(this.session);const a=e(this.props,this.api);for(const i of this.session.attachCalls)i();w.attach(a,s),this.attachShadow({mode:r.shadowRootMode??"open",delegatesFocus:r.shadowRootDelegatesFocus}).appendChild(s)}disconnectedCallback(){this.session.sessionToken.cancel()}}),M(r.name,r.observedAttributes,void 0,(t,s)=>{for(const a in s)a in t.props||(t.props[a]=s[a])})}async function f(r,e={}){if(r==null)return"";if(Array.isArray(r)){const t=[];for(const s of r)t.push(await f(s));return t.join("")}if(r instanceof Promise)return f(await r);if(["number","string","bigint","boolean"].includes(typeof r))return r.toString();if(r instanceof y)return f(r.value);if(r instanceof v)return f(r.value);if(r instanceof u)return f(r.getData());{const t=r;if(!t.isIntrinsic)return f(t.factory(t.props,t.children,S({attachCalls:[],sessionToken:new m,tokens:[]})));if(e.tagBlacklist&&e.tagBlacklist.includes(t.name)||e.tagWhitelist&&!e.tagWhitelist.includes(t.name))return"";let s=" ",a="";t.children&&(a=await f(t.children));for(const i in t.props)e.attributeBlacklist&&e.attributeBlacklist.includes(i)||e.attributeWhitelist&&!e.attributeWhitelist.includes(i)||t.props[i]!=null&&(i==="style"&&typeof t.props[i]=="object"?s=F(s,i,t):i==="class"&&typeof t.props[i]=="object"?s=T(s,i,t):s+=`${i}="${t.props[i].toString()}" `);return`<${t.name}${s.trimEnd()}>${a}</${t.name}>`}}function T(r,e,t){return r+=`${e}="${Object.keys(t.props[e]).filter(s=>C(t.props[e][s])).join(" ")}" `,r}function F(r,e,t){return r+=`${e}="${Object.keys(t.props[e]).map(s=>`${K(s)}:${C(t.props[e][s])}`).join(";")};" `,r}class I{constructor(e){d(this,"roots");d(this,"onChange");d(this,"sessionToken");this.roots=e.vdom,this.sessionToken=e.sessionToken,this.onChange=new b}*[Symbol.iterator](){for(const e of this.roots)yield*this.iterateVDOM(e,void 0)}*iterateVDOM(e,t){if(e.type==="virtual"){for(const s of e.children)yield*this.iterateVDOM(s,t);return}if(yield{node:e,parent:t},e.children)for(const s of e.children)yield*this.iterateVDOM(s,e)}}function B(r,e){const t=new I({vdom:[],sessionToken:e});let s=new m;e.addCancellable(()=>{s&&s.cancel()});const a={type:"virtual",children:[]};return c(r,s,t.onChange,a),t.roots=a.children,t}function c(r,e,t,s){var a,i;if(r==null)return{tokens:[]};if(Array.isArray(r)){const n={insertAt:-1,insertCount:0,tokens:[]};for(const o of r){const l=c(o,e,t,s);n.tokens.push(...l.tokens)}return n}if(r instanceof Promise){const n={type:"virtual",children:[]};return r.then(o=>{c(o,e,t,n),t.fire({changedNode:s})}),s.children.push(n),{tokens:[]}}if(["number","string","bigint","boolean"].includes(typeof r))return s.children.push({type:"text",text:r.toString()}),{tokens:[]};if(r instanceof y||r instanceof v){const n={type:"virtual",children:[]};r.listen(l=>{n.children=[],o.tokens.forEach(h=>h.cancel()),o=c(l,e,t,n),t.fire({changedNode:s})},e),s.children.push(n);let o=c(r.value,e,t,n);return o}else if(r instanceof u){const n={type:"virtual",children:[]};r.listen(()=>{n.children=[],o.tokens.forEach(l=>l.cancel()),o=c(r.getData(),e,t,n),t.fire({changedNode:s})},e),s.children.push(n);let o=c(r.getData(),e,t,n);return o}else{const n=r;if(!n.isIntrinsic){const l=new m,h={attachCalls:[],sessionToken:l,tokens:[]},k=S(h);e.addCancellable(()=>{l.cancel()}),l.addCancellable(()=>{for(const A of h.tokens)A.cancel()});const O=c(n.factory(n.props,n.children,k),l,t,s);for(const A of h.attachCalls)A();return{tokens:[...O.tokens,l]}}const o={type:"element",tag:n.name,children:[]};return o.attributes=n.props?L(o,n.props,e,t):void 0,s.children.push(o),(a=n.props)!=null&&a.onAttach&&n.props.onAttach(),(i=n.props)!=null&&i.onDetach&&e.addCancellable(()=>{n.props.onDetach()}),n.children&&c(n.children,e,t,o),{tokens:[]}}}function L(r,e,t,s){const a={};for(const i in e){let n;e.hasOwnProperty(i)&&(i==="style"?n=g(e[i],t):i==="class"?n=R(e[i],t):n=e[i],n instanceof y?(n.listen(()=>{a[i]=n.value,s.fire({changedNode:r})},t),a[i]=n.value):n instanceof v?(n.listen(()=>{a[i]=n.value,s.fire({changedNode:r})},t),a[i]=n.value):n instanceof u?(n.listen(()=>{a[i]=n.getData().join(";"),s.fire({changedNode:r})},t),a[i]=n.getData().join(";")):a[i]=n)}return a}function H(r){return w.factory(j,{errorFallback:r.errorFallback,suspenseFallback:r.fallback},r.loader().then(e=>w.factory(typeof e=="function"?e:e.default,r.lazyComponentProps)))}class p{constructor(e){d(this,"data");d(this,"updateEvent");d(this,"updateEventOnKey");this.data=e,this.updateEvent=new b,this.updateEventOnKey=new Map}static fromRemoteSource(e,t){const s=new p(void 0);return x(s,e,t),s}static toObjectDataSource(e){return e instanceof p?e:new p(e)}toString(){return this.data.toString()}cancelAll(){this.updateEvent.cancelAll(),this.updateEventOnKey.forEach(e=>e.cancelAll())}pickObject(e,t){if(typeof this.data[e]=="object"){const s=new p(this.data[e]);return s.listen(a=>{a.deleted?delete this.data[e][a.key]:this.get(e)[a.key]=a.newValue},t),this.listenOnKey(e,a=>{typeof a.newValue=="object"?a.newValue!==s.data&&s.merge(a.newValue):s.clear()}),s}else throw new Error("Cannot pick a non object key")}pickArray(e,t){var s;if(Array.isArray(this.data[e])){const a=new u((s=this.data)==null?void 0:s[e]);return a.listen(i=>{this.set(e,i.newState)},t),this.listenOnKey(e,i=>{Array.isArray(i.newValue)?(i.newValue.length!==a.length.value||!a.getData().every((n,o)=>i.newValue[o]===n))&&a.merge(i.newValue):a.clear()}),a}else throw new Error("Cannot pick a non array key")}pick(e,t){var a;const s=new y((a=this.data)==null?void 0:a[e]);return s.listen(()=>{this.set(e,s.value)},t),this.listenOnKey(e,i=>{s.value!==i.newValue&&s.update(i.newValue)},t),s}pickDuplex(e,t){var a;const s=new v((a=this.data)==null?void 0:a[e]);return s.listenUpstream(i=>{this.set(e,i)}),this.listenOnKey(e,i=>{s.value!==i.newValue&&s.updateDownstream(i.newValue)},t),s}hasKey(e){return this.data.hasOwnProperty(e)}applyObjectChange(e){e.deleted&&this.hasKey(e.key)?this.delete(e.key):e.newValue!==this.get(e.key)&&this.set(e.key,e.newValue)}listen(e,t){return this.updateEvent.subscribe(e,t).cancel}map(e){const t=new Map,s=new u;return this.listenAndRepeat(a=>{if(a.deleted&&t.has(a.key)){const i=t.get(a.key);s.remove(i),t.delete(a.key)}else if(t.has(a.key)){const i=e(a.key,a.newValue);s.replace(t.get(a.key),i),t.set(a.key,i)}else if(!t.has(a.key)&&!a.deleted){const i=e(a.key,a.newValue);s.push(i),t.set(a.key,i)}}),s}listenAndRepeat(e,t){const s=this.updateEvent.subscribe(e,t).cancel;for(const a in this.data)e({key:a,newValue:this.data[a],oldValue:void 0,deleted:!1});return s}listenOnKeyAndRepeat(e,t,s){return t({key:e,newValue:this.data[e],oldValue:void 0}),this.listenOnKey(e,t,s)}listenOnKey(e,t,s){return this.updateEventOnKey.has(e)||this.updateEventOnKey.set(e,new b),this.updateEventOnKey.get(e).subscribe(t,s).cancel}keys(){return Object.keys(this.data)}values(){return Object.values(this.data)}get(e){return this.data[e]}delete(e){if(this.hasKey(e)){const t=this.data[e];delete this.data[e],this.updateEvent.fire({oldValue:t,key:e,newValue:void 0,deleted:!0}),this.updateEventOnKey.has(e)&&this.updateEventOnKey.get(e).fire({oldValue:t,key:e,newValue:void 0})}}set(e,t){if(this.data[e]===t)return;const s=this.data[e];this.data[e]=t,this.updateEvent.fire({oldValue:s,key:e,newValue:this.data[e]}),this.updateEventOnKey.has(e)&&this.updateEventOnKey.get(e).fire({oldValue:s,key:e,newValue:this.data[e]})}assign(e){if(e instanceof p)for(const t of e.keys())this.set(t,e.data[t]);else for(const t of Object.keys(e))this.set(t,e[t])}merge(e){const t=new Set(Object.keys(this.data??{}));if(e instanceof p)for(const s of e.keys())t.delete(s),this.set(s,e.data[s]);else for(const s of Object.keys(e))t.delete(s),this.set(s,e[s]);for(const s of t)this.delete(s)}clear(){if(this.data!=null)for(const e in this.data)this.delete(e)}getData(){return this.data}toObject(){return{...this.data}}toDataSource(){const e=new y(this.data);return this.listen(t=>{e.update(this.data)}),e}}class E{constructor(e,t){d(this,"childrenKey");d(this,"roots");d(this,"updateEvent");d(this,"watchCount",0);d(this,"watchToken");this.childrenKey=e,this.roots=u.toArrayDataSource(t),this.updateEvent=new b}watch(e){if(this.watchCount++,e.addCancellable(()=>{this.watchCount--,this.watchCount===0&&(this.watchToken.cancel(),this.watchToken=void 0)}),!this.watchToken){this.watchToken=new m;const t=new Map;this.roots instanceof u&&this.roots.listen(s=>{this.watchHandleChange(s,void 0,t)},this.watchToken);for(const s of this.roots)for(const{node:a}of this.iterateLevelWithMetaData(s,this.roots.length.value))a[this.childrenKey]instanceof u&&(t.set(a,new m),this.watchToken.addCancellable(t.get(a)),a[this.childrenKey].listenAndRepeat(i=>{this.watchHandleChange(i,a,t)},t.get(a)))}}watchHandleChange(e,t,s){var a;switch(e.operation){case"add":let i=0;for(const o of e.items)this.updateEvent.fire({changedNode:o,index:e.index+i++,parentNode:t,operation:"added"}),o[this.childrenKey]instanceof u&&(s.set(o,new m),this.watchToken.addCancellable(s.get(o)),o[this.childrenKey].listenAndRepeat(l=>{this.watchHandleChange(l,o,s)},s.get(o)));break;case"remove":let n=0;for(const o of e.items)(a=s.get(o))==null||a.cancel(),this.updateEvent.fire({changedNode:o,index:e.index+n++,parentNode:t,operation:"deleted"});break;case"merge":throw new Error("Not implemented");case"replace":this.updateEvent.fire({changedNode:e.target,index:e.index,parentNode:t,operation:"deleted"}),this.updateEvent.fire({changedNode:e.items[0],index:e.index,parentNode:t,operation:"added"});break}}listen(e,t){return this.watch(t),this.updateEvent.subscribe(e,t).cancel}listenAndRepeat(e,t){for(const{parent:s,node:a,index:i}of this.iterateLevelWithMetaData(this.roots,0))e({changedNode:a,index:i,parentNode:s,operation:"added"});return this.listen(e,t)}adaptNodeList(e,t,s=new u){const a=new Map;return e.listenAndRepeat(i=>{switch(i.operation){case"add":for(const n of i.items)this.addItem(a,t,n,s);break;case"remove":for(const n of i.items)this.removeItem(s,a,n);break;case"merge":throw new Error("Not implemented");case"replace":this.removeItem(s,a,i.target),this.addItem(a,t,i.items[0],s);break}},t),s}adaptNodeTree(e,t,s,a,i){t=u.toArrayDataSource(t);const n=t.map(s);return e&&(e[a]=n),t.listenAndRepeat(o=>{switch(o.operation){case"add":let l=o.index;for(const h of o.items)this.adaptNodeTree(n.get(l++),h[a],s,a,i);break;case"merge":throw new Error("Not implemented");case"replace":this.adaptNodeTree(n[o.index],o.items[0][a],s,a,i);break}},i),n}map(e,t=this.childrenKey,s){return new E(t,this.adaptNodeTree(void 0,this.roots,e,t,s))}addItem(e,t,s,a){a.push(s),e.set(s,new m),t.addCancellable(e.get(s));const i=u.toArrayDataSource(s[this.childrenKey]);this.adaptNodeList(i,e.get(s),a)}removeItem(e,t,s){t.get(s).cancel(),e.remove(s)}createArrayDataSourceOfNodes(e){return this.adaptNodeList(this.roots,e)}*[Symbol.iterator](){for(const e of this.roots)yield*this.iterateLevel(e)}*iterateWithMetaData(){let e=0;for(const t of this.roots)yield*this.iterateLevelWithMetaData(t,this.roots.length.value,void 0,e)}*iterateLevelWithMetaData(e,t,s,a=0,i=0){yield{node:e,parent:s,index:a,level:i,lastIndex:t};let n=0;for(const o of e[this.childrenKey])yield*this.iterateLevelWithMetaData(o,C(e[this.childrenKey].length),e,n++,i+1)}*iterateLevel(e){yield e;for(const t of e[this.childrenKey])yield*this.iterateLevel(t)}}function U(r,e){return function(t){function s(a,i,n){return n.onAttach(()=>{r==null||r()}),n.onDetach(()=>{e==null||e()}),i}return w.factory(s,null,t)}}export{J as ArrayAurumElement,u as ArrayDataSource,w as Aurum,G as AurumElement,Q as AurumRouter,m as CancellationToken,X as DataFlow,Y as DataFlowBoth,y as DataSource,Z as DefaultRoute,_ as DefaultSwitchCase,v as DuplexDataSource,j as ErrorBoundary,b as EventEmitter,ee as FilteredArrayView,te as FlattenedArrayView,H as Lazy,se as LimitedArrayView,ae as MapDataSource,ie as MappedArrayView,p as ObjectDataSource,re as OperationType,ne as RemoteProtocol,oe as ReversedArrayView,le as Route,de as SetDataSource,ue as SingularAurumElement,ce as SlicedArrayView,he as SortedArrayView,fe as StorageStream,pe as Stream,me as Suspense,ye as Switch,we as SwitchCase,E as TreeDataSource,be as UniqueArrayView,ve as UrlStorage,I as VDOM,$ as Webcomponent,Ae as animate,U as attachNotifier,Se as aurumClassName,Ce as aurumElementModelIdentitiy,Ee as aurumToHTML,f as aurumToString,B as aurumToVDOM,K as camelCaseToKebabCase,ke as combineAttribute,Oe as combineClass,Ve as combineStyle,S as createAPI,De as createLifeCycle,N as createRenderSession,Ne as ddsDebounce,Me as ddsFilter,Ke as ddsMap,ge as ddsOneWayFlow,Re as ddsUnique,je as dsAccumulate,xe as dsAwait,Te as dsAwaitLatest,Fe as dsAwaitOrdered,Ie as dsBuffer,Le as dsCriticalSection,We as dsCutOff,Pe as dsCutOffDynamic,$e as dsDebounce,Be as dsDelay,He as dsDiff,Ue as dsEven,ze as dsFilter,qe as dsFilterAsync,Je as dsFork,Ge as dsForkInline,Qe as dsHistory,Xe as dsLoadBalance,Ye as dsLock,Ze as dsLog,_e as dsMap,et as dsMapAsync,tt as dsMax,st as dsMicroDebounce,at as dsMin,it as dsOdd,rt as dsPick,nt as dsPipe,ot as dsPipeAll,lt as dsPipeUp,dt as dsReduce,ut as dsSemaphore,ct as dsSkip,ht as dsSkipDynamic,ft as dsStringJoin,pt as dsTap,mt as dsThrottle,yt as dsThrottleFrame,wt as dsThroughputMeter,bt as dsUnique,vt as dsUpdateToken,At as getRemoteFunction,C as getValueOf,St as intervalEmitter,Ct as localStorageStream,Et as processTransform,kt as processTransformDuplex,Ot as promiseIterator,Vt as readableStreamBinaryIterator,Dt as readableStreamStringIterator,Nt as registerAnimationLoop,Mt as resolveChildren,Kt as sanitizeHTML,gt as sessionStorageStream,Rt as transformAsyncIterator,jt as tweenEmitter,xt as urlHashEmitter,Tt as urlPathEmitter,Ft as urlStorageStream,It as windowSizeEmitter};
