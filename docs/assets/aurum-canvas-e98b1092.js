import{j as T,D as L,C as O,A as J,a7 as Y,Q as V,e as Q,d as q,l as p,E as _}from"./index-f68ef1cc.js";var k;(function(e){e[e.RECTANGLE=0]="RECTANGLE",e[e.ELIPSE=1]="ELIPSE",e[e.LINE=2]="LINE",e[e.TEXT=3]="TEXT",e[e.IMAGE=4]="IMAGE",e[e.GROUP=5]="GROUP",e[e.STATE=6]="STATE",e[e.PATH=7]="PATH",e[e.QUADRATIC_CURVE=8]="QUADRATIC_CURVE",e[e.BEZIER_CURVE=9]="BEZIER_CURVE",e[e.REGULAR_POLYGON=10]="REGULAR_POLYGON"})(k||(k={}));const B=Symbol("state");function Ae(e,t,n){const o=T();n.synchronizeLifeCycle(o);const r=n.prerender(t,o);return{[B]:!0,x:void 0,y:void 0,...e,renderedState:void 0,animations:[],children:r,type:k.STATE}}function U(e){return e instanceof L?e.value:e}const ee=["x","y","opacity","strokeColor","fillColor","path","sides","radius","originX","originY"],te=["x","y","opacity","strokeColor","fillColor","path","lineWidth","originX","originY"],ne=["x","y","opacity","strokeColor","fillColor","rotation","rx","ry","startAngle","endAngle","originX","originY"],ae=["x","y","opacity","strokeColor","fillColor","tx","ty","lineWidth","originX","originY"],ie=["x","y","opacity","strokeColor","fillColor","tx","ty","cx","cy","lineWidth","originX","originY"],re=["x","y","opacity","strokeColor","fillColor","tx","ty","cx","cy","c2x","c2y","lineWidth","originX","originY"],oe=["x","y","realWidth","width","font","fontSize","opacity","strokeColor","fillColor","text","fontWeight","wrapWidth","lineHeight","textBaseline","originX","originY"],le=["x","y","width","height","opacity","strokeColor","fillColor","originX","originY"];function de(e,t,n,o){var D;const r=G(t,ne,n,o),{x:a,y:f,idle:h,fillColor:S,strokeColor:A,opacity:b,rx:g,ry:C,rotation:m,startAngle:E,endAngle:x}=r;t.renderedState=r,(D=t.onPreDraw)==null||D.call(t,t.renderedState),e.globalAlpha=b;const v=new Path2D;return(S||A)&&g>.01&&C>.01&&(E??x!==0)?(v.ellipse(a,f,g,C,m??0,E??0,x??Math.PI*2),t.renderedState.path=v):t.renderedState.path=void 0,Z(t,e,v,S,A),h}function fe(e,t,n,o){var x;const r=G(t,ae,n,o),{x:a,y:f,idle:h,fillColor:S,strokeColor:A,opacity:b,tx:g,ty:C,lineWidth:m}=r;t.renderedState=r,(x=t.onPreDraw)==null||x.call(t,t.renderedState);const E=new Path2D;return e.globalAlpha=b,S||A?(E.moveTo(a,f),E.lineTo(g,C),e.lineWidth=m,t.renderedState.path=E):t.renderedState.path=void 0,Z(t,e,E,S,A),h}function se(e,t,n,o){var D;const r=G(t,ie,n,o),{x:a,y:f,cx:h,cy:S,idle:A,fillColor:b,strokeColor:g,opacity:C,tx:m,ty:E,lineWidth:x}=r;t.renderedState=r,(D=t.onPreDraw)==null||D.call(t,t.renderedState),e.globalAlpha=C;const v=new Path2D;return b||g?(v.moveTo(a,f),v.quadraticCurveTo(h,S,m,E),e.lineWidth=x,t.renderedState.path=v):t.renderedState.path=void 0,Z(t,e,v,b,g),A}function ue(e,t,n,o){var z;const r=G(t,re,n,o),{x:a,y:f,cx:h,cy:S,c2x:A,c2y:b,idle:g,fillColor:C,strokeColor:m,opacity:E,tx:x,ty:v,lineWidth:D}=r;t.renderedState=r,(z=t.onPreDraw)==null||z.call(t,t.renderedState),e.globalAlpha=E;const R=new Path2D;return C||m?(R.moveTo(a,f),R.bezierCurveTo(h,S,A,b,x,v),e.lineWidth=D,t.renderedState.path=R):t.renderedState.path=void 0,Z(t,e,R,C,m),g}function Z(e,t,n,o,r){e.fillColor&&(t.fillStyle=o,t.fill(n)),e.strokeColor&&(t.strokeStyle=r,t.stroke(n)),e.clip&&t.clip(n)}function ce(e,t,n,o){var E;const r=G(t,te,n,o),{x:a,y:f,idle:h,fillColor:S,strokeColor:A,opacity:b,path:g,lineWidth:C}=r;t.renderedState=r,(E=t.onPreDraw)==null||E.call(t,t.renderedState);let m;return e.globalAlpha=b,S||A?(e.lineWidth=C,m=new Path2D(g),t.renderedState.path=m):t.renderedState.path=void 0,t.fillColor&&(e.translate(a,f),e.fillStyle=S,e.fill(m),e.translate(-a,-f)),t.strokeColor&&(e.translate(a,f),e.strokeStyle=A,e.stroke(m),e.translate(-a,-f)),t.clip&&(e.translate(a,f),e.clip(m),e.translate(-a,-f)),h}function ye(e,t,n,o){var E;const r=G(t,ee,n,o),{x:a,y:f,idle:h,fillColor:S,strokeColor:A,opacity:b,sides:g,radius:C}=r;if(t.renderedState=r,(E=t.onPreDraw)==null||E.call(t,t.renderedState),e.globalAlpha=b,r.sides<3)return h;const m=new Path2D;if(S||A){let x=0;for(let v=0;v<g;v++){x+=Math.PI/(g/2);const D=C*Math.cos(x),R=C*Math.sin(x);v===0?m.moveTo(D+C+a,R+C+f):m.lineTo(D+C+a,R+C+f)}t.renderedState.path=m}else t.renderedState.path=void 0;return Z(t,e,m,S,A),h}function he(e,t,n,o){var d,u,s,w;const r=G(t,oe,n,o,!1);let{x:a,y:f,idle:h,fontSize:S=16,textBaseline:A,font:b,fillColor:g,strokeColor:C,opacity:m,text:E,fontWeight:x,width:v,wrapWidth:D,lineHeight:R,originX:z}=r;(d=t.renderedState)!=null&&d.width&&!r.width&&(r.width=t.renderedState.width),(u=t.renderedState)!=null&&u.realWidth&&!r.realWidth&&(r.realWidth=t.renderedState.realWidth),r.lines=(s=t.renderedState)==null?void 0:s.lines,t.renderedState=r,t.renderedState.lines=t.renderedState.lines??[];let i=t.renderedState.lines;if(A&&(e.textBaseline=A),e.font=`${x?x+" ":""}${S}px ${b??"Arial"}`,r.height=S,i.length===0)if(D){t.renderedState.realWidth=0;const l=E.split(" ");let c=l.shift();for(;l.length;){const y=e.measureText(c+" "+l[0]);y.width>t.renderedState.realWidth&&(t.renderedState.realWidth=y.width),y<=D?c+=" "+l.shift():(i.push(c),c=l.shift())}i.push(c)}else v?t.renderedState.realWidth=e.measureText(E).width:t.renderedState.realWidth=t.renderedState.width=e.measureText(E).width,i.push(E);(w=t.onPreDraw)==null||w.call(t,t.renderedState),e.globalAlpha=m,z&&(a-=Math.min(t.renderedState.realWidth,t.renderedState.width)*z);for(let l=0;l<i.length;l++)g&&(e.fillStyle=g,e.fillText(i[l],a,f+(R??16)*l,v)),C&&(e.strokeStyle=C,e.strokeText(i[l],a,f+(R??16)*l,v));return h}function me(e,t,n,o){var m;const r=G(t,le,n,o),{x:a,y:f,width:h,height:S,idle:A,fillColor:b,strokeColor:g,opacity:C}=r;return t.renderedState=r,(m=t.onPreDraw)==null||m.call(t,t.renderedState),C<=0&&!t.clip||(e.globalAlpha=C,b&&(e.fillStyle=b,e.fillRect(a,f,h,S)),g&&(e.strokeStyle=g,e.strokeRect(a,f,h,S)),t.clip&&(e.beginPath(),e.rect(a,f,h,S),e.clip())),A}function G(e,t,n,o,r=!0){var h;const a={idle:!0,x:0,y:0};let f=!0;for(const S of t){const A=U(e[S]),b=(h=e.animationStates)==null?void 0:h.find(g=>g[S]!=null);if(b){let g;b.transitionTime?g=Math.min(1,(Date.now()-e.animationTime)/U(b.transitionTime)):g=1;const C=b[S];a[S]=A+(C-A)*g,g<1&&(f=!1)}else a[S]=A}return a.x+=n,a.y+=o,r&&(a.originX&&a.width&&(a.x-=a.width*a.originX),a.originY&&a.height&&(a.y-=a.height*a.originY)),"tx"in a&&(a.tx+=n),"ty"in a&&(a.ty+=o),"cx"in a&&(a.cx+=n),"cy"in a&&(a.cy+=o),"c2x"in a&&(a.c2x+=n),"c2y"in a&&(a.c2y+=o),a.idle=f,a}function Se(e,t){let n;const o=new Set,r={x:0,y:0};window.addEventListener("keyup",a=>{(a.keyCode===e.features.panning.keyboard.leftKeyCode||a.keyCode===e.features.panning.keyboard.rightKeyCode)&&(r.x=0,o.delete(a.keyCode)),(a.keyCode===e.features.panning.keyboard.upKeyCode||a.keyCode===e.features.panning.keyboard.downKeyCode)&&(r.y=0,o.delete(a.keyCode)),n&&o.size===0&&(n.cancel(),n=void 0)}),window.addEventListener("keydown",a=>{a.keyCode===e.features.panning.keyboard.leftKeyCode&&(r.x=e.features.panning.keyboard.pixelsPerFrame,o.add(a.keyCode)),a.keyCode===e.features.panning.keyboard.downKeyCode&&(r.y=-e.features.panning.keyboard.pixelsPerFrame,o.add(a.keyCode)),a.keyCode===e.features.panning.keyboard.rightKeyCode&&(r.x=-e.features.panning.keyboard.pixelsPerFrame,o.add(a.keyCode)),a.keyCode===e.features.panning.keyboard.upKeyCode&&(r.y=e.features.panning.keyboard.pixelsPerFrame,o.add(a.keyCode)),!n&&o.size>0&&(n=new O,n.animationLoop(()=>{e.translate.update({x:e.translate.value.x+r.x,y:e.translate.value.y+r.y})}))})}function ge(e,t){let n,o,r,a,f=!1;t.addEventListener("mousedown",h=>{n=h.clientX,o=h.clientY,r=e.translate.value.x,a=e.translate.value.y,f=!0}),document.addEventListener("mousemove",h=>{f&&e.translate.update({x:r-(n-h.clientX)/e.scale.value.x,y:a-(o-h.clientY)/e.scale.value.y})}),document.addEventListener("mouseup",h=>{f=!1})}function Ce(e,t){t.addEventListener("wheel",n=>{if(n.deltaY>0){if(e.scale.value.x<e.features.mouseWheelZoom.minZoom)return;e.translate.update({x:e.translate.value.x+n.offsetX*(e.features.mouseWheelZoom.zoomIncrements-1)/e.scale.value.x,y:e.translate.value.y+n.offsetY*(e.features.mouseWheelZoom.zoomIncrements-1)/e.scale.value.y}),e.scale.update({x:e.scale.value.x/e.features.mouseWheelZoom.zoomIncrements,y:e.scale.value.y/e.features.mouseWheelZoom.zoomIncrements})}else{if(e.scale.value.x>e.features.mouseWheelZoom.maxZoom)return;e.scale.update({x:e.scale.value.x*e.features.mouseWheelZoom.zoomIncrements,y:e.scale.value.y*e.features.mouseWheelZoom.zoomIncrements}),e.translate.update({x:e.translate.value.x-n.offsetX*(e.features.mouseWheelZoom.zoomIncrements-1)/e.scale.value.x,y:e.translate.value.y-n.offsetY*(e.features.mouseWheelZoom.zoomIncrements-1)/e.scale.value.y})}})}const K=new WeakMap;function ke(e,t,n){var R,z;const o=T();n.synchronizeLifeCycle(o);const r=n.prerender(t,o);let a;const f=new O;let h=new _,S=new _,A=new _;return J.factory("canvas",{onAttach:i=>{var d,u,s;e.features&&(e.scale||(e.scale=new L({x:1,y:1})),e.translate||(e.translate=new L({x:0,y:0})),e.features.mouseWheelZoom&&Ce(e,i),(d=e.features.panning)!=null&&d.mouse&&ge(e,i),(u=e.features.panning)!=null&&u.keyboard&&Se(e)),e.width instanceof L&&e.width.listen(()=>{m(i)},n.cancellationToken),e.backgroundColor instanceof L&&e.backgroundColor.listen(()=>{m(i)},n.cancellationToken),e.height instanceof L&&e.height.listen(()=>{m(i)},n.cancellationToken),b(i,r,f),E(i,r),e.translate&&e.translate.transform(Y(),n.cancellationToken).listen(w=>{m(i)}),e.scale&&e.scale.transform(Y(),n.cancellationToken).listen(w=>{m(i)}),(s=e.onAttach)==null||s.call(e,i)},onDetach:()=>{var i;f.cancel(),(i=e.onDetach)==null||i.call(e)},style:e.style,class:e.class,width:typeof e.width!="object"?(R=e.width)==null?void 0:R.toString():e.width.transform(V(i=>i.toString())),height:typeof e.height!="object"?(z=e.height)==null?void 0:z.toString():e.height.transform(V(i=>i.toString()))});function b(i,d,u){u.registerDomEvent(i,"mouseleave",s=>{h.fire(s)}),u.registerDomEvent(i,"mousemove",s=>{h.fire(s)}),u.registerDomEvent(i,"mousedown",s=>{A.fire(s)}),u.registerDomEvent(i,"mouseup",s=>{S.fire(s)}),C(i,d,void 0,u)}function g(i,d,u){var l,c,y,P,W,I,M,F,$,H;if(!d.renderedState)return!1;let s=i.offsetX-((l=e.translate)!=null&&l.value.x?((c=e.translate)==null?void 0:c.value.x)*(((P=(y=e.scale)==null?void 0:y.value)==null?void 0:P.x)??1):0),w=i.offsetY-((W=e.translate)!=null&&W.value.y?((I=e.translate)==null?void 0:I.value.y)*(((F=(M=e.scale)==null?void 0:M.value)==null?void 0:F.x)??1):0);if(e.scale&&(s/=e.scale.value.x,w/=e.scale.value.y),d.type===k.TEXT){const X=d,N=U(X.fontSize)??16;if(!X.textBaseline)w+=N;else switch(X.textBaseline){case"bottom":w+=N;break;case"middle":w+=N/2;break;case"alphabetic":w+=N;break}}switch(d.type){case k.IMAGE:case k.RECTANGLE:case k.TEXT:return s>=d.renderedState.x&&w>=d.renderedState.y&&s<=d.renderedState.x+d.renderedState.width*((($=e.scale)==null?void 0:$.value.x)??1)&&w<=d.renderedState.y+d.renderedState.height*(((H=e.scale)==null?void 0:H.value.y)??1);case k.ELIPSE:case k.REGULAR_POLYGON:return d.renderedState.path?u.isPointInPath(d.renderedState.path,s,w):!1;default:return d.renderedState.path?u.isPointInPath(d.renderedState.path,s-d.renderedState.x,w-d.renderedState.y):!1}}function C(i,d,u,s){for(const l of d){if(l instanceof Q){l.listen(()=>m(i),s);const c=new Map;l.listenAndRepeat(y=>{switch(y.operation){case"add":for(const P of y.items)c.set(P,new O),w(P,l,c.get(P));break;case"remove":for(const P of y.items)c.get(P).cancel(),c.delete(P);break;case"replace":c.get(y.target).cancel(),c.delete(y.target),c.set(y.items[0],new O),w(y.items[0],l,c.get(y.items[0]));break;case"swap":break;case"merge":throw new Error("Operation not supported")}});continue}if(l instanceof L||l instanceof q){l.listen(()=>m(i),s);let c,y;l.listenAndRepeat(P=>{y!==P&&(y=P,c&&c.cancel(),c=new O,w(y,l,c))});continue}if(l[B]){if(!u)throw new Error("Cannot use <State> nodes at root level");u.animations.push(l);continue}if("onMouseEnter"in l||"onMouseLeave"in l){let c=!1;h.subscribe(y=>{g(y,l,i.getContext("2d"))?(!c&&l.onMouseEnter&&l.onMouseEnter(y,l),c=!0):(c&&l.onMouseLeave&&l.onMouseLeave(y,l),c=!1)},s)}for(const c in l){if(c==="onMouseUp"){S.subscribe(y=>{g(y,l,i.getContext("2d"))&&l.onMouseUp(y,l)},s);continue}if(c==="onMouseDown"){S.subscribe(y=>{g(y,l,i.getContext("2d"))&&l.onMouseUp(y,l)},s);continue}if(c==="onMouseClick"){S.subscribe(y=>{g(y,l,i.getContext("2d"))&&l.onMouseClick(y,l)},s);continue}if(l[c]instanceof L){let y=l[c].value,P;if(c==="state"){const W=U(l[c]);P=W,l.animationStates=l.animations.filter(I=>I.id===W),l.animationTime=Date.now()}l[c].listen(W=>{y!==W&&(y=W,c==="state"?P!==W&&(P=W,l.animationStates=l.animations.filter(I=>I.id===W),l.animationTime=Date.now(),m(i)):m(i))},s)}}C(i,l.children,l,s)}function w(l,c,y){const P=Array.isArray(l)?l:[l],W=T(),I=[];for(const M of P)M&&(K.has(M)||K.set(M,n.prerender(M,W)),I.push(K.get(M)));C(i,I,c,y),W.onAttach(),y.addCancellable(()=>W.onDetach()),m(i)}}function m(i){a||(a=requestAnimationFrame(()=>{a=void 0,i.isConnected&&E(i,r)}))}function E(i,d){const u=i.getContext("2d");e.backgroundColor===void 0?u.clearRect(0,0,i.width,i.height):(u.fillStyle=U(e.backgroundColor),u.fillRect(0,0,i.width,i.height)),v(u);for(const s of d)D(u,s,0,0);x(u)}function x(i){(e.scale||e.translate)&&i.restore()}function v(i){var d,u;(e.scale||e.translate)&&(i.save(),(d=e.scale)!=null&&d.value&&i.scale(e.scale.value.x,e.scale.value.y),(u=e.translate)!=null&&u.value&&i.translate(e.translate.value.x,e.translate.value.y))}function D(i,d,u,s){if(d==null)return;if(Array.isArray(d)){for(const l of d)D(i,l,u,s);return}if(d[B])return;if(d[p]){if(!K.has(d))throw new Error("illegal state: unrendered aurum element made it into the canvas render phase");d=K.get(d)}if(d instanceof Q){for(const l of d.getData())D(i,l,u,s);return}if(d instanceof L||d instanceof q){D(i,d.value,u,s);return}i.save();let w;switch(d.type){case k.PATH:w=ce(i,d,u,s);break;case k.REGULAR_POLYGON:w=ye(i,d,u,s);break;case k.RECTANGLE:w=me(i,d,u,s);break;case k.TEXT:w=he(i,d,u,s);break;case k.LINE:w=fe(i,d,u,s);break;case k.QUADRATIC_CURVE:w=se(i,d,u,s);break;case k.BEZIER_CURVE:w=ue(i,d,u,s);break;case k.ELIPSE:w=de(i,d,u,s);break;case k.GROUP:w=!0;break}w||m(i.canvas);for(const l of d.children)D(i,l,U(d.x)+u,U(d.y)+s);i.restore()}}function Ee(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach());const r=n.prerender(t,o).filter(a=>!!a);return{...e,opacity:e.opacity??1,renderedState:void 0,children:r,animations:[],type:k.RECTANGLE}}function be(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach());const r=n.prerender(t,o).filter(h=>!!h),a=new L("");e.font instanceof L&&e.font.listen(()=>{f.renderedState&&(f.renderedState.lines=[])},n.cancellationToken),e.fontWeight instanceof L&&e.fontWeight.listen(()=>{f.renderedState&&(f.renderedState.lines=[])},n.cancellationToken),e.fontSize instanceof L&&e.fontSize.listen(()=>{f.renderedState&&(f.renderedState.lines=[])},n.cancellationToken),e.width instanceof L&&e.width.listen(()=>{f.renderedState&&(f.renderedState.lines=[])},n.cancellationToken),e.wrapWidth instanceof L&&e.wrapWidth.listen(()=>{f.renderedState&&(f.renderedState.lines=[])},n.cancellationToken);for(const h of r)h instanceof L&&h.transform(Y(),n.cancellationToken).listen(S=>{f.renderedState&&(f.renderedState.lines=[]),j(a,r)});j(a,r);const f={...e,opacity:e.opacity??1,renderedState:void 0,text:a,children:[],animations:[],type:k.TEXT};return f}function j(e,t){e.update(t.reduce((n,o)=>typeof o=="string"?`${n}${o}`:o.value?`${n}${o.value}`:n,""))}function ve(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach());const r=n.prerender(t,o).filter(a=>!!a);return{...e,opacity:e.opacity??1,lineWidth:e.lineWidth??1,renderedState:void 0,children:r,animations:[],type:k.LINE}}function De(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach());const r=n.prerender(t,o).filter(a=>!!a);return{...e,opacity:e.opacity??1,renderedState:void 0,children:r,animations:[],type:k.ELIPSE}}function xe(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach()),e.x??(e.x=0),e.y??(e.y=0);const r=n.prerender(t,o).filter(a=>!!a);return{...e,renderedState:void 0,children:r,animations:[],type:k.GROUP}}function Pe(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach());const r=n.prerender(t,o).filter(a=>!!a);return{...e,opacity:e.opacity??1,renderedState:void 0,children:r,animations:[],type:k.PATH}}function Le(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach());const r=n.prerender(t,o).filter(a=>!!a);return{...e,opacity:e.opacity??1,renderedState:void 0,children:r,animations:[],type:k.IMAGE}}function We(e,t,n){const o=T();n.synchronizeLifeCycle(o),e.onAttach&&n.onAttach(()=>e.onAttach()),e.onDetach&&n.onDetach(()=>e.onDetach());const r=n.prerender(t,o).filter(a=>!!a);return{...e,opacity:e.opacity??1,renderedState:void 0,children:r,animations:[],type:k.REGULAR_POLYGON}}export{ke as AurumCanvas,De as AurumElipse,xe as AurumGroup,Le as AurumImage,ve as AurumLine,Pe as AurumPath,Ee as AurumRectangle,We as AurumRegularPolygon,be as AurumText,Ae as State,B as stateSymbol};
