"use strict";
(self["webpackChunkaurum_org"] = self["webpackChunkaurum_org"] || []).push([["vendors-node_modules_aurum-canvas_prebuilt_esnext_aurum-canvas_js"],{

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/aurum-canvas.js":
/*!*******************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/aurum-canvas.js ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumCanvas": () => (/* reexport safe */ _components_canvas_js__WEBPACK_IMPORTED_MODULE_0__.AurumCanvas),
/* harmony export */   "AurumElipse": () => (/* reexport safe */ _components_drawables_aurum_elipse_js__WEBPACK_IMPORTED_MODULE_4__.AurumElipse),
/* harmony export */   "AurumGroup": () => (/* reexport safe */ _components_drawables_aurum_group_js__WEBPACK_IMPORTED_MODULE_5__.AurumGroup),
/* harmony export */   "AurumImage": () => (/* reexport safe */ _components_drawables_aurum_image_js__WEBPACK_IMPORTED_MODULE_8__.AurumImage),
/* harmony export */   "AurumLine": () => (/* reexport safe */ _components_drawables_aurum_line_js__WEBPACK_IMPORTED_MODULE_3__.AurumLine),
/* harmony export */   "AurumPath": () => (/* reexport safe */ _components_drawables_aurum_path_js__WEBPACK_IMPORTED_MODULE_6__.AurumPath),
/* harmony export */   "AurumRectangle": () => (/* reexport safe */ _components_drawables_aurum_rectangle_js__WEBPACK_IMPORTED_MODULE_1__.AurumRectangle),
/* harmony export */   "AurumRegularPolygon": () => (/* reexport safe */ _components_drawables_aurum_regular_polygon_js__WEBPACK_IMPORTED_MODULE_9__.AurumRegularPolygon),
/* harmony export */   "AurumText": () => (/* reexport safe */ _components_drawables_aurum_text_js__WEBPACK_IMPORTED_MODULE_2__.AurumText),
/* harmony export */   "State": () => (/* reexport safe */ _components_drawables_state_js__WEBPACK_IMPORTED_MODULE_7__.State),
/* harmony export */   "stateSymbol": () => (/* reexport safe */ _components_drawables_state_js__WEBPACK_IMPORTED_MODULE_7__.stateSymbol)
/* harmony export */ });
/* harmony import */ var _components_canvas_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./components/canvas.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/canvas.js");
/* harmony import */ var _components_drawables_aurum_rectangle_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./components/drawables/aurum_rectangle.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_rectangle.js");
/* harmony import */ var _components_drawables_aurum_text_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/drawables/aurum_text.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_text.js");
/* harmony import */ var _components_drawables_aurum_line_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./components/drawables/aurum_line.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_line.js");
/* harmony import */ var _components_drawables_aurum_elipse_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./components/drawables/aurum_elipse.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_elipse.js");
/* harmony import */ var _components_drawables_aurum_group_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./components/drawables/aurum_group.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_group.js");
/* harmony import */ var _components_drawables_aurum_path_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./components/drawables/aurum_path.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_path.js");
/* harmony import */ var _components_drawables_state_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./components/drawables/state.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/state.js");
/* harmony import */ var _components_drawables_aurum_image_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./components/drawables/aurum_image.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_image.js");
/* harmony import */ var _components_drawables_aurum_regular_polygon_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./components/drawables/aurum_regular_polygon.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_regular_polygon.js");










//# sourceMappingURL=aurum-canvas.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/canvas.js":
/*!************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/canvas.js ***!
  \************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumCanvas": () => (/* binding */ AurumCanvas)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");
/* harmony import */ var _drawables_state_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./drawables/state.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/state.js");
/* harmony import */ var _utilities_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utilities.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/utilities.js");
/* harmony import */ var _rendering_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./rendering.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/rendering.js");
/* harmony import */ var _features_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./features.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/features.js");






const renderCache = new WeakMap();
function AurumCanvas(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    const components = api.prerender(children, lc);
    let pendingRerender;
    const cancellationToken = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.CancellationToken();
    let onMouseMove = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.EventEmitter();
    let onMouseUp = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.EventEmitter();
    let onMouseDown = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.EventEmitter();
    return (aurumjs__WEBPACK_IMPORTED_MODULE_0__.Aurum.factory("canvas", { onAttach: (canvas) => {
            if (props.features) {
                if (!props.scale) {
                    props.scale = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource({ x: 1, y: 1 });
                }
                if (!props.translate) {
                    props.translate = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource({ x: 0, y: 0 });
                }
                if (props.features.mouseWheelZoom) {
                    (0,_features_js__WEBPACK_IMPORTED_MODULE_5__.initializeZoomFeature)(props, canvas);
                }
                if (props.features.panning?.mouse) {
                    (0,_features_js__WEBPACK_IMPORTED_MODULE_5__.initializeMousePanningFeature)(props, canvas);
                }
                if (props.features.panning?.keyboard) {
                    (0,_features_js__WEBPACK_IMPORTED_MODULE_5__.initializeKeyboardPanningFeature)(props, canvas);
                }
            }
            if (props.width instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
                props.width.listen(() => {
                    invalidate(canvas);
                }, api.cancellationToken);
            }
            if (props.backgroundColor instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
                props.backgroundColor.listen(() => {
                    invalidate(canvas);
                }, api.cancellationToken);
            }
            if (props.height instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
                props.height.listen(() => {
                    invalidate(canvas);
                }, api.cancellationToken);
            }
            bindCanvas(canvas, components, cancellationToken);
            render(canvas, components);
            if (props.translate) {
                props.translate.transform((0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.dsUnique)(), api.cancellationToken).listen((v) => {
                    invalidate(canvas);
                });
            }
            if (props.scale) {
                props.scale.transform((0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.dsUnique)(), api.cancellationToken).listen((v) => {
                    invalidate(canvas);
                });
            }
            props.onAttach?.(canvas);
        }, onDetach: () => {
            cancellationToken.cancel();
            props.onDetach?.();
        }, style: props.style, class: props.class, width: typeof props.width !== 'object' ? props.width?.toString() : props.width.transform((0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.dsMap)((v) => v.toString())), height: typeof props.height !== 'object' ? props.height?.toString() : props.height.transform((0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.dsMap)((v) => v.toString())) }));
    function bindCanvas(canvas, components, cancellationToken) {
        cancellationToken.registerDomEvent(canvas, 'mouseleave', (e) => {
            onMouseMove.fire(e);
        });
        cancellationToken.registerDomEvent(canvas, 'mousemove', (e) => {
            onMouseMove.fire(e);
        });
        cancellationToken.registerDomEvent(canvas, 'mousedown', (e) => {
            onMouseDown.fire(e);
        });
        cancellationToken.registerDomEvent(canvas, 'mouseup', (e) => {
            onMouseUp.fire(e);
        });
        bind(canvas, components, undefined, cancellationToken);
    }
    function isOnTopOf(e, target, context) {
        if (!target.renderedState) {
            return false;
        }
        let x = e.offsetX - (props.translate?.value.x ? props.translate?.value.x * (props.scale?.value?.x ?? 1) : 0);
        let y = e.offsetY - (props.translate?.value.y ? props.translate?.value.y * (props.scale?.value?.x ?? 1) : 0);
        if (props.scale) {
            x /= props.scale.value.x;
            y /= props.scale.value.y;
        }
        if (target.type === _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.TEXT) {
            const label = target;
            const size = (0,_utilities_js__WEBPACK_IMPORTED_MODULE_3__.deref)(label.fontSize) ?? 16;
            if (!label.textBaseline) {
                y += size;
            }
            else {
                switch (label.textBaseline) {
                    case 'bottom':
                        y += size;
                        break;
                    case 'middle':
                        y += size / 2;
                        break;
                    case 'alphabetic':
                        y += size;
                        break;
                }
            }
        }
        switch (target.type) {
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.IMAGE:
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.RECTANGLE:
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.TEXT:
                return (x >= target.renderedState.x &&
                    y >= target.renderedState.y &&
                    x <= target.renderedState.x + target.renderedState.width * (props.scale?.value.x ?? 1) &&
                    y <= target.renderedState.y + target.renderedState.height * (props.scale?.value.y ?? 1));
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.ELIPSE:
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.REGULAR_POLYGON:
                if (!target.renderedState.path) {
                    return false;
                }
                else {
                    return context.isPointInPath(target.renderedState.path, x, y);
                }
            default:
                if (!target.renderedState.path) {
                    return false;
                }
                else {
                    return context.isPointInPath(target.renderedState.path, x - target.renderedState.x, y - target.renderedState.y);
                }
        }
    }
    function bind(canvas, children, parent, cancellationToken) {
        for (const child of children) {
            if (child instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.ArrayDataSource) {
                child.listen(() => invalidate(canvas), cancellationToken);
                const tokenMap = new Map();
                child.listenAndRepeat((change) => {
                    switch (change.operation) {
                        case 'add':
                            for (const item of change.items) {
                                tokenMap.set(item, new aurumjs__WEBPACK_IMPORTED_MODULE_0__.CancellationToken());
                                bindDynamicEntity(item, child, tokenMap.get(item));
                            }
                            break;
                        case 'remove':
                            for (const item of change.items) {
                                tokenMap.get(item).cancel();
                                tokenMap.delete(item);
                            }
                            break;
                        case 'replace':
                            tokenMap.get(change.target).cancel();
                            tokenMap.delete(change.target);
                            tokenMap.set(change.items[0], new aurumjs__WEBPACK_IMPORTED_MODULE_0__.CancellationToken());
                            bindDynamicEntity(change.items[0], child, tokenMap.get(change.items[0]));
                            break;
                        case 'swap':
                            break;
                        case 'merge':
                            throw new Error('Operation not supported');
                    }
                });
                continue;
            }
            if (child instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource || child instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DuplexDataSource) {
                child.listen(() => invalidate(canvas), cancellationToken);
                let bindToken;
                let value;
                child.listenAndRepeat((newValue) => {
                    if (value !== newValue) {
                        value = newValue;
                        if (bindToken) {
                            bindToken.cancel();
                        }
                        bindToken = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.CancellationToken();
                        bindDynamicEntity(value, child, bindToken);
                    }
                });
                continue;
            }
            if (child[_drawables_state_js__WEBPACK_IMPORTED_MODULE_2__.stateSymbol]) {
                if (!parent) {
                    throw new Error('Cannot use <State> nodes at root level');
                }
                parent.animations.push(child);
                continue;
            }
            if ('onMouseEnter' in child || 'onMouseLeave' in child) {
                let isInside = false;
                onMouseMove.subscribe((e) => {
                    if (isOnTopOf(e, child, canvas.getContext('2d'))) {
                        if (!isInside && child.onMouseEnter) {
                            child.onMouseEnter(e, child);
                        }
                        isInside = true;
                    }
                    else {
                        if (isInside && child.onMouseLeave) {
                            child.onMouseLeave(e, child);
                        }
                        isInside = false;
                    }
                }, cancellationToken);
            }
            for (const key in child) {
                if (key === 'onMouseUp') {
                    onMouseUp.subscribe((e) => {
                        if (isOnTopOf(e, child, canvas.getContext('2d'))) {
                            child.onMouseUp(e, child);
                        }
                    }, cancellationToken);
                    continue;
                }
                if (key === 'onMouseDown') {
                    onMouseUp.subscribe((e) => {
                        if (isOnTopOf(e, child, canvas.getContext('2d'))) {
                            child.onMouseUp(e, child);
                        }
                    }, cancellationToken);
                    continue;
                }
                if (key === 'onMouseClick') {
                    onMouseUp.subscribe((e) => {
                        if (isOnTopOf(e, child, canvas.getContext('2d'))) {
                            child.onMouseClick(e, child);
                        }
                    }, cancellationToken);
                    continue;
                }
                if (child[key] instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
                    let value = child[key].value;
                    let lastState;
                    if (key === 'state') {
                        const value = (0,_utilities_js__WEBPACK_IMPORTED_MODULE_3__.deref)(child[key]);
                        lastState = value;
                        child.animationStates = child.animations.filter((e) => e.id === value);
                        child.animationTime = Date.now();
                    }
                    child[key].listen((newValue) => {
                        if (value !== newValue) {
                            value = newValue;
                            if (key === 'state') {
                                if (lastState !== newValue) {
                                    lastState = newValue;
                                    child.animationStates = child.animations.filter((e) => e.id === newValue);
                                    child.animationTime = Date.now();
                                    invalidate(canvas);
                                }
                            }
                            else {
                                invalidate(canvas);
                            }
                        }
                    }, cancellationToken);
                }
            }
            bind(canvas, child.children, child, cancellationToken);
        }
        function bindDynamicEntity(value, parent, bindToken) {
            const arrayedValue = Array.isArray(value) ? value : [value];
            const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
            const renderResult = [];
            for (const piece of arrayedValue) {
                if (!piece) {
                    continue;
                }
                if (!renderCache.has(piece)) {
                    renderCache.set(piece, api.prerender(piece, lc));
                }
                renderResult.push(renderCache.get(piece));
            }
            bind(canvas, renderResult, parent, bindToken);
            lc.onAttach();
            bindToken.addCancelable(() => lc.onDetach());
            invalidate(canvas);
        }
    }
    function invalidate(canvas) {
        if (!pendingRerender) {
            pendingRerender = requestAnimationFrame(() => {
                pendingRerender = undefined;
                if (canvas.isConnected) {
                    render(canvas, components);
                }
            });
        }
    }
    function render(canvas, components) {
        const context = canvas.getContext('2d');
        if (props.backgroundColor === undefined) {
            context.clearRect(0, 0, canvas.width, canvas.height);
        }
        else {
            context.fillStyle = (0,_utilities_js__WEBPACK_IMPORTED_MODULE_3__.deref)(props.backgroundColor);
            context.fillRect(0, 0, canvas.width, canvas.height);
        }
        applyContextTransformation(context);
        for (const child of components) {
            renderChild(context, child, 0, 0);
        }
        unapplyContextTransformation(context);
    }
    function unapplyContextTransformation(context) {
        if (props.scale || props.translate) {
            context.restore();
        }
    }
    function applyContextTransformation(context) {
        if (props.scale || props.translate) {
            context.save();
            if (props.scale?.value) {
                context.scale(props.scale.value.x, props.scale.value.y);
            }
            if (props.translate?.value) {
                context.translate(props.translate.value.x, props.translate.value.y);
            }
        }
    }
    function renderChild(context, child, offsetX, offsetY) {
        if (child === undefined || child === null) {
            return;
        }
        if (Array.isArray(child)) {
            for (const item of child) {
                renderChild(context, item, offsetX, offsetY);
            }
            return;
        }
        if (child[_drawables_state_js__WEBPACK_IMPORTED_MODULE_2__.stateSymbol]) {
            return;
        }
        if (child[aurumjs__WEBPACK_IMPORTED_MODULE_0__.aurumElementModelIdentitiy]) {
            if (!renderCache.has(child)) {
                throw new Error('illegal state: unrendered aurum element made it into the canvas render phase');
            }
            child = renderCache.get(child);
        }
        if (child instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.ArrayDataSource) {
            for (const node of child.getData()) {
                renderChild(context, node, offsetX, offsetY);
            }
            return;
        }
        if (child instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource || child instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DuplexDataSource) {
            renderChild(context, child.value, offsetX, offsetY);
            return;
        }
        context.save();
        let idle;
        switch (child.type) {
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.PATH:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderPath)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.REGULAR_POLYGON:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderRegularPolygon)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.RECTANGLE:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderRectangle)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.TEXT:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderText)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.LINE:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderLine)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.QUADRATIC_CURVE:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderQuadraticCurve)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.BEZIER_CURVE:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderBezierCurve)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.ELIPSE:
                idle = (0,_rendering_js__WEBPACK_IMPORTED_MODULE_4__.renderElipse)(context, child, offsetX, offsetY);
                break;
            case _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.GROUP:
                idle = true;
                break;
        }
        if (!idle) {
            invalidate(context.canvas);
        }
        for (const subChild of child.children) {
            renderChild(context, subChild, (0,_utilities_js__WEBPACK_IMPORTED_MODULE_3__.deref)(child.x) + offsetX, (0,_utilities_js__WEBPACK_IMPORTED_MODULE_3__.deref)(child.y) + offsetY);
        }
        context.restore();
    }
}
//# sourceMappingURL=canvas.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "ComponentType": () => (/* binding */ ComponentType)
/* harmony export */ });
var ComponentType;
(function (ComponentType) {
    ComponentType[ComponentType["RECTANGLE"] = 0] = "RECTANGLE";
    ComponentType[ComponentType["ELIPSE"] = 1] = "ELIPSE";
    ComponentType[ComponentType["LINE"] = 2] = "LINE";
    ComponentType[ComponentType["TEXT"] = 3] = "TEXT";
    ComponentType[ComponentType["IMAGE"] = 4] = "IMAGE";
    ComponentType[ComponentType["GROUP"] = 5] = "GROUP";
    ComponentType[ComponentType["STATE"] = 6] = "STATE";
    ComponentType[ComponentType["PATH"] = 7] = "PATH";
    ComponentType[ComponentType["QUADRATIC_CURVE"] = 8] = "QUADRATIC_CURVE";
    ComponentType[ComponentType["BEZIER_CURVE"] = 9] = "BEZIER_CURVE";
    ComponentType[ComponentType["REGULAR_POLYGON"] = 10] = "REGULAR_POLYGON";
})(ComponentType || (ComponentType = {}));
//# sourceMappingURL=component_model.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_elipse.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_elipse.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumElipse": () => (/* binding */ AurumElipse)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumElipse(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    const components = api.prerender(children, lc).filter((c) => !!c);
    return {
        ...props,
        opacity: props.opacity ?? 1,
        renderedState: undefined,
        children: components,
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.ELIPSE
    };
}
//# sourceMappingURL=aurum_elipse.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_group.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_group.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumGroup": () => (/* binding */ AurumGroup)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumGroup(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    props.x ??= 0;
    props.y ??= 0;
    const components = api.prerender(children, lc).filter((c) => !!c);
    return {
        ...props,
        renderedState: undefined,
        children: components,
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.GROUP
    };
}
//# sourceMappingURL=aurum_group.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_image.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_image.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumImage": () => (/* binding */ AurumImage)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumImage(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    const components = api.prerender(children, lc).filter((c) => !!c);
    return {
        ...props,
        opacity: props.opacity ?? 1,
        renderedState: undefined,
        children: components,
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.IMAGE
    };
}
//# sourceMappingURL=aurum_image.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_line.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_line.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumLine": () => (/* binding */ AurumLine)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumLine(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    const components = api.prerender(children, lc).filter((c) => !!c);
    return {
        ...props,
        opacity: props.opacity ?? 1,
        lineWidth: props.lineWidth ?? 1,
        renderedState: undefined,
        children: components,
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.LINE
    };
}
//# sourceMappingURL=aurum_line.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_path.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_path.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumPath": () => (/* binding */ AurumPath)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumPath(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    const components = api.prerender(children, lc).filter((c) => !!c);
    return {
        ...props,
        opacity: props.opacity ?? 1,
        renderedState: undefined,
        children: components,
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.PATH
    };
}
//# sourceMappingURL=aurum_path.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_rectangle.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_rectangle.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumRectangle": () => (/* binding */ AurumRectangle)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumRectangle(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    const components = api.prerender(children, lc).filter((c) => !!c);
    return {
        ...props,
        opacity: props.opacity ?? 1,
        renderedState: undefined,
        children: components,
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.RECTANGLE
    };
}
//# sourceMappingURL=aurum_rectangle.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_regular_polygon.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_regular_polygon.js ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumRegularPolygon": () => (/* binding */ AurumRegularPolygon)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumRegularPolygon(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    const components = api.prerender(children, lc).filter((c) => !!c);
    return {
        ...props,
        opacity: props.opacity ?? 1,
        renderedState: undefined,
        children: components,
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.REGULAR_POLYGON
    };
}
//# sourceMappingURL=aurum_regular_polygon.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_text.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/aurum_text.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AurumText": () => (/* binding */ AurumText)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


function AurumText(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    if (props.onAttach) {
        api.onAttach(() => props.onAttach());
    }
    if (props.onDetach) {
        api.onDetach(() => props.onDetach());
    }
    const content = api.prerender(children, lc).filter((c) => !!c);
    const text = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource('');
    if (props.font instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
        props.font.listen(() => {
            if (result.renderedState) {
                result.renderedState.lines = [];
            }
        }, api.cancellationToken);
    }
    if (props.fontWeight instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
        props.fontWeight.listen(() => {
            if (result.renderedState) {
                result.renderedState.lines = [];
            }
        }, api.cancellationToken);
    }
    if (props.fontSize instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
        props.fontSize.listen(() => {
            if (result.renderedState) {
                result.renderedState.lines = [];
            }
        }, api.cancellationToken);
    }
    if (props.width instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
        props.width.listen(() => {
            if (result.renderedState) {
                result.renderedState.lines = [];
            }
        }, api.cancellationToken);
    }
    if (props.wrapWidth instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
        props.wrapWidth.listen(() => {
            if (result.renderedState) {
                result.renderedState.lines = [];
            }
        }, api.cancellationToken);
    }
    for (const i of content) {
        if (i instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
            i.transform((0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.dsUnique)(), api.cancellationToken).listen((v) => {
                if (result.renderedState) {
                    result.renderedState.lines = [];
                }
                updateText(text, content);
            });
        }
    }
    updateText(text, content);
    const result = {
        ...props,
        opacity: props.opacity ?? 1,
        renderedState: undefined,
        text,
        children: [],
        animations: [],
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.TEXT
    };
    return result;
}
function updateText(text, content) {
    text.update(content.reduce((p, c) => {
        if (typeof c === 'string') {
            return `${p}${c}`;
        }
        else {
            if (c.value) {
                return `${p}${c.value}`;
            }
            else {
                return p;
            }
        }
    }, ''));
}
//# sourceMappingURL=aurum_text.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/state.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/drawables/state.js ***!
  \*********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "State": () => (/* binding */ State),
/* harmony export */   "stateSymbol": () => (/* binding */ stateSymbol)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");
/* harmony import */ var _component_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../component_model.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/component_model.js");


const stateSymbol = Symbol('state');
function State(props, children, api) {
    const lc = (0,aurumjs__WEBPACK_IMPORTED_MODULE_0__.createLifeCycle)();
    api.synchronizeLifeCycle(lc);
    const components = api.prerender(children, lc);
    return {
        [stateSymbol]: true,
        x: undefined,
        y: undefined,
        ...props,
        renderedState: undefined,
        animations: [],
        children: components,
        type: _component_model_js__WEBPACK_IMPORTED_MODULE_1__.ComponentType.STATE
    };
}
//# sourceMappingURL=state.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/features.js":
/*!**************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/features.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initializeKeyboardPanningFeature": () => (/* binding */ initializeKeyboardPanningFeature),
/* harmony export */   "initializeMousePanningFeature": () => (/* binding */ initializeMousePanningFeature),
/* harmony export */   "initializeZoomFeature": () => (/* binding */ initializeZoomFeature)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");

function initializeKeyboardPanningFeature(props, canvas) {
    let moveToken;
    const keyDown = new Set();
    const moveVector = {
        x: 0,
        y: 0
    };
    window.addEventListener('keyup', (e) => {
        if (e.keyCode === props.features.panning.keyboard.leftKeyCode || e.keyCode === props.features.panning.keyboard.rightKeyCode) {
            moveVector.x = 0;
            keyDown.delete(e.keyCode);
        }
        if (e.keyCode === props.features.panning.keyboard.upKeyCode || e.keyCode === props.features.panning.keyboard.downKeyCode) {
            moveVector.y = 0;
            keyDown.delete(e.keyCode);
        }
        if (moveToken && keyDown.size === 0) {
            moveToken.cancel();
            moveToken = undefined;
        }
    });
    window.addEventListener('keydown', (e) => {
        if (e.keyCode === props.features.panning.keyboard.leftKeyCode) {
            moveVector.x = props.features.panning.keyboard.pixelsPerFrame;
            keyDown.add(e.keyCode);
        }
        if (e.keyCode === props.features.panning.keyboard.downKeyCode) {
            moveVector.y = -props.features.panning.keyboard.pixelsPerFrame;
            keyDown.add(e.keyCode);
        }
        if (e.keyCode === props.features.panning.keyboard.rightKeyCode) {
            moveVector.x = -props.features.panning.keyboard.pixelsPerFrame;
            keyDown.add(e.keyCode);
        }
        if (e.keyCode === props.features.panning.keyboard.upKeyCode) {
            moveVector.y = props.features.panning.keyboard.pixelsPerFrame;
            keyDown.add(e.keyCode);
        }
        if (!moveToken && keyDown.size > 0) {
            moveToken = new aurumjs__WEBPACK_IMPORTED_MODULE_0__.CancellationToken();
            moveToken.animationLoop(() => {
                props.translate.update({
                    x: props.translate.value.x + moveVector.x,
                    y: props.translate.value.y + moveVector.y
                });
            });
        }
    });
}
function initializeMousePanningFeature(props, canvas) {
    let downX;
    let downY;
    let beforeX;
    let beforeY;
    let down = false;
    canvas.addEventListener('mousedown', (e) => {
        downX = e.clientX;
        downY = e.clientY;
        beforeX = props.translate.value.x;
        beforeY = props.translate.value.y;
        down = true;
    });
    document.addEventListener('mousemove', (e) => {
        if (down) {
            props.translate.update({
                x: beforeX - (downX - e.clientX) / props.scale.value.x,
                y: beforeY - (downY - e.clientY) / props.scale.value.y
            });
        }
    });
    document.addEventListener('mouseup', (e) => {
        down = false;
    });
}
function initializeZoomFeature(props, canvas) {
    canvas.addEventListener('wheel', (e) => {
        if (e.deltaY > 0) {
            if (props.scale.value.x < props.features.mouseWheelZoom.minZoom) {
                return;
            }
            props.translate.update({
                x: props.translate.value.x + (e.offsetX * (props.features.mouseWheelZoom.zoomIncrements - 1)) / props.scale.value.x,
                y: props.translate.value.y + (e.offsetY * (props.features.mouseWheelZoom.zoomIncrements - 1)) / props.scale.value.y
            });
            props.scale.update({
                x: props.scale.value.x / props.features.mouseWheelZoom.zoomIncrements,
                y: props.scale.value.y / props.features.mouseWheelZoom.zoomIncrements
            });
        }
        else {
            if (props.scale.value.x > props.features.mouseWheelZoom.maxZoom) {
                return;
            }
            props.scale.update({
                x: props.scale.value.x * props.features.mouseWheelZoom.zoomIncrements,
                y: props.scale.value.y * props.features.mouseWheelZoom.zoomIncrements
            });
            props.translate.update({
                x: props.translate.value.x - (e.offsetX * (props.features.mouseWheelZoom.zoomIncrements - 1)) / props.scale.value.x,
                y: props.translate.value.y - (e.offsetY * (props.features.mouseWheelZoom.zoomIncrements - 1)) / props.scale.value.y
            });
        }
    });
}
//# sourceMappingURL=features.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/rendering.js":
/*!***************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/rendering.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "renderBezierCurve": () => (/* binding */ renderBezierCurve),
/* harmony export */   "renderElipse": () => (/* binding */ renderElipse),
/* harmony export */   "renderLine": () => (/* binding */ renderLine),
/* harmony export */   "renderPath": () => (/* binding */ renderPath),
/* harmony export */   "renderQuadraticCurve": () => (/* binding */ renderQuadraticCurve),
/* harmony export */   "renderRectangle": () => (/* binding */ renderRectangle),
/* harmony export */   "renderRegularPolygon": () => (/* binding */ renderRegularPolygon),
/* harmony export */   "renderText": () => (/* binding */ renderText)
/* harmony export */ });
/* unused harmony export resolveValues */
/* harmony import */ var _utilities_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utilities.js */ "./node_modules/aurum-canvas/prebuilt/esnext/components/utilities.js");

const regularPolygonKeys = ['x', 'y', 'opacity', 'strokeColor', 'fillColor', 'path', 'sides', 'radius', 'originX', 'originY'];
const pathKeys = ['x', 'y', 'opacity', 'strokeColor', 'fillColor', 'path', 'lineWidth', 'originX', 'originY'];
const elipseKeys = ['x', 'y', 'opacity', 'strokeColor', 'fillColor', 'rotation', 'rx', 'ry', 'startAngle', 'endAngle', 'originX', 'originY'];
const lineKeys = ['x', 'y', 'opacity', 'strokeColor', 'fillColor', 'tx', 'ty', 'lineWidth', 'originX', 'originY'];
const quadraticCurveKeys = ['x', 'y', 'opacity', 'strokeColor', 'fillColor', 'tx', 'ty', 'cx', 'cy', 'lineWidth', 'originX', 'originY'];
const bezierCurveKeys = ['x', 'y', 'opacity', 'strokeColor', 'fillColor', 'tx', 'ty', 'cx', 'cy', 'c2x', 'c2y', 'lineWidth', 'originX', 'originY'];
const textKeys = [
    'x',
    'y',
    'realWidth',
    'width',
    'font',
    'fontSize',
    'opacity',
    'strokeColor',
    'fillColor',
    'text',
    'fontWeight',
    'wrapWidth',
    'lineHeight',
    'textBaseline',
    'originX',
    'originY'
];
const rectangleKeys = ['x', 'y', 'width', 'height', 'opacity', 'strokeColor', 'fillColor', 'originX', 'originY'];
function renderElipse(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, elipseKeys, offsetX, offsetY);
    const { x, y, idle, fillColor, strokeColor, opacity, rx, ry, rotation, startAngle, endAngle } = renderedState;
    child.renderedState = renderedState;
    child.onPreDraw?.(child.renderedState);
    context.globalAlpha = opacity;
    const path2d = new Path2D();
    if ((fillColor || strokeColor) && rx > 0.01 && ry > 0.01 && (startAngle ?? 0 !== endAngle)) {
        path2d.ellipse(x, y, rx, ry, rotation ?? 0, startAngle ?? 0, endAngle ?? Math.PI * 2);
        child.renderedState.path = path2d;
    }
    else {
        child.renderedState.path = undefined;
    }
    drawCanvasPath(child, context, path2d, fillColor, strokeColor);
    return idle;
}
function renderLine(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, lineKeys, offsetX, offsetY);
    const { x, y, idle, fillColor, strokeColor, opacity, tx, ty, lineWidth } = renderedState;
    child.renderedState = renderedState;
    child.onPreDraw?.(child.renderedState);
    const path2d = new Path2D();
    context.globalAlpha = opacity;
    if (fillColor || strokeColor) {
        path2d.moveTo(x, y);
        path2d.lineTo(tx, ty);
        context.lineWidth = lineWidth;
        child.renderedState.path = path2d;
    }
    else {
        child.renderedState.path = undefined;
    }
    drawCanvasPath(child, context, path2d, fillColor, strokeColor);
    return idle;
}
function renderQuadraticCurve(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, quadraticCurveKeys, offsetX, offsetY);
    const { x, y, cx, cy, idle, fillColor, strokeColor, opacity, tx, ty, lineWidth } = renderedState;
    child.renderedState = renderedState;
    child.onPreDraw?.(child.renderedState);
    context.globalAlpha = opacity;
    const path2d = new Path2D();
    if (fillColor || strokeColor) {
        path2d.moveTo(x, y);
        path2d.quadraticCurveTo(cx, cy, tx, ty);
        context.lineWidth = lineWidth;
        child.renderedState.path = path2d;
    }
    else {
        child.renderedState.path = undefined;
    }
    drawCanvasPath(child, context, path2d, fillColor, strokeColor);
    return idle;
}
function renderBezierCurve(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, bezierCurveKeys, offsetX, offsetY);
    const { x, y, cx, cy, c2x, c2y, idle, fillColor, strokeColor, opacity, tx, ty, lineWidth } = renderedState;
    child.renderedState = renderedState;
    child.onPreDraw?.(child.renderedState);
    context.globalAlpha = opacity;
    const path2d = new Path2D();
    if (fillColor || strokeColor) {
        path2d.moveTo(x, y);
        path2d.bezierCurveTo(cx, cy, c2x, c2y, tx, ty);
        context.lineWidth = lineWidth;
        child.renderedState.path = path2d;
    }
    else {
        child.renderedState.path = undefined;
    }
    drawCanvasPath(child, context, path2d, fillColor, strokeColor);
    return idle;
}
function drawCanvasPath(child, context, path2d, fillColor, strokeColor) {
    if (child.fillColor) {
        context.fillStyle = fillColor;
        context.fill(path2d);
    }
    if (child.strokeColor) {
        context.strokeStyle = strokeColor;
        context.stroke(path2d);
    }
    if (child.clip) {
        context.clip(path2d);
    }
}
function renderPath(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, pathKeys, offsetX, offsetY);
    const { x, y, idle, fillColor, strokeColor, opacity, path, lineWidth } = renderedState;
    child.renderedState = renderedState;
    child.onPreDraw?.(child.renderedState);
    let path2d;
    context.globalAlpha = opacity;
    if (fillColor || strokeColor) {
        context.lineWidth = lineWidth;
        path2d = new Path2D(path);
        child.renderedState.path = path2d;
    }
    else {
        child.renderedState.path = undefined;
    }
    if (child.fillColor) {
        context.translate(x, y);
        context.fillStyle = fillColor;
        context.fill(path2d);
        context.translate(-x, -y);
    }
    if (child.strokeColor) {
        context.translate(x, y);
        context.strokeStyle = strokeColor;
        context.stroke(path2d);
        context.translate(-x, -y);
    }
    if (child.clip) {
        context.translate(x, y);
        context.clip(path2d);
        context.translate(-x, -y);
    }
    return idle;
}
function renderRegularPolygon(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, regularPolygonKeys, offsetX, offsetY);
    const { x, y, idle, fillColor, strokeColor, opacity, sides, radius } = renderedState;
    child.renderedState = renderedState;
    child.onPreDraw?.(child.renderedState);
    context.globalAlpha = opacity;
    if (renderedState.sides < 3) {
        return idle;
    }
    const path2d = new Path2D();
    if (fillColor || strokeColor) {
        let angle = 0;
        for (let i = 0; i < sides; i++) {
            angle += Math.PI / (sides / 2);
            const targetX = radius * Math.cos(angle);
            const targetY = radius * Math.sin(angle);
            if (i === 0) {
                path2d.moveTo(targetX + radius + x, targetY + radius + y);
            }
            else {
                path2d.lineTo(targetX + radius + x, targetY + radius + y);
            }
        }
        child.renderedState.path = path2d;
    }
    else {
        child.renderedState.path = undefined;
    }
    drawCanvasPath(child, context, path2d, fillColor, strokeColor);
    return idle;
}
function renderText(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, textKeys, offsetX, offsetY, false);
    let { x, y, idle, fontSize = 16, textBaseline, font, fillColor, strokeColor, opacity, text, fontWeight, width, wrapWidth, lineHeight, originX } = renderedState;
    if (child.renderedState?.width && !renderedState.width) {
        renderedState.width = child.renderedState.width;
    }
    if (child.renderedState?.realWidth && !renderedState.realWidth) {
        renderedState.realWidth = child.renderedState.realWidth;
    }
    renderedState.lines = child.renderedState?.lines;
    child.renderedState = renderedState;
    child.renderedState.lines = child.renderedState.lines ?? [];
    let lines = child.renderedState.lines;
    if (textBaseline) {
        context.textBaseline = textBaseline;
    }
    context.font = `${fontWeight ? fontWeight + ' ' : ''}${fontSize}px ${font ?? 'Arial'}`;
    renderedState.height = fontSize;
    if (lines.length === 0) {
        if (wrapWidth) {
            child.renderedState.realWidth = 0;
            const pieces = text.split(' ');
            let line = pieces.shift();
            while (pieces.length) {
                const measuredWidth = context.measureText(line + ' ' + pieces[0]);
                if (measuredWidth.width > child.renderedState.realWidth) {
                    child.renderedState.realWidth = measuredWidth.width;
                }
                if (measuredWidth <= wrapWidth) {
                    line += ' ' + pieces.shift();
                }
                else {
                    lines.push(line);
                    line = pieces.shift();
                }
            }
            lines.push(line);
        }
        else {
            if (!width) {
                child.renderedState.realWidth = child.renderedState.width = context.measureText(text).width;
            }
            else {
                child.renderedState.realWidth = context.measureText(text).width;
            }
            lines.push(text);
        }
    }
    child.onPreDraw?.(child.renderedState);
    context.globalAlpha = opacity;
    if (originX) {
        x -= Math.min(child.renderedState.realWidth, child.renderedState.width) * originX;
    }
    for (let i = 0; i < lines.length; i++) {
        if (fillColor) {
            context.fillStyle = fillColor;
            context.fillText(lines[i], x, y + (lineHeight ?? 16) * i, width);
        }
        if (strokeColor) {
            context.strokeStyle = strokeColor;
            context.strokeText(lines[i], x, y + (lineHeight ?? 16) * i, width);
        }
    }
    return idle;
}
function renderRectangle(context, child, offsetX, offsetY) {
    const renderedState = resolveValues(child, rectangleKeys, offsetX, offsetY);
    const { x, y, width, height, idle, fillColor, strokeColor, opacity } = renderedState;
    child.renderedState = renderedState;
    child.onPreDraw?.(child.renderedState);
    if (opacity <= 0 && !child.clip) {
        return idle;
    }
    context.globalAlpha = opacity;
    if (fillColor) {
        context.fillStyle = fillColor;
        context.fillRect(x, y, width, height);
    }
    if (strokeColor) {
        context.strokeStyle = strokeColor;
        context.strokeRect(x, y, width, height);
    }
    if (child.clip) {
        context.beginPath();
        context.rect(x, y, width, height);
        context.clip();
    }
    return idle;
}
function resolveValues(node, props, offsetX, offsetY, applyOrigin = true) {
    const result = {
        idle: true,
        x: 0,
        y: 0
    };
    let idle = true;
    for (const key of props) {
        const baseValue = (0,_utilities_js__WEBPACK_IMPORTED_MODULE_0__.deref)(node[key]);
        const state = node.animationStates?.find((n) => n[key] != undefined);
        if (state) {
            let progress;
            if (!state.transitionTime) {
                progress = 1;
            }
            else {
                progress = Math.min(1, (Date.now() - node.animationTime) / (0,_utilities_js__WEBPACK_IMPORTED_MODULE_0__.deref)(state.transitionTime));
            }
            const targetValue = state[key];
            result[key] = baseValue + (targetValue - baseValue) * progress;
            if (progress < 1) {
                idle = false;
            }
        }
        else {
            result[key] = baseValue;
        }
    }
    result.x += offsetX;
    result.y += offsetY;
    if (applyOrigin) {
        //@ts-ignore
        if (result.originX && result.width) {
            //@ts-ignore
            result.x -= result.width * result.originX;
        }
        //@ts-ignore
        if (result.originY && result.height) {
            //@ts-ignore
            result.y -= result.height * result.originY;
        }
    }
    if ('tx' in result) {
        //@ts-ignore
        result.tx += offsetX;
    }
    if ('ty' in result) {
        //@ts-ignore
        result.ty += offsetY;
    }
    if ('cx' in result) {
        //@ts-ignore
        result.cx += offsetX;
    }
    if ('cy' in result) {
        //@ts-ignore
        result.cy += offsetY;
    }
    if ('c2x' in result) {
        //@ts-ignore
        result.c2x += offsetX;
    }
    if ('c2y' in result) {
        //@ts-ignore
        result.c2y += offsetY;
    }
    result.idle = idle;
    return result;
}
//# sourceMappingURL=rendering.js.map

/***/ }),

/***/ "./node_modules/aurum-canvas/prebuilt/esnext/components/utilities.js":
/*!***************************************************************************!*\
  !*** ./node_modules/aurum-canvas/prebuilt/esnext/components/utilities.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "deref": () => (/* binding */ deref)
/* harmony export */ });
/* harmony import */ var aurumjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurumjs */ "./node_modules/aurumjs/prebuilt/esnext/aurumjs.js");

function deref(source) {
    if (source instanceof aurumjs__WEBPACK_IMPORTED_MODULE_0__.DataSource) {
        return source.value;
    }
    else {
        return source;
    }
}
//# sourceMappingURL=utilities.js.map

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGljL2pzL3ZlbmRvcnMtbm9kZV9tb2R1bGVzX2F1cnVtLWNhbnZhc19wcmVidWlsdF9lc25leHRfYXVydW0tY2FudmFzX2pzLmJ1bmRsZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUM7QUFDbUI7QUFDTDtBQUNBO0FBQ0U7QUFDRDtBQUNEO0FBQ0w7QUFDTTtBQUNVO0FBQ2hFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDVjhLO0FBQ3pIO0FBQ0Y7QUFDWjtBQUMySDtBQUMzQztBQUN2SDtBQUNPO0FBQ1AsZUFBZSx3REFBZTtBQUM5QjtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQWlCO0FBQ25ELDBCQUEwQixpREFBWTtBQUN0Qyx3QkFBd0IsaURBQVk7QUFDcEMsMEJBQTBCLGlEQUFZO0FBQ3RDLFlBQVksa0RBQWEsYUFBYTtBQUN0QztBQUNBO0FBQ0Esc0NBQXNDLCtDQUFVLEdBQUcsWUFBWTtBQUMvRDtBQUNBO0FBQ0EsMENBQTBDLCtDQUFVLEdBQUcsWUFBWTtBQUNuRTtBQUNBO0FBQ0Esb0JBQW9CLG1FQUFxQjtBQUN6QztBQUNBO0FBQ0Esb0JBQW9CLDJFQUE2QjtBQUNqRDtBQUNBO0FBQ0Esb0JBQW9CLDhFQUFnQztBQUNwRDtBQUNBO0FBQ0EsdUNBQXVDLCtDQUFVO0FBQ2pEO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpREFBaUQsK0NBQVU7QUFDM0Q7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLHdDQUF3QywrQ0FBVTtBQUNsRDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGlEQUFRO0FBQ2xEO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxzQ0FBc0MsaURBQVE7QUFDOUM7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUyxtSUFBbUksOENBQUsscUhBQXFILDhDQUFLLHdCQUF3QjtBQUNu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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBLFlBQVksNkRBQTZEO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsb0RBQUs7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyRUFBMkUsb0RBQUs7QUFDaEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7QUNoVnFDO0FBQzlCO0FBQ1AsMEJBQTBCLCtDQUFVO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXVydW0ub3JnLy4vbm9kZV9tb2R1bGVzL2F1cnVtLWNhbnZhcy9wcmVidWlsdC9lc25leHQvYXVydW0tY2FudmFzLmpzIiwid2VicGFjazovL2F1cnVtLm9yZy8uL25vZGVfbW9kdWxlcy9hdXJ1bS1jYW52YXMvcHJlYnVpbHQvZXNuZXh0L2NvbXBvbmVudHMvY2FudmFzLmpzIiwid2VicGFjazovL2F1cnVtLm9yZy8uL25vZGVfbW9kdWxlcy9hdXJ1bS1jYW52YXMvcHJlYnVpbHQvZXNuZXh0L2NvbXBvbmVudHMvY29tcG9uZW50X21vZGVsLmpzIiwid2VicGFjazovL2F1cnVtLm9yZy8uL25vZGVfbW9kdWxlcy9hdXJ1bS1jYW52YXMvcHJlYnVpbHQvZXNuZXh0L2NvbXBvbmVudHMvZHJhd2FibGVzL2F1cnVtX2VsaXBzZS5qcyIsIndlYnBhY2s6Ly9hdXJ1bS5vcmcvLi9ub2RlX21vZHVsZXMvYXVydW0tY2FudmFzL3ByZWJ1aWx0L2VzbmV4dC9jb21wb25lbnRzL2RyYXdhYmxlcy9hdXJ1bV9ncm91cC5qcyIsIndlYnBhY2s6Ly9hdXJ1bS5vcmcvLi9ub2RlX21vZHVsZXMvYXVydW0tY2FudmFzL3ByZWJ1aWx0L2VzbmV4dC9jb21wb25lbnRzL2RyYXdhYmxlcy9hdXJ1bV9pbWFnZS5qcyIsIndlYnBhY2s6Ly9hdXJ1bS5vcmcvLi9ub2RlX21vZHVsZXMvYXVydW0tY2FudmFzL3ByZWJ1aWx0L2VzbmV4dC9jb21wb25lbnRzL2RyYXdhYmxlcy9hdXJ1bV9saW5lLmpzIiwid2VicGFjazovL2F1cnVtLm9yZy8uL25vZGVfbW9kdWxlcy9hdXJ1bS1jYW52YXMvcHJlYnVpbHQvZXNuZXh0L2NvbXBvbmVudHMvZHJhd2FibGVzL2F1cnVtX3BhdGguanMiLCJ3ZWJwYWNrOi8vYXVydW0ub3JnLy4vbm9kZV9tb2R1bGVzL2F1cnVtLWNhbnZhcy9wcmVidWlsdC9lc25leHQvY29tcG9uZW50cy9kcmF3YWJsZXMvYXVydW1fcmVjdGFuZ2xlLmpzIiwid2VicGFjazovL2F1cnVtLm9yZy8uL25vZGVfbW9kdWxlcy9hdXJ1bS1jYW52YXMvcHJlYnVpbHQvZXNuZXh0L2NvbXBvbmVudHMvZHJhd2FibGVzL2F1cnVtX3JlZ3VsYXJfcG9seWdvbi5qcyIsIndlYnBhY2s6Ly9hdXJ1bS5vcmcvLi9ub2RlX21vZHVsZXMvYXVydW0tY2FudmFzL3ByZWJ1aWx0L2VzbmV4dC9jb21wb25lbnRzL2RyYXdhYmxlcy9hdXJ1bV90ZXh0LmpzIiwid2VicGFjazovL2F1cnVtLm9yZy8uL25vZGVfbW9kdWxlcy9hdXJ1bS1jYW52YXMvcHJlYnVpbHQvZXNuZXh0L2NvbXBvbmVudHMvZHJhd2FibGVzL3N0YXRlLmpzIiwid2VicGFjazovL2F1cnVtLm9yZy8uL25vZGVfbW9kdWxlcy9hdXJ1bS1jYW52YXMvcHJlYnVpbHQvZXNuZXh0L2NvbXBvbmVudHMvZmVhdHVyZXMuanMiLCJ3ZWJwYWNrOi8vYXVydW0ub3JnLy4vbm9kZV9tb2R1bGVzL2F1cnVtLWNhbnZhcy9wcmVidWlsdC9lc25leHQvY29tcG9uZW50cy9yZW5kZXJpbmcuanMiLCJ3ZWJwYWNrOi8vYXVydW0ub3JnLy4vbm9kZV9tb2R1bGVzL2F1cnVtLWNhbnZhcy9wcmVidWlsdC9lc25leHQvY29tcG9uZW50cy91dGlsaXRpZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0ICogZnJvbSAnLi9jb21wb25lbnRzL2NhbnZhcy5qcyc7XG5leHBvcnQgKiBmcm9tICcuL2NvbXBvbmVudHMvZHJhd2FibGVzL2F1cnVtX3JlY3RhbmdsZS5qcyc7XG5leHBvcnQgKiBmcm9tICcuL2NvbXBvbmVudHMvZHJhd2FibGVzL2F1cnVtX3RleHQuanMnO1xuZXhwb3J0ICogZnJvbSAnLi9jb21wb25lbnRzL2RyYXdhYmxlcy9hdXJ1bV9saW5lLmpzJztcbmV4cG9ydCAqIGZyb20gJy4vY29tcG9uZW50cy9kcmF3YWJsZXMvYXVydW1fZWxpcHNlLmpzJztcbmV4cG9ydCAqIGZyb20gJy4vY29tcG9uZW50cy9kcmF3YWJsZXMvYXVydW1fZ3JvdXAuanMnO1xuZXhwb3J0ICogZnJvbSAnLi9jb21wb25lbnRzL2RyYXdhYmxlcy9hdXJ1bV9wYXRoLmpzJztcbmV4cG9ydCAqIGZyb20gJy4vY29tcG9uZW50cy9kcmF3YWJsZXMvc3RhdGUuanMnO1xuZXhwb3J0ICogZnJvbSAnLi9jb21wb25lbnRzL2RyYXdhYmxlcy9hdXJ1bV9pbWFnZS5qcyc7XG5leHBvcnQgKiBmcm9tICcuL2NvbXBvbmVudHMvZHJhd2FibGVzL2F1cnVtX3JlZ3VsYXJfcG9seWdvbi5qcyc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXJ1bS1jYW52YXMuanMubWFwIiwiaW1wb3J0IHsgQXVydW0sIERhdGFTb3VyY2UsIEFycmF5RGF0YVNvdXJjZSwgRHVwbGV4RGF0YVNvdXJjZSwgYXVydW1FbGVtZW50TW9kZWxJZGVudGl0aXksIENhbmNlbGxhdGlvblRva2VuLCBFdmVudEVtaXR0ZXIsIGRzVW5pcXVlLCBjcmVhdGVMaWZlQ3ljbGUsIGRzTWFwIH0gZnJvbSAnYXVydW1qcyc7XG5pbXBvcnQgeyBDb21wb25lbnRUeXBlIH0gZnJvbSAnLi9jb21wb25lbnRfbW9kZWwuanMnO1xuaW1wb3J0IHsgc3RhdGVTeW1ib2wgfSBmcm9tICcuL2RyYXdhYmxlcy9zdGF0ZS5qcyc7XG5pbXBvcnQgeyBkZXJlZiB9IGZyb20gJy4vdXRpbGl0aWVzLmpzJztcbmltcG9ydCB7IHJlbmRlclBhdGgsIHJlbmRlclJlY3RhbmdsZSwgcmVuZGVyVGV4dCwgcmVuZGVyTGluZSwgcmVuZGVyUXVhZHJhdGljQ3VydmUsIHJlbmRlckJlemllckN1cnZlLCByZW5kZXJFbGlwc2UsIHJlbmRlclJlZ3VsYXJQb2x5Z29uIH0gZnJvbSAnLi9yZW5kZXJpbmcuanMnO1xuaW1wb3J0IHsgaW5pdGlhbGl6ZUtleWJvYXJkUGFubmluZ0ZlYXR1cmUsIGluaXRpYWxpemVNb3VzZVBhbm5pbmdGZWF0dXJlLCBpbml0aWFsaXplWm9vbUZlYXR1cmUgfSBmcm9tICcuL2ZlYXR1cmVzLmpzJztcbmNvbnN0IHJlbmRlckNhY2hlID0gbmV3IFdlYWtNYXAoKTtcbmV4cG9ydCBmdW5jdGlvbiBBdXJ1bUNhbnZhcyhwcm9wcywgY2hpbGRyZW4sIGFwaSkge1xuICAgIGNvbnN0IGxjID0gY3JlYXRlTGlmZUN5Y2xlKCk7XG4gICAgYXBpLnN5bmNocm9uaXplTGlmZUN5Y2xlKGxjKTtcbiAgICBjb25zdCBjb21wb25lbnRzID0gYXBpLnByZXJlbmRlcihjaGlsZHJlbiwgbGMpO1xuICAgIGxldCBwZW5kaW5nUmVyZW5kZXI7XG4gICAgY29uc3QgY2FuY2VsbGF0aW9uVG9rZW4gPSBuZXcgQ2FuY2VsbGF0aW9uVG9rZW4oKTtcbiAgICBsZXQgb25Nb3VzZU1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgbGV0IG9uTW91c2VVcCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBsZXQgb25Nb3VzZURvd24gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgcmV0dXJuIChBdXJ1bS5mYWN0b3J5KFwiY2FudmFzXCIsIHsgb25BdHRhY2g6IChjYW52YXMpID0+IHtcbiAgICAgICAgICAgIGlmIChwcm9wcy5mZWF0dXJlcykge1xuICAgICAgICAgICAgICAgIGlmICghcHJvcHMuc2NhbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMuc2NhbGUgPSBuZXcgRGF0YVNvdXJjZSh7IHg6IDEsIHk6IDEgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghcHJvcHMudHJhbnNsYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BzLnRyYW5zbGF0ZSA9IG5ldyBEYXRhU291cmNlKHsgeDogMCwgeTogMCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHByb3BzLmZlYXR1cmVzLm1vdXNlV2hlZWxab29tKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVab29tRmVhdHVyZShwcm9wcywgY2FudmFzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHByb3BzLmZlYXR1cmVzLnBhbm5pbmc/Lm1vdXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVNb3VzZVBhbm5pbmdGZWF0dXJlKHByb3BzLCBjYW52YXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocHJvcHMuZmVhdHVyZXMucGFubmluZz8ua2V5Ym9hcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZUtleWJvYXJkUGFubmluZ0ZlYXR1cmUocHJvcHMsIGNhbnZhcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByb3BzLndpZHRoIGluc3RhbmNlb2YgRGF0YVNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHByb3BzLndpZHRoLmxpc3RlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRhdGUoY2FudmFzKTtcbiAgICAgICAgICAgICAgICB9LCBhcGkuY2FuY2VsbGF0aW9uVG9rZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByb3BzLmJhY2tncm91bmRDb2xvciBpbnN0YW5jZW9mIERhdGFTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBwcm9wcy5iYWNrZ3JvdW5kQ29sb3IubGlzdGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaW52YWxpZGF0ZShjYW52YXMpO1xuICAgICAgICAgICAgICAgIH0sIGFwaS5jYW5jZWxsYXRpb25Ub2tlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHJvcHMuaGVpZ2h0IGluc3RhbmNlb2YgRGF0YVNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHByb3BzLmhlaWdodC5saXN0ZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpbnZhbGlkYXRlKGNhbnZhcyk7XG4gICAgICAgICAgICAgICAgfSwgYXBpLmNhbmNlbGxhdGlvblRva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJpbmRDYW52YXMoY2FudmFzLCBjb21wb25lbnRzLCBjYW5jZWxsYXRpb25Ub2tlbik7XG4gICAgICAgICAgICByZW5kZXIoY2FudmFzLCBjb21wb25lbnRzKTtcbiAgICAgICAgICAgIGlmIChwcm9wcy50cmFuc2xhdGUpIHtcbiAgICAgICAgICAgICAgICBwcm9wcy50cmFuc2xhdGUudHJhbnNmb3JtKGRzVW5pcXVlKCksIGFwaS5jYW5jZWxsYXRpb25Ub2tlbikubGlzdGVuKCh2KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRhdGUoY2FudmFzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwcm9wcy5zY2FsZSkge1xuICAgICAgICAgICAgICAgIHByb3BzLnNjYWxlLnRyYW5zZm9ybShkc1VuaXF1ZSgpLCBhcGkuY2FuY2VsbGF0aW9uVG9rZW4pLmxpc3RlbigodikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpbnZhbGlkYXRlKGNhbnZhcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcm9wcy5vbkF0dGFjaD8uKGNhbnZhcyk7XG4gICAgICAgIH0sIG9uRGV0YWNoOiAoKSA9PiB7XG4gICAgICAgICAgICBjYW5jZWxsYXRpb25Ub2tlbi5jYW5jZWwoKTtcbiAgICAgICAgICAgIHByb3BzLm9uRGV0YWNoPy4oKTtcbiAgICAgICAgfSwgc3R5bGU6IHByb3BzLnN0eWxlLCBjbGFzczogcHJvcHMuY2xhc3MsIHdpZHRoOiB0eXBlb2YgcHJvcHMud2lkdGggIT09ICdvYmplY3QnID8gcHJvcHMud2lkdGg/LnRvU3RyaW5nKCkgOiBwcm9wcy53aWR0aC50cmFuc2Zvcm0oZHNNYXAoKHYpID0+IHYudG9TdHJpbmcoKSkpLCBoZWlnaHQ6IHR5cGVvZiBwcm9wcy5oZWlnaHQgIT09ICdvYmplY3QnID8gcHJvcHMuaGVpZ2h0Py50b1N0cmluZygpIDogcHJvcHMuaGVpZ2h0LnRyYW5zZm9ybShkc01hcCgodikgPT4gdi50b1N0cmluZygpKSkgfSkpO1xuICAgIGZ1bmN0aW9uIGJpbmRDYW52YXMoY2FudmFzLCBjb21wb25lbnRzLCBjYW5jZWxsYXRpb25Ub2tlbikge1xuICAgICAgICBjYW5jZWxsYXRpb25Ub2tlbi5yZWdpc3RlckRvbUV2ZW50KGNhbnZhcywgJ21vdXNlbGVhdmUnLCAoZSkgPT4ge1xuICAgICAgICAgICAgb25Nb3VzZU1vdmUuZmlyZShlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbmNlbGxhdGlvblRva2VuLnJlZ2lzdGVyRG9tRXZlbnQoY2FudmFzLCAnbW91c2Vtb3ZlJywgKGUpID0+IHtcbiAgICAgICAgICAgIG9uTW91c2VNb3ZlLmZpcmUoZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjYW5jZWxsYXRpb25Ub2tlbi5yZWdpc3RlckRvbUV2ZW50KGNhbnZhcywgJ21vdXNlZG93bicsIChlKSA9PiB7XG4gICAgICAgICAgICBvbk1vdXNlRG93bi5maXJlKGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgY2FuY2VsbGF0aW9uVG9rZW4ucmVnaXN0ZXJEb21FdmVudChjYW52YXMsICdtb3VzZXVwJywgKGUpID0+IHtcbiAgICAgICAgICAgIG9uTW91c2VVcC5maXJlKGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgYmluZChjYW52YXMsIGNvbXBvbmVudHMsIHVuZGVmaW5lZCwgY2FuY2VsbGF0aW9uVG9rZW4pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBpc09uVG9wT2YoZSwgdGFyZ2V0LCBjb250ZXh0KSB7XG4gICAgICAgIGlmICghdGFyZ2V0LnJlbmRlcmVkU3RhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgeCA9IGUub2Zmc2V0WCAtIChwcm9wcy50cmFuc2xhdGU/LnZhbHVlLnggPyBwcm9wcy50cmFuc2xhdGU/LnZhbHVlLnggKiAocHJvcHMuc2NhbGU/LnZhbHVlPy54ID8/IDEpIDogMCk7XG4gICAgICAgIGxldCB5ID0gZS5vZmZzZXRZIC0gKHByb3BzLnRyYW5zbGF0ZT8udmFsdWUueSA/IHByb3BzLnRyYW5zbGF0ZT8udmFsdWUueSAqIChwcm9wcy5zY2FsZT8udmFsdWU/LnggPz8gMSkgOiAwKTtcbiAgICAgICAgaWYgKHByb3BzLnNjYWxlKSB7XG4gICAgICAgICAgICB4IC89IHByb3BzLnNjYWxlLnZhbHVlLng7XG4gICAgICAgICAgICB5IC89IHByb3BzLnNjYWxlLnZhbHVlLnk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhcmdldC50eXBlID09PSBDb21wb25lbnRUeXBlLlRFWFQpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gdGFyZ2V0O1xuICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IGRlcmVmKGxhYmVsLmZvbnRTaXplKSA/PyAxNjtcbiAgICAgICAgICAgIGlmICghbGFiZWwudGV4dEJhc2VsaW5lKSB7XG4gICAgICAgICAgICAgICAgeSArPSBzaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChsYWJlbC50ZXh0QmFzZWxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgKz0gc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdtaWRkbGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgeSArPSBzaXplIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdhbHBoYWJldGljJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgKz0gc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKHRhcmdldC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuSU1BR0U6XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuUkVDVEFOR0xFOlxuICAgICAgICAgICAgY2FzZSBDb21wb25lbnRUeXBlLlRFWFQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICh4ID49IHRhcmdldC5yZW5kZXJlZFN0YXRlLnggJiZcbiAgICAgICAgICAgICAgICAgICAgeSA+PSB0YXJnZXQucmVuZGVyZWRTdGF0ZS55ICYmXG4gICAgICAgICAgICAgICAgICAgIHggPD0gdGFyZ2V0LnJlbmRlcmVkU3RhdGUueCArIHRhcmdldC5yZW5kZXJlZFN0YXRlLndpZHRoICogKHByb3BzLnNjYWxlPy52YWx1ZS54ID8/IDEpICYmXG4gICAgICAgICAgICAgICAgICAgIHkgPD0gdGFyZ2V0LnJlbmRlcmVkU3RhdGUueSArIHRhcmdldC5yZW5kZXJlZFN0YXRlLmhlaWdodCAqIChwcm9wcy5zY2FsZT8udmFsdWUueSA/PyAxKSk7XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuRUxJUFNFOlxuICAgICAgICAgICAgY2FzZSBDb21wb25lbnRUeXBlLlJFR1VMQVJfUE9MWUdPTjpcbiAgICAgICAgICAgICAgICBpZiAoIXRhcmdldC5yZW5kZXJlZFN0YXRlLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuaXNQb2ludEluUGF0aCh0YXJnZXQucmVuZGVyZWRTdGF0ZS5wYXRoLCB4LCB5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0LnJlbmRlcmVkU3RhdGUucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5pc1BvaW50SW5QYXRoKHRhcmdldC5yZW5kZXJlZFN0YXRlLnBhdGgsIHggLSB0YXJnZXQucmVuZGVyZWRTdGF0ZS54LCB5IC0gdGFyZ2V0LnJlbmRlcmVkU3RhdGUueSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGJpbmQoY2FudmFzLCBjaGlsZHJlbiwgcGFyZW50LCBjYW5jZWxsYXRpb25Ub2tlbikge1xuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBBcnJheURhdGFTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBjaGlsZC5saXN0ZW4oKCkgPT4gaW52YWxpZGF0ZShjYW52YXMpLCBjYW5jZWxsYXRpb25Ub2tlbik7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW5NYXAgPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICAgICAgY2hpbGQubGlzdGVuQW5kUmVwZWF0KChjaGFuZ2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjaGFuZ2Uub3BlcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBjaGFuZ2UuaXRlbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5NYXAuc2V0KGl0ZW0sIG5ldyBDYW5jZWxsYXRpb25Ub2tlbigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZER5bmFtaWNFbnRpdHkoaXRlbSwgY2hpbGQsIHRva2VuTWFwLmdldChpdGVtKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVtb3ZlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2hhbmdlLml0ZW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuTWFwLmdldChpdGVtKS5jYW5jZWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5NYXAuZGVsZXRlKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JlcGxhY2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuTWFwLmdldChjaGFuZ2UudGFyZ2V0KS5jYW5jZWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbk1hcC5kZWxldGUoY2hhbmdlLnRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5NYXAuc2V0KGNoYW5nZS5pdGVtc1swXSwgbmV3IENhbmNlbGxhdGlvblRva2VuKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmREeW5hbWljRW50aXR5KGNoYW5nZS5pdGVtc1swXSwgY2hpbGQsIHRva2VuTWFwLmdldChjaGFuZ2UuaXRlbXNbMF0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N3YXAnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWVyZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignT3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgRGF0YVNvdXJjZSB8fCBjaGlsZCBpbnN0YW5jZW9mIER1cGxleERhdGFTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBjaGlsZC5saXN0ZW4oKCkgPT4gaW52YWxpZGF0ZShjYW52YXMpLCBjYW5jZWxsYXRpb25Ub2tlbik7XG4gICAgICAgICAgICAgICAgbGV0IGJpbmRUb2tlbjtcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgICAgICAgY2hpbGQubGlzdGVuQW5kUmVwZWF0KChuZXdWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpbmRUb2tlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRUb2tlbi5jYW5jZWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRUb2tlbiA9IG5ldyBDYW5jZWxsYXRpb25Ub2tlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYmluZER5bmFtaWNFbnRpdHkodmFsdWUsIGNoaWxkLCBiaW5kVG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2hpbGRbc3RhdGVTeW1ib2xdKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgdXNlIDxTdGF0ZT4gbm9kZXMgYXQgcm9vdCBsZXZlbCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwYXJlbnQuYW5pbWF0aW9ucy5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgnb25Nb3VzZUVudGVyJyBpbiBjaGlsZCB8fCAnb25Nb3VzZUxlYXZlJyBpbiBjaGlsZCkge1xuICAgICAgICAgICAgICAgIGxldCBpc0luc2lkZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG9uTW91c2VNb3ZlLnN1YnNjcmliZSgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNPblRvcE9mKGUsIGNoaWxkLCBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNJbnNpZGUgJiYgY2hpbGQub25Nb3VzZUVudGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQub25Nb3VzZUVudGVyKGUsIGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSW5zaWRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0luc2lkZSAmJiBjaGlsZC5vbk1vdXNlTGVhdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5vbk1vdXNlTGVhdmUoZSwgY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJbnNpZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGNhbmNlbGxhdGlvblRva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ29uTW91c2VVcCcpIHtcbiAgICAgICAgICAgICAgICAgICAgb25Nb3VzZVVwLnN1YnNjcmliZSgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzT25Ub3BPZihlLCBjaGlsZCwgY2FudmFzLmdldENvbnRleHQoJzJkJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQub25Nb3VzZVVwKGUsIGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgY2FuY2VsbGF0aW9uVG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ29uTW91c2VEb3duJykge1xuICAgICAgICAgICAgICAgICAgICBvbk1vdXNlVXAuc3Vic2NyaWJlKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNPblRvcE9mKGUsIGNoaWxkLCBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5vbk1vdXNlVXAoZSwgY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCBjYW5jZWxsYXRpb25Ub2tlbik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnb25Nb3VzZUNsaWNrJykge1xuICAgICAgICAgICAgICAgICAgICBvbk1vdXNlVXAuc3Vic2NyaWJlKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNPblRvcE9mKGUsIGNoaWxkLCBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5vbk1vdXNlQ2xpY2soZSwgY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCBjYW5jZWxsYXRpb25Ub2tlbik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRba2V5XSBpbnN0YW5jZW9mIERhdGFTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gY2hpbGRba2V5XS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxhc3RTdGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3N0YXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkZXJlZihjaGlsZFtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RTdGF0ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuYW5pbWF0aW9uU3RhdGVzID0gY2hpbGQuYW5pbWF0aW9ucy5maWx0ZXIoKGUpID0+IGUuaWQgPT09IHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLmFuaW1hdGlvblRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkW2tleV0ubGlzdGVuKChuZXdWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3N0YXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFN0YXRlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFN0YXRlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5hbmltYXRpb25TdGF0ZXMgPSBjaGlsZC5hbmltYXRpb25zLmZpbHRlcigoZSkgPT4gZS5pZCA9PT0gbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuYW5pbWF0aW9uVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkYXRlKGNhbnZhcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludmFsaWRhdGUoY2FudmFzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIGNhbmNlbGxhdGlvblRva2VuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBiaW5kKGNhbnZhcywgY2hpbGQuY2hpbGRyZW4sIGNoaWxkLCBjYW5jZWxsYXRpb25Ub2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gYmluZER5bmFtaWNFbnRpdHkodmFsdWUsIHBhcmVudCwgYmluZFRva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhcnJheWVkVmFsdWUgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlXTtcbiAgICAgICAgICAgIGNvbnN0IGxjID0gY3JlYXRlTGlmZUN5Y2xlKCk7XG4gICAgICAgICAgICBjb25zdCByZW5kZXJSZXN1bHQgPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcGllY2Ugb2YgYXJyYXllZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwaWVjZSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZW5kZXJDYWNoZS5oYXMocGllY2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlckNhY2hlLnNldChwaWVjZSwgYXBpLnByZXJlbmRlcihwaWVjZSwgbGMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVuZGVyUmVzdWx0LnB1c2gocmVuZGVyQ2FjaGUuZ2V0KHBpZWNlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBiaW5kKGNhbnZhcywgcmVuZGVyUmVzdWx0LCBwYXJlbnQsIGJpbmRUb2tlbik7XG4gICAgICAgICAgICBsYy5vbkF0dGFjaCgpO1xuICAgICAgICAgICAgYmluZFRva2VuLmFkZENhbmNlbGFibGUoKCkgPT4gbGMub25EZXRhY2goKSk7XG4gICAgICAgICAgICBpbnZhbGlkYXRlKGNhbnZhcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gaW52YWxpZGF0ZShjYW52YXMpIHtcbiAgICAgICAgaWYgKCFwZW5kaW5nUmVyZW5kZXIpIHtcbiAgICAgICAgICAgIHBlbmRpbmdSZXJlbmRlciA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgcGVuZGluZ1JlcmVuZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChjYW52YXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyKGNhbnZhcywgY29tcG9uZW50cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gcmVuZGVyKGNhbnZhcywgY29tcG9uZW50cykge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIGlmIChwcm9wcy5iYWNrZ3JvdW5kQ29sb3IgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gZGVyZWYocHJvcHMuYmFja2dyb3VuZENvbG9yKTtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBhcHBseUNvbnRleHRUcmFuc2Zvcm1hdGlvbihjb250ZXh0KTtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjb21wb25lbnRzKSB7XG4gICAgICAgICAgICByZW5kZXJDaGlsZChjb250ZXh0LCBjaGlsZCwgMCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgdW5hcHBseUNvbnRleHRUcmFuc2Zvcm1hdGlvbihjb250ZXh0KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdW5hcHBseUNvbnRleHRUcmFuc2Zvcm1hdGlvbihjb250ZXh0KSB7XG4gICAgICAgIGlmIChwcm9wcy5zY2FsZSB8fCBwcm9wcy50cmFuc2xhdGUpIHtcbiAgICAgICAgICAgIGNvbnRleHQucmVzdG9yZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFwcGx5Q29udGV4dFRyYW5zZm9ybWF0aW9uKGNvbnRleHQpIHtcbiAgICAgICAgaWYgKHByb3BzLnNjYWxlIHx8IHByb3BzLnRyYW5zbGF0ZSkge1xuICAgICAgICAgICAgY29udGV4dC5zYXZlKCk7XG4gICAgICAgICAgICBpZiAocHJvcHMuc2NhbGU/LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5zY2FsZShwcm9wcy5zY2FsZS52YWx1ZS54LCBwcm9wcy5zY2FsZS52YWx1ZS55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwcm9wcy50cmFuc2xhdGU/LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC50cmFuc2xhdGUocHJvcHMudHJhbnNsYXRlLnZhbHVlLngsIHByb3BzLnRyYW5zbGF0ZS52YWx1ZS55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiByZW5kZXJDaGlsZChjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSkge1xuICAgICAgICBpZiAoY2hpbGQgPT09IHVuZGVmaW5lZCB8fCBjaGlsZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyQ2hpbGQoY29udGV4dCwgaXRlbSwgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoaWxkW3N0YXRlU3ltYm9sXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGlsZFthdXJ1bUVsZW1lbnRNb2RlbElkZW50aXRpeV0pIHtcbiAgICAgICAgICAgIGlmICghcmVuZGVyQ2FjaGUuaGFzKGNoaWxkKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaWxsZWdhbCBzdGF0ZTogdW5yZW5kZXJlZCBhdXJ1bSBlbGVtZW50IG1hZGUgaXQgaW50byB0aGUgY2FudmFzIHJlbmRlciBwaGFzZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2hpbGQgPSByZW5kZXJDYWNoZS5nZXQoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIEFycmF5RGF0YVNvdXJjZSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIGNoaWxkLmdldERhdGEoKSkge1xuICAgICAgICAgICAgICAgIHJlbmRlckNoaWxkKGNvbnRleHQsIG5vZGUsIG9mZnNldFgsIG9mZnNldFkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIERhdGFTb3VyY2UgfHwgY2hpbGQgaW5zdGFuY2VvZiBEdXBsZXhEYXRhU291cmNlKSB7XG4gICAgICAgICAgICByZW5kZXJDaGlsZChjb250ZXh0LCBjaGlsZC52YWx1ZSwgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29udGV4dC5zYXZlKCk7XG4gICAgICAgIGxldCBpZGxlO1xuICAgICAgICBzd2l0Y2ggKGNoaWxkLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQ29tcG9uZW50VHlwZS5QQVRIOlxuICAgICAgICAgICAgICAgIGlkbGUgPSByZW5kZXJQYXRoKGNvbnRleHQsIGNoaWxkLCBvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQ29tcG9uZW50VHlwZS5SRUdVTEFSX1BPTFlHT046XG4gICAgICAgICAgICAgICAgaWRsZSA9IHJlbmRlclJlZ3VsYXJQb2x5Z29uKGNvbnRleHQsIGNoaWxkLCBvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQ29tcG9uZW50VHlwZS5SRUNUQU5HTEU6XG4gICAgICAgICAgICAgICAgaWRsZSA9IHJlbmRlclJlY3RhbmdsZShjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuVEVYVDpcbiAgICAgICAgICAgICAgICBpZGxlID0gcmVuZGVyVGV4dChjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuTElORTpcbiAgICAgICAgICAgICAgICBpZGxlID0gcmVuZGVyTGluZShjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuUVVBRFJBVElDX0NVUlZFOlxuICAgICAgICAgICAgICAgIGlkbGUgPSByZW5kZXJRdWFkcmF0aWNDdXJ2ZShjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuQkVaSUVSX0NVUlZFOlxuICAgICAgICAgICAgICAgIGlkbGUgPSByZW5kZXJCZXppZXJDdXJ2ZShjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuRUxJUFNFOlxuICAgICAgICAgICAgICAgIGlkbGUgPSByZW5kZXJFbGlwc2UoY29udGV4dCwgY2hpbGQsIG9mZnNldFgsIG9mZnNldFkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBDb21wb25lbnRUeXBlLkdST1VQOlxuICAgICAgICAgICAgICAgIGlkbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaWRsZSkge1xuICAgICAgICAgICAgaW52YWxpZGF0ZShjb250ZXh0LmNhbnZhcyk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBzdWJDaGlsZCBvZiBjaGlsZC5jaGlsZHJlbikge1xuICAgICAgICAgICAgcmVuZGVyQ2hpbGQoY29udGV4dCwgc3ViQ2hpbGQsIGRlcmVmKGNoaWxkLngpICsgb2Zmc2V0WCwgZGVyZWYoY2hpbGQueSkgKyBvZmZzZXRZKTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0LnJlc3RvcmUoKTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYW52YXMuanMubWFwIiwiZXhwb3J0IHZhciBDb21wb25lbnRUeXBlO1xuKGZ1bmN0aW9uIChDb21wb25lbnRUeXBlKSB7XG4gICAgQ29tcG9uZW50VHlwZVtDb21wb25lbnRUeXBlW1wiUkVDVEFOR0xFXCJdID0gMF0gPSBcIlJFQ1RBTkdMRVwiO1xuICAgIENvbXBvbmVudFR5cGVbQ29tcG9uZW50VHlwZVtcIkVMSVBTRVwiXSA9IDFdID0gXCJFTElQU0VcIjtcbiAgICBDb21wb25lbnRUeXBlW0NvbXBvbmVudFR5cGVbXCJMSU5FXCJdID0gMl0gPSBcIkxJTkVcIjtcbiAgICBDb21wb25lbnRUeXBlW0NvbXBvbmVudFR5cGVbXCJURVhUXCJdID0gM10gPSBcIlRFWFRcIjtcbiAgICBDb21wb25lbnRUeXBlW0NvbXBvbmVudFR5cGVbXCJJTUFHRVwiXSA9IDRdID0gXCJJTUFHRVwiO1xuICAgIENvbXBvbmVudFR5cGVbQ29tcG9uZW50VHlwZVtcIkdST1VQXCJdID0gNV0gPSBcIkdST1VQXCI7XG4gICAgQ29tcG9uZW50VHlwZVtDb21wb25lbnRUeXBlW1wiU1RBVEVcIl0gPSA2XSA9IFwiU1RBVEVcIjtcbiAgICBDb21wb25lbnRUeXBlW0NvbXBvbmVudFR5cGVbXCJQQVRIXCJdID0gN10gPSBcIlBBVEhcIjtcbiAgICBDb21wb25lbnRUeXBlW0NvbXBvbmVudFR5cGVbXCJRVUFEUkFUSUNfQ1VSVkVcIl0gPSA4XSA9IFwiUVVBRFJBVElDX0NVUlZFXCI7XG4gICAgQ29tcG9uZW50VHlwZVtDb21wb25lbnRUeXBlW1wiQkVaSUVSX0NVUlZFXCJdID0gOV0gPSBcIkJFWklFUl9DVVJWRVwiO1xuICAgIENvbXBvbmVudFR5cGVbQ29tcG9uZW50VHlwZVtcIlJFR1VMQVJfUE9MWUdPTlwiXSA9IDEwXSA9IFwiUkVHVUxBUl9QT0xZR09OXCI7XG59KShDb21wb25lbnRUeXBlIHx8IChDb21wb25lbnRUeXBlID0ge30pKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbXBvbmVudF9tb2RlbC5qcy5tYXAiLCJpbXBvcnQgeyBjcmVhdGVMaWZlQ3ljbGUgfSBmcm9tICdhdXJ1bWpzJztcbmltcG9ydCB7IENvbXBvbmVudFR5cGUgfSBmcm9tICcuLi9jb21wb25lbnRfbW9kZWwuanMnO1xuZXhwb3J0IGZ1bmN0aW9uIEF1cnVtRWxpcHNlKHByb3BzLCBjaGlsZHJlbiwgYXBpKSB7XG4gICAgY29uc3QgbGMgPSBjcmVhdGVMaWZlQ3ljbGUoKTtcbiAgICBhcGkuc3luY2hyb25pemVMaWZlQ3ljbGUobGMpO1xuICAgIGlmIChwcm9wcy5vbkF0dGFjaCkge1xuICAgICAgICBhcGkub25BdHRhY2goKCkgPT4gcHJvcHMub25BdHRhY2goKSk7XG4gICAgfVxuICAgIGlmIChwcm9wcy5vbkRldGFjaCkge1xuICAgICAgICBhcGkub25EZXRhY2goKCkgPT4gcHJvcHMub25EZXRhY2goKSk7XG4gICAgfVxuICAgIGNvbnN0IGNvbXBvbmVudHMgPSBhcGkucHJlcmVuZGVyKGNoaWxkcmVuLCBsYykuZmlsdGVyKChjKSA9PiAhIWMpO1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLnByb3BzLFxuICAgICAgICBvcGFjaXR5OiBwcm9wcy5vcGFjaXR5ID8/IDEsXG4gICAgICAgIHJlbmRlcmVkU3RhdGU6IHVuZGVmaW5lZCxcbiAgICAgICAgY2hpbGRyZW46IGNvbXBvbmVudHMsXG4gICAgICAgIGFuaW1hdGlvbnM6IFtdLFxuICAgICAgICB0eXBlOiBDb21wb25lbnRUeXBlLkVMSVBTRVxuICAgIH07XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXJ1bV9lbGlwc2UuanMubWFwIiwiaW1wb3J0IHsgY3JlYXRlTGlmZUN5Y2xlIH0gZnJvbSAnYXVydW1qcyc7XG5pbXBvcnQgeyBDb21wb25lbnRUeXBlIH0gZnJvbSAnLi4vY29tcG9uZW50X21vZGVsLmpzJztcbmV4cG9ydCBmdW5jdGlvbiBBdXJ1bUdyb3VwKHByb3BzLCBjaGlsZHJlbiwgYXBpKSB7XG4gICAgY29uc3QgbGMgPSBjcmVhdGVMaWZlQ3ljbGUoKTtcbiAgICBhcGkuc3luY2hyb25pemVMaWZlQ3ljbGUobGMpO1xuICAgIGlmIChwcm9wcy5vbkF0dGFjaCkge1xuICAgICAgICBhcGkub25BdHRhY2goKCkgPT4gcHJvcHMub25BdHRhY2goKSk7XG4gICAgfVxuICAgIGlmIChwcm9wcy5vbkRldGFjaCkge1xuICAgICAgICBhcGkub25EZXRhY2goKCkgPT4gcHJvcHMub25EZXRhY2goKSk7XG4gICAgfVxuICAgIHByb3BzLnggPz89IDA7XG4gICAgcHJvcHMueSA/Pz0gMDtcbiAgICBjb25zdCBjb21wb25lbnRzID0gYXBpLnByZXJlbmRlcihjaGlsZHJlbiwgbGMpLmZpbHRlcigoYykgPT4gISFjKTtcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgcmVuZGVyZWRTdGF0ZTogdW5kZWZpbmVkLFxuICAgICAgICBjaGlsZHJlbjogY29tcG9uZW50cyxcbiAgICAgICAgYW5pbWF0aW9uczogW10sXG4gICAgICAgIHR5cGU6IENvbXBvbmVudFR5cGUuR1JPVVBcbiAgICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVydW1fZ3JvdXAuanMubWFwIiwiaW1wb3J0IHsgY3JlYXRlTGlmZUN5Y2xlIH0gZnJvbSAnYXVydW1qcyc7XG5pbXBvcnQgeyBDb21wb25lbnRUeXBlIH0gZnJvbSAnLi4vY29tcG9uZW50X21vZGVsLmpzJztcbmV4cG9ydCBmdW5jdGlvbiBBdXJ1bUltYWdlKHByb3BzLCBjaGlsZHJlbiwgYXBpKSB7XG4gICAgY29uc3QgbGMgPSBjcmVhdGVMaWZlQ3ljbGUoKTtcbiAgICBhcGkuc3luY2hyb25pemVMaWZlQ3ljbGUobGMpO1xuICAgIGlmIChwcm9wcy5vbkF0dGFjaCkge1xuICAgICAgICBhcGkub25BdHRhY2goKCkgPT4gcHJvcHMub25BdHRhY2goKSk7XG4gICAgfVxuICAgIGlmIChwcm9wcy5vbkRldGFjaCkge1xuICAgICAgICBhcGkub25EZXRhY2goKCkgPT4gcHJvcHMub25EZXRhY2goKSk7XG4gICAgfVxuICAgIGNvbnN0IGNvbXBvbmVudHMgPSBhcGkucHJlcmVuZGVyKGNoaWxkcmVuLCBsYykuZmlsdGVyKChjKSA9PiAhIWMpO1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLnByb3BzLFxuICAgICAgICBvcGFjaXR5OiBwcm9wcy5vcGFjaXR5ID8/IDEsXG4gICAgICAgIHJlbmRlcmVkU3RhdGU6IHVuZGVmaW5lZCxcbiAgICAgICAgY2hpbGRyZW46IGNvbXBvbmVudHMsXG4gICAgICAgIGFuaW1hdGlvbnM6IFtdLFxuICAgICAgICB0eXBlOiBDb21wb25lbnRUeXBlLklNQUdFXG4gICAgfTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1cnVtX2ltYWdlLmpzLm1hcCIsImltcG9ydCB7IGNyZWF0ZUxpZmVDeWNsZSB9IGZyb20gJ2F1cnVtanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50VHlwZSB9IGZyb20gJy4uL2NvbXBvbmVudF9tb2RlbC5qcyc7XG5leHBvcnQgZnVuY3Rpb24gQXVydW1MaW5lKHByb3BzLCBjaGlsZHJlbiwgYXBpKSB7XG4gICAgY29uc3QgbGMgPSBjcmVhdGVMaWZlQ3ljbGUoKTtcbiAgICBhcGkuc3luY2hyb25pemVMaWZlQ3ljbGUobGMpO1xuICAgIGlmIChwcm9wcy5vbkF0dGFjaCkge1xuICAgICAgICBhcGkub25BdHRhY2goKCkgPT4gcHJvcHMub25BdHRhY2goKSk7XG4gICAgfVxuICAgIGlmIChwcm9wcy5vbkRldGFjaCkge1xuICAgICAgICBhcGkub25EZXRhY2goKCkgPT4gcHJvcHMub25EZXRhY2goKSk7XG4gICAgfVxuICAgIGNvbnN0IGNvbXBvbmVudHMgPSBhcGkucHJlcmVuZGVyKGNoaWxkcmVuLCBsYykuZmlsdGVyKChjKSA9PiAhIWMpO1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLnByb3BzLFxuICAgICAgICBvcGFjaXR5OiBwcm9wcy5vcGFjaXR5ID8/IDEsXG4gICAgICAgIGxpbmVXaWR0aDogcHJvcHMubGluZVdpZHRoID8/IDEsXG4gICAgICAgIHJlbmRlcmVkU3RhdGU6IHVuZGVmaW5lZCxcbiAgICAgICAgY2hpbGRyZW46IGNvbXBvbmVudHMsXG4gICAgICAgIGFuaW1hdGlvbnM6IFtdLFxuICAgICAgICB0eXBlOiBDb21wb25lbnRUeXBlLkxJTkVcbiAgICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVydW1fbGluZS5qcy5tYXAiLCJpbXBvcnQgeyBjcmVhdGVMaWZlQ3ljbGUgfSBmcm9tICdhdXJ1bWpzJztcbmltcG9ydCB7IENvbXBvbmVudFR5cGUgfSBmcm9tICcuLi9jb21wb25lbnRfbW9kZWwuanMnO1xuZXhwb3J0IGZ1bmN0aW9uIEF1cnVtUGF0aChwcm9wcywgY2hpbGRyZW4sIGFwaSkge1xuICAgIGNvbnN0IGxjID0gY3JlYXRlTGlmZUN5Y2xlKCk7XG4gICAgYXBpLnN5bmNocm9uaXplTGlmZUN5Y2xlKGxjKTtcbiAgICBpZiAocHJvcHMub25BdHRhY2gpIHtcbiAgICAgICAgYXBpLm9uQXR0YWNoKCgpID0+IHByb3BzLm9uQXR0YWNoKCkpO1xuICAgIH1cbiAgICBpZiAocHJvcHMub25EZXRhY2gpIHtcbiAgICAgICAgYXBpLm9uRGV0YWNoKCgpID0+IHByb3BzLm9uRGV0YWNoKCkpO1xuICAgIH1cbiAgICBjb25zdCBjb21wb25lbnRzID0gYXBpLnByZXJlbmRlcihjaGlsZHJlbiwgbGMpLmZpbHRlcigoYykgPT4gISFjKTtcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgb3BhY2l0eTogcHJvcHMub3BhY2l0eSA/PyAxLFxuICAgICAgICByZW5kZXJlZFN0YXRlOiB1bmRlZmluZWQsXG4gICAgICAgIGNoaWxkcmVuOiBjb21wb25lbnRzLFxuICAgICAgICBhbmltYXRpb25zOiBbXSxcbiAgICAgICAgdHlwZTogQ29tcG9uZW50VHlwZS5QQVRIXG4gICAgfTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1cnVtX3BhdGguanMubWFwIiwiaW1wb3J0IHsgY3JlYXRlTGlmZUN5Y2xlIH0gZnJvbSAnYXVydW1qcyc7XG5pbXBvcnQgeyBDb21wb25lbnRUeXBlIH0gZnJvbSAnLi4vY29tcG9uZW50X21vZGVsLmpzJztcbmV4cG9ydCBmdW5jdGlvbiBBdXJ1bVJlY3RhbmdsZShwcm9wcywgY2hpbGRyZW4sIGFwaSkge1xuICAgIGNvbnN0IGxjID0gY3JlYXRlTGlmZUN5Y2xlKCk7XG4gICAgYXBpLnN5bmNocm9uaXplTGlmZUN5Y2xlKGxjKTtcbiAgICBpZiAocHJvcHMub25BdHRhY2gpIHtcbiAgICAgICAgYXBpLm9uQXR0YWNoKCgpID0+IHByb3BzLm9uQXR0YWNoKCkpO1xuICAgIH1cbiAgICBpZiAocHJvcHMub25EZXRhY2gpIHtcbiAgICAgICAgYXBpLm9uRGV0YWNoKCgpID0+IHByb3BzLm9uRGV0YWNoKCkpO1xuICAgIH1cbiAgICBjb25zdCBjb21wb25lbnRzID0gYXBpLnByZXJlbmRlcihjaGlsZHJlbiwgbGMpLmZpbHRlcigoYykgPT4gISFjKTtcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgb3BhY2l0eTogcHJvcHMub3BhY2l0eSA/PyAxLFxuICAgICAgICByZW5kZXJlZFN0YXRlOiB1bmRlZmluZWQsXG4gICAgICAgIGNoaWxkcmVuOiBjb21wb25lbnRzLFxuICAgICAgICBhbmltYXRpb25zOiBbXSxcbiAgICAgICAgdHlwZTogQ29tcG9uZW50VHlwZS5SRUNUQU5HTEVcbiAgICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVydW1fcmVjdGFuZ2xlLmpzLm1hcCIsImltcG9ydCB7IGNyZWF0ZUxpZmVDeWNsZSB9IGZyb20gJ2F1cnVtanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50VHlwZSB9IGZyb20gJy4uL2NvbXBvbmVudF9tb2RlbC5qcyc7XG5leHBvcnQgZnVuY3Rpb24gQXVydW1SZWd1bGFyUG9seWdvbihwcm9wcywgY2hpbGRyZW4sIGFwaSkge1xuICAgIGNvbnN0IGxjID0gY3JlYXRlTGlmZUN5Y2xlKCk7XG4gICAgYXBpLnN5bmNocm9uaXplTGlmZUN5Y2xlKGxjKTtcbiAgICBpZiAocHJvcHMub25BdHRhY2gpIHtcbiAgICAgICAgYXBpLm9uQXR0YWNoKCgpID0+IHByb3BzLm9uQXR0YWNoKCkpO1xuICAgIH1cbiAgICBpZiAocHJvcHMub25EZXRhY2gpIHtcbiAgICAgICAgYXBpLm9uRGV0YWNoKCgpID0+IHByb3BzLm9uRGV0YWNoKCkpO1xuICAgIH1cbiAgICBjb25zdCBjb21wb25lbnRzID0gYXBpLnByZXJlbmRlcihjaGlsZHJlbiwgbGMpLmZpbHRlcigoYykgPT4gISFjKTtcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgb3BhY2l0eTogcHJvcHMub3BhY2l0eSA/PyAxLFxuICAgICAgICByZW5kZXJlZFN0YXRlOiB1bmRlZmluZWQsXG4gICAgICAgIGNoaWxkcmVuOiBjb21wb25lbnRzLFxuICAgICAgICBhbmltYXRpb25zOiBbXSxcbiAgICAgICAgdHlwZTogQ29tcG9uZW50VHlwZS5SRUdVTEFSX1BPTFlHT05cbiAgICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVydW1fcmVndWxhcl9wb2x5Z29uLmpzLm1hcCIsImltcG9ydCB7IGNyZWF0ZUxpZmVDeWNsZSwgRGF0YVNvdXJjZSwgZHNVbmlxdWUgfSBmcm9tICdhdXJ1bWpzJztcbmltcG9ydCB7IENvbXBvbmVudFR5cGUgfSBmcm9tICcuLi9jb21wb25lbnRfbW9kZWwuanMnO1xuZXhwb3J0IGZ1bmN0aW9uIEF1cnVtVGV4dChwcm9wcywgY2hpbGRyZW4sIGFwaSkge1xuICAgIGNvbnN0IGxjID0gY3JlYXRlTGlmZUN5Y2xlKCk7XG4gICAgYXBpLnN5bmNocm9uaXplTGlmZUN5Y2xlKGxjKTtcbiAgICBpZiAocHJvcHMub25BdHRhY2gpIHtcbiAgICAgICAgYXBpLm9uQXR0YWNoKCgpID0+IHByb3BzLm9uQXR0YWNoKCkpO1xuICAgIH1cbiAgICBpZiAocHJvcHMub25EZXRhY2gpIHtcbiAgICAgICAgYXBpLm9uRGV0YWNoKCgpID0+IHByb3BzLm9uRGV0YWNoKCkpO1xuICAgIH1cbiAgICBjb25zdCBjb250ZW50ID0gYXBpLnByZXJlbmRlcihjaGlsZHJlbiwgbGMpLmZpbHRlcigoYykgPT4gISFjKTtcbiAgICBjb25zdCB0ZXh0ID0gbmV3IERhdGFTb3VyY2UoJycpO1xuICAgIGlmIChwcm9wcy5mb250IGluc3RhbmNlb2YgRGF0YVNvdXJjZSkge1xuICAgICAgICBwcm9wcy5mb250Lmxpc3RlbigoKSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnJlbmRlcmVkU3RhdGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucmVuZGVyZWRTdGF0ZS5saW5lcyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhcGkuY2FuY2VsbGF0aW9uVG9rZW4pO1xuICAgIH1cbiAgICBpZiAocHJvcHMuZm9udFdlaWdodCBpbnN0YW5jZW9mIERhdGFTb3VyY2UpIHtcbiAgICAgICAgcHJvcHMuZm9udFdlaWdodC5saXN0ZW4oKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5yZW5kZXJlZFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVkU3RhdGUubGluZXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYXBpLmNhbmNlbGxhdGlvblRva2VuKTtcbiAgICB9XG4gICAgaWYgKHByb3BzLmZvbnRTaXplIGluc3RhbmNlb2YgRGF0YVNvdXJjZSkge1xuICAgICAgICBwcm9wcy5mb250U2l6ZS5saXN0ZW4oKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5yZW5kZXJlZFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVkU3RhdGUubGluZXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYXBpLmNhbmNlbGxhdGlvblRva2VuKTtcbiAgICB9XG4gICAgaWYgKHByb3BzLndpZHRoIGluc3RhbmNlb2YgRGF0YVNvdXJjZSkge1xuICAgICAgICBwcm9wcy53aWR0aC5saXN0ZW4oKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5yZW5kZXJlZFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlbmRlcmVkU3RhdGUubGluZXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYXBpLmNhbmNlbGxhdGlvblRva2VuKTtcbiAgICB9XG4gICAgaWYgKHByb3BzLndyYXBXaWR0aCBpbnN0YW5jZW9mIERhdGFTb3VyY2UpIHtcbiAgICAgICAgcHJvcHMud3JhcFdpZHRoLmxpc3RlbigoKSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnJlbmRlcmVkU3RhdGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucmVuZGVyZWRTdGF0ZS5saW5lcyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhcGkuY2FuY2VsbGF0aW9uVG9rZW4pO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGkgb2YgY29udGVudCkge1xuICAgICAgICBpZiAoaSBpbnN0YW5jZW9mIERhdGFTb3VyY2UpIHtcbiAgICAgICAgICAgIGkudHJhbnNmb3JtKGRzVW5pcXVlKCksIGFwaS5jYW5jZWxsYXRpb25Ub2tlbikubGlzdGVuKCh2KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5yZW5kZXJlZFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZW5kZXJlZFN0YXRlLmxpbmVzID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVwZGF0ZVRleHQodGV4dCwgY29udGVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVUZXh0KHRleHQsIGNvbnRlbnQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgIG9wYWNpdHk6IHByb3BzLm9wYWNpdHkgPz8gMSxcbiAgICAgICAgcmVuZGVyZWRTdGF0ZTogdW5kZWZpbmVkLFxuICAgICAgICB0ZXh0LFxuICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgIGFuaW1hdGlvbnM6IFtdLFxuICAgICAgICB0eXBlOiBDb21wb25lbnRUeXBlLlRFWFRcbiAgICB9O1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiB1cGRhdGVUZXh0KHRleHQsIGNvbnRlbnQpIHtcbiAgICB0ZXh0LnVwZGF0ZShjb250ZW50LnJlZHVjZSgocCwgYykgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIGMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7cH0ke2N9YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3B9JHtjLnZhbHVlfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sICcnKSk7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXJ1bV90ZXh0LmpzLm1hcCIsImltcG9ydCB7IGNyZWF0ZUxpZmVDeWNsZSB9IGZyb20gJ2F1cnVtanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50VHlwZSB9IGZyb20gJy4uL2NvbXBvbmVudF9tb2RlbC5qcyc7XG5leHBvcnQgY29uc3Qgc3RhdGVTeW1ib2wgPSBTeW1ib2woJ3N0YXRlJyk7XG5leHBvcnQgZnVuY3Rpb24gU3RhdGUocHJvcHMsIGNoaWxkcmVuLCBhcGkpIHtcbiAgICBjb25zdCBsYyA9IGNyZWF0ZUxpZmVDeWNsZSgpO1xuICAgIGFwaS5zeW5jaHJvbml6ZUxpZmVDeWNsZShsYyk7XG4gICAgY29uc3QgY29tcG9uZW50cyA9IGFwaS5wcmVyZW5kZXIoY2hpbGRyZW4sIGxjKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBbc3RhdGVTeW1ib2xdOiB0cnVlLFxuICAgICAgICB4OiB1bmRlZmluZWQsXG4gICAgICAgIHk6IHVuZGVmaW5lZCxcbiAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgIHJlbmRlcmVkU3RhdGU6IHVuZGVmaW5lZCxcbiAgICAgICAgYW5pbWF0aW9uczogW10sXG4gICAgICAgIGNoaWxkcmVuOiBjb21wb25lbnRzLFxuICAgICAgICB0eXBlOiBDb21wb25lbnRUeXBlLlNUQVRFXG4gICAgfTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0YXRlLmpzLm1hcCIsImltcG9ydCB7IENhbmNlbGxhdGlvblRva2VuIH0gZnJvbSAnYXVydW1qcyc7XG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZUtleWJvYXJkUGFubmluZ0ZlYXR1cmUocHJvcHMsIGNhbnZhcykge1xuICAgIGxldCBtb3ZlVG9rZW47XG4gICAgY29uc3Qga2V5RG93biA9IG5ldyBTZXQoKTtcbiAgICBjb25zdCBtb3ZlVmVjdG9yID0ge1xuICAgICAgICB4OiAwLFxuICAgICAgICB5OiAwXG4gICAgfTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZSkgPT4ge1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBwcm9wcy5mZWF0dXJlcy5wYW5uaW5nLmtleWJvYXJkLmxlZnRLZXlDb2RlIHx8IGUua2V5Q29kZSA9PT0gcHJvcHMuZmVhdHVyZXMucGFubmluZy5rZXlib2FyZC5yaWdodEtleUNvZGUpIHtcbiAgICAgICAgICAgIG1vdmVWZWN0b3IueCA9IDA7XG4gICAgICAgICAgICBrZXlEb3duLmRlbGV0ZShlLmtleUNvZGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IHByb3BzLmZlYXR1cmVzLnBhbm5pbmcua2V5Ym9hcmQudXBLZXlDb2RlIHx8IGUua2V5Q29kZSA9PT0gcHJvcHMuZmVhdHVyZXMucGFubmluZy5rZXlib2FyZC5kb3duS2V5Q29kZSkge1xuICAgICAgICAgICAgbW92ZVZlY3Rvci55ID0gMDtcbiAgICAgICAgICAgIGtleURvd24uZGVsZXRlKGUua2V5Q29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vdmVUb2tlbiAmJiBrZXlEb3duLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgIG1vdmVUb2tlbi5jYW5jZWwoKTtcbiAgICAgICAgICAgIG1vdmVUb2tlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gcHJvcHMuZmVhdHVyZXMucGFubmluZy5rZXlib2FyZC5sZWZ0S2V5Q29kZSkge1xuICAgICAgICAgICAgbW92ZVZlY3Rvci54ID0gcHJvcHMuZmVhdHVyZXMucGFubmluZy5rZXlib2FyZC5waXhlbHNQZXJGcmFtZTtcbiAgICAgICAgICAgIGtleURvd24uYWRkKGUua2V5Q29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gcHJvcHMuZmVhdHVyZXMucGFubmluZy5rZXlib2FyZC5kb3duS2V5Q29kZSkge1xuICAgICAgICAgICAgbW92ZVZlY3Rvci55ID0gLXByb3BzLmZlYXR1cmVzLnBhbm5pbmcua2V5Ym9hcmQucGl4ZWxzUGVyRnJhbWU7XG4gICAgICAgICAgICBrZXlEb3duLmFkZChlLmtleUNvZGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IHByb3BzLmZlYXR1cmVzLnBhbm5pbmcua2V5Ym9hcmQucmlnaHRLZXlDb2RlKSB7XG4gICAgICAgICAgICBtb3ZlVmVjdG9yLnggPSAtcHJvcHMuZmVhdHVyZXMucGFubmluZy5rZXlib2FyZC5waXhlbHNQZXJGcmFtZTtcbiAgICAgICAgICAgIGtleURvd24uYWRkKGUua2V5Q29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gcHJvcHMuZmVhdHVyZXMucGFubmluZy5rZXlib2FyZC51cEtleUNvZGUpIHtcbiAgICAgICAgICAgIG1vdmVWZWN0b3IueSA9IHByb3BzLmZlYXR1cmVzLnBhbm5pbmcua2V5Ym9hcmQucGl4ZWxzUGVyRnJhbWU7XG4gICAgICAgICAgICBrZXlEb3duLmFkZChlLmtleUNvZGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbW92ZVRva2VuICYmIGtleURvd24uc2l6ZSA+IDApIHtcbiAgICAgICAgICAgIG1vdmVUb2tlbiA9IG5ldyBDYW5jZWxsYXRpb25Ub2tlbigpO1xuICAgICAgICAgICAgbW92ZVRva2VuLmFuaW1hdGlvbkxvb3AoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHByb3BzLnRyYW5zbGF0ZS51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB4OiBwcm9wcy50cmFuc2xhdGUudmFsdWUueCArIG1vdmVWZWN0b3IueCxcbiAgICAgICAgICAgICAgICAgICAgeTogcHJvcHMudHJhbnNsYXRlLnZhbHVlLnkgKyBtb3ZlVmVjdG9yLnlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZU1vdXNlUGFubmluZ0ZlYXR1cmUocHJvcHMsIGNhbnZhcykge1xuICAgIGxldCBkb3duWDtcbiAgICBsZXQgZG93blk7XG4gICAgbGV0IGJlZm9yZVg7XG4gICAgbGV0IGJlZm9yZVk7XG4gICAgbGV0IGRvd24gPSBmYWxzZTtcbiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHtcbiAgICAgICAgZG93blggPSBlLmNsaWVudFg7XG4gICAgICAgIGRvd25ZID0gZS5jbGllbnRZO1xuICAgICAgICBiZWZvcmVYID0gcHJvcHMudHJhbnNsYXRlLnZhbHVlLng7XG4gICAgICAgIGJlZm9yZVkgPSBwcm9wcy50cmFuc2xhdGUudmFsdWUueTtcbiAgICAgICAgZG93biA9IHRydWU7XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGRvd24pIHtcbiAgICAgICAgICAgIHByb3BzLnRyYW5zbGF0ZS51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHg6IGJlZm9yZVggLSAoZG93blggLSBlLmNsaWVudFgpIC8gcHJvcHMuc2NhbGUudmFsdWUueCxcbiAgICAgICAgICAgICAgICB5OiBiZWZvcmVZIC0gKGRvd25ZIC0gZS5jbGllbnRZKSAvIHByb3BzLnNjYWxlLnZhbHVlLnlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChlKSA9PiB7XG4gICAgICAgIGRvd24gPSBmYWxzZTtcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplWm9vbUZlYXR1cmUocHJvcHMsIGNhbnZhcykge1xuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIChlKSA9PiB7XG4gICAgICAgIGlmIChlLmRlbHRhWSA+IDApIHtcbiAgICAgICAgICAgIGlmIChwcm9wcy5zY2FsZS52YWx1ZS54IDwgcHJvcHMuZmVhdHVyZXMubW91c2VXaGVlbFpvb20ubWluWm9vbSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb3BzLnRyYW5zbGF0ZS51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHg6IHByb3BzLnRyYW5zbGF0ZS52YWx1ZS54ICsgKGUub2Zmc2V0WCAqIChwcm9wcy5mZWF0dXJlcy5tb3VzZVdoZWVsWm9vbS56b29tSW5jcmVtZW50cyAtIDEpKSAvIHByb3BzLnNjYWxlLnZhbHVlLngsXG4gICAgICAgICAgICAgICAgeTogcHJvcHMudHJhbnNsYXRlLnZhbHVlLnkgKyAoZS5vZmZzZXRZICogKHByb3BzLmZlYXR1cmVzLm1vdXNlV2hlZWxab29tLnpvb21JbmNyZW1lbnRzIC0gMSkpIC8gcHJvcHMuc2NhbGUudmFsdWUueVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBwcm9wcy5zY2FsZS51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHg6IHByb3BzLnNjYWxlLnZhbHVlLnggLyBwcm9wcy5mZWF0dXJlcy5tb3VzZVdoZWVsWm9vbS56b29tSW5jcmVtZW50cyxcbiAgICAgICAgICAgICAgICB5OiBwcm9wcy5zY2FsZS52YWx1ZS55IC8gcHJvcHMuZmVhdHVyZXMubW91c2VXaGVlbFpvb20uem9vbUluY3JlbWVudHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHByb3BzLnNjYWxlLnZhbHVlLnggPiBwcm9wcy5mZWF0dXJlcy5tb3VzZVdoZWVsWm9vbS5tYXhab29tKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHJvcHMuc2NhbGUudXBkYXRlKHtcbiAgICAgICAgICAgICAgICB4OiBwcm9wcy5zY2FsZS52YWx1ZS54ICogcHJvcHMuZmVhdHVyZXMubW91c2VXaGVlbFpvb20uem9vbUluY3JlbWVudHMsXG4gICAgICAgICAgICAgICAgeTogcHJvcHMuc2NhbGUudmFsdWUueSAqIHByb3BzLmZlYXR1cmVzLm1vdXNlV2hlZWxab29tLnpvb21JbmNyZW1lbnRzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHByb3BzLnRyYW5zbGF0ZS51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHg6IHByb3BzLnRyYW5zbGF0ZS52YWx1ZS54IC0gKGUub2Zmc2V0WCAqIChwcm9wcy5mZWF0dXJlcy5tb3VzZVdoZWVsWm9vbS56b29tSW5jcmVtZW50cyAtIDEpKSAvIHByb3BzLnNjYWxlLnZhbHVlLngsXG4gICAgICAgICAgICAgICAgeTogcHJvcHMudHJhbnNsYXRlLnZhbHVlLnkgLSAoZS5vZmZzZXRZICogKHByb3BzLmZlYXR1cmVzLm1vdXNlV2hlZWxab29tLnpvb21JbmNyZW1lbnRzIC0gMSkpIC8gcHJvcHMuc2NhbGUudmFsdWUueVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZlYXR1cmVzLmpzLm1hcCIsImltcG9ydCB7IGRlcmVmIH0gZnJvbSAnLi91dGlsaXRpZXMuanMnO1xuY29uc3QgcmVndWxhclBvbHlnb25LZXlzID0gWyd4JywgJ3knLCAnb3BhY2l0eScsICdzdHJva2VDb2xvcicsICdmaWxsQ29sb3InLCAncGF0aCcsICdzaWRlcycsICdyYWRpdXMnLCAnb3JpZ2luWCcsICdvcmlnaW5ZJ107XG5jb25zdCBwYXRoS2V5cyA9IFsneCcsICd5JywgJ29wYWNpdHknLCAnc3Ryb2tlQ29sb3InLCAnZmlsbENvbG9yJywgJ3BhdGgnLCAnbGluZVdpZHRoJywgJ29yaWdpblgnLCAnb3JpZ2luWSddO1xuY29uc3QgZWxpcHNlS2V5cyA9IFsneCcsICd5JywgJ29wYWNpdHknLCAnc3Ryb2tlQ29sb3InLCAnZmlsbENvbG9yJywgJ3JvdGF0aW9uJywgJ3J4JywgJ3J5JywgJ3N0YXJ0QW5nbGUnLCAnZW5kQW5nbGUnLCAnb3JpZ2luWCcsICdvcmlnaW5ZJ107XG5jb25zdCBsaW5lS2V5cyA9IFsneCcsICd5JywgJ29wYWNpdHknLCAnc3Ryb2tlQ29sb3InLCAnZmlsbENvbG9yJywgJ3R4JywgJ3R5JywgJ2xpbmVXaWR0aCcsICdvcmlnaW5YJywgJ29yaWdpblknXTtcbmNvbnN0IHF1YWRyYXRpY0N1cnZlS2V5cyA9IFsneCcsICd5JywgJ29wYWNpdHknLCAnc3Ryb2tlQ29sb3InLCAnZmlsbENvbG9yJywgJ3R4JywgJ3R5JywgJ2N4JywgJ2N5JywgJ2xpbmVXaWR0aCcsICdvcmlnaW5YJywgJ29yaWdpblknXTtcbmNvbnN0IGJlemllckN1cnZlS2V5cyA9IFsneCcsICd5JywgJ29wYWNpdHknLCAnc3Ryb2tlQ29sb3InLCAnZmlsbENvbG9yJywgJ3R4JywgJ3R5JywgJ2N4JywgJ2N5JywgJ2MyeCcsICdjMnknLCAnbGluZVdpZHRoJywgJ29yaWdpblgnLCAnb3JpZ2luWSddO1xuY29uc3QgdGV4dEtleXMgPSBbXG4gICAgJ3gnLFxuICAgICd5JyxcbiAgICAncmVhbFdpZHRoJyxcbiAgICAnd2lkdGgnLFxuICAgICdmb250JyxcbiAgICAnZm9udFNpemUnLFxuICAgICdvcGFjaXR5JyxcbiAgICAnc3Ryb2tlQ29sb3InLFxuICAgICdmaWxsQ29sb3InLFxuICAgICd0ZXh0JyxcbiAgICAnZm9udFdlaWdodCcsXG4gICAgJ3dyYXBXaWR0aCcsXG4gICAgJ2xpbmVIZWlnaHQnLFxuICAgICd0ZXh0QmFzZWxpbmUnLFxuICAgICdvcmlnaW5YJyxcbiAgICAnb3JpZ2luWSdcbl07XG5jb25zdCByZWN0YW5nbGVLZXlzID0gWyd4JywgJ3knLCAnd2lkdGgnLCAnaGVpZ2h0JywgJ29wYWNpdHknLCAnc3Ryb2tlQ29sb3InLCAnZmlsbENvbG9yJywgJ29yaWdpblgnLCAnb3JpZ2luWSddO1xuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckVsaXBzZShjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSkge1xuICAgIGNvbnN0IHJlbmRlcmVkU3RhdGUgPSByZXNvbHZlVmFsdWVzKGNoaWxkLCBlbGlwc2VLZXlzLCBvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICBjb25zdCB7IHgsIHksIGlkbGUsIGZpbGxDb2xvciwgc3Ryb2tlQ29sb3IsIG9wYWNpdHksIHJ4LCByeSwgcm90YXRpb24sIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlIH0gPSByZW5kZXJlZFN0YXRlO1xuICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUgPSByZW5kZXJlZFN0YXRlO1xuICAgIGNoaWxkLm9uUHJlRHJhdz8uKGNoaWxkLnJlbmRlcmVkU3RhdGUpO1xuICAgIGNvbnRleHQuZ2xvYmFsQWxwaGEgPSBvcGFjaXR5O1xuICAgIGNvbnN0IHBhdGgyZCA9IG5ldyBQYXRoMkQoKTtcbiAgICBpZiAoKGZpbGxDb2xvciB8fCBzdHJva2VDb2xvcikgJiYgcnggPiAwLjAxICYmIHJ5ID4gMC4wMSAmJiAoc3RhcnRBbmdsZSA/PyAwICE9PSBlbmRBbmdsZSkpIHtcbiAgICAgICAgcGF0aDJkLmVsbGlwc2UoeCwgeSwgcngsIHJ5LCByb3RhdGlvbiA/PyAwLCBzdGFydEFuZ2xlID8/IDAsIGVuZEFuZ2xlID8/IE1hdGguUEkgKiAyKTtcbiAgICAgICAgY2hpbGQucmVuZGVyZWRTdGF0ZS5wYXRoID0gcGF0aDJkO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY2hpbGQucmVuZGVyZWRTdGF0ZS5wYXRoID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBkcmF3Q2FudmFzUGF0aChjaGlsZCwgY29udGV4dCwgcGF0aDJkLCBmaWxsQ29sb3IsIHN0cm9rZUNvbG9yKTtcbiAgICByZXR1cm4gaWRsZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJMaW5lKGNvbnRleHQsIGNoaWxkLCBvZmZzZXRYLCBvZmZzZXRZKSB7XG4gICAgY29uc3QgcmVuZGVyZWRTdGF0ZSA9IHJlc29sdmVWYWx1ZXMoY2hpbGQsIGxpbmVLZXlzLCBvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICBjb25zdCB7IHgsIHksIGlkbGUsIGZpbGxDb2xvciwgc3Ryb2tlQ29sb3IsIG9wYWNpdHksIHR4LCB0eSwgbGluZVdpZHRoIH0gPSByZW5kZXJlZFN0YXRlO1xuICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUgPSByZW5kZXJlZFN0YXRlO1xuICAgIGNoaWxkLm9uUHJlRHJhdz8uKGNoaWxkLnJlbmRlcmVkU3RhdGUpO1xuICAgIGNvbnN0IHBhdGgyZCA9IG5ldyBQYXRoMkQoKTtcbiAgICBjb250ZXh0Lmdsb2JhbEFscGhhID0gb3BhY2l0eTtcbiAgICBpZiAoZmlsbENvbG9yIHx8IHN0cm9rZUNvbG9yKSB7XG4gICAgICAgIHBhdGgyZC5tb3ZlVG8oeCwgeSk7XG4gICAgICAgIHBhdGgyZC5saW5lVG8odHgsIHR5KTtcbiAgICAgICAgY29udGV4dC5saW5lV2lkdGggPSBsaW5lV2lkdGg7XG4gICAgICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUucGF0aCA9IHBhdGgyZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUucGF0aCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgZHJhd0NhbnZhc1BhdGgoY2hpbGQsIGNvbnRleHQsIHBhdGgyZCwgZmlsbENvbG9yLCBzdHJva2VDb2xvcik7XG4gICAgcmV0dXJuIGlkbGU7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyUXVhZHJhdGljQ3VydmUoY29udGV4dCwgY2hpbGQsIG9mZnNldFgsIG9mZnNldFkpIHtcbiAgICBjb25zdCByZW5kZXJlZFN0YXRlID0gcmVzb2x2ZVZhbHVlcyhjaGlsZCwgcXVhZHJhdGljQ3VydmVLZXlzLCBvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICBjb25zdCB7IHgsIHksIGN4LCBjeSwgaWRsZSwgZmlsbENvbG9yLCBzdHJva2VDb2xvciwgb3BhY2l0eSwgdHgsIHR5LCBsaW5lV2lkdGggfSA9IHJlbmRlcmVkU3RhdGU7XG4gICAgY2hpbGQucmVuZGVyZWRTdGF0ZSA9IHJlbmRlcmVkU3RhdGU7XG4gICAgY2hpbGQub25QcmVEcmF3Py4oY2hpbGQucmVuZGVyZWRTdGF0ZSk7XG4gICAgY29udGV4dC5nbG9iYWxBbHBoYSA9IG9wYWNpdHk7XG4gICAgY29uc3QgcGF0aDJkID0gbmV3IFBhdGgyRCgpO1xuICAgIGlmIChmaWxsQ29sb3IgfHwgc3Ryb2tlQ29sb3IpIHtcbiAgICAgICAgcGF0aDJkLm1vdmVUbyh4LCB5KTtcbiAgICAgICAgcGF0aDJkLnF1YWRyYXRpY0N1cnZlVG8oY3gsIGN5LCB0eCwgdHkpO1xuICAgICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IGxpbmVXaWR0aDtcbiAgICAgICAgY2hpbGQucmVuZGVyZWRTdGF0ZS5wYXRoID0gcGF0aDJkO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY2hpbGQucmVuZGVyZWRTdGF0ZS5wYXRoID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBkcmF3Q2FudmFzUGF0aChjaGlsZCwgY29udGV4dCwgcGF0aDJkLCBmaWxsQ29sb3IsIHN0cm9rZUNvbG9yKTtcbiAgICByZXR1cm4gaWRsZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJCZXppZXJDdXJ2ZShjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSkge1xuICAgIGNvbnN0IHJlbmRlcmVkU3RhdGUgPSByZXNvbHZlVmFsdWVzKGNoaWxkLCBiZXppZXJDdXJ2ZUtleXMsIG9mZnNldFgsIG9mZnNldFkpO1xuICAgIGNvbnN0IHsgeCwgeSwgY3gsIGN5LCBjMngsIGMyeSwgaWRsZSwgZmlsbENvbG9yLCBzdHJva2VDb2xvciwgb3BhY2l0eSwgdHgsIHR5LCBsaW5lV2lkdGggfSA9IHJlbmRlcmVkU3RhdGU7XG4gICAgY2hpbGQucmVuZGVyZWRTdGF0ZSA9IHJlbmRlcmVkU3RhdGU7XG4gICAgY2hpbGQub25QcmVEcmF3Py4oY2hpbGQucmVuZGVyZWRTdGF0ZSk7XG4gICAgY29udGV4dC5nbG9iYWxBbHBoYSA9IG9wYWNpdHk7XG4gICAgY29uc3QgcGF0aDJkID0gbmV3IFBhdGgyRCgpO1xuICAgIGlmIChmaWxsQ29sb3IgfHwgc3Ryb2tlQ29sb3IpIHtcbiAgICAgICAgcGF0aDJkLm1vdmVUbyh4LCB5KTtcbiAgICAgICAgcGF0aDJkLmJlemllckN1cnZlVG8oY3gsIGN5LCBjMngsIGMyeSwgdHgsIHR5KTtcbiAgICAgICAgY29udGV4dC5saW5lV2lkdGggPSBsaW5lV2lkdGg7XG4gICAgICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUucGF0aCA9IHBhdGgyZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUucGF0aCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgZHJhd0NhbnZhc1BhdGgoY2hpbGQsIGNvbnRleHQsIHBhdGgyZCwgZmlsbENvbG9yLCBzdHJva2VDb2xvcik7XG4gICAgcmV0dXJuIGlkbGU7XG59XG5mdW5jdGlvbiBkcmF3Q2FudmFzUGF0aChjaGlsZCwgY29udGV4dCwgcGF0aDJkLCBmaWxsQ29sb3IsIHN0cm9rZUNvbG9yKSB7XG4gICAgaWYgKGNoaWxkLmZpbGxDb2xvcikge1xuICAgICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGZpbGxDb2xvcjtcbiAgICAgICAgY29udGV4dC5maWxsKHBhdGgyZCk7XG4gICAgfVxuICAgIGlmIChjaGlsZC5zdHJva2VDb2xvcikge1xuICAgICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gc3Ryb2tlQ29sb3I7XG4gICAgICAgIGNvbnRleHQuc3Ryb2tlKHBhdGgyZCk7XG4gICAgfVxuICAgIGlmIChjaGlsZC5jbGlwKSB7XG4gICAgICAgIGNvbnRleHQuY2xpcChwYXRoMmQpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJQYXRoKGNvbnRleHQsIGNoaWxkLCBvZmZzZXRYLCBvZmZzZXRZKSB7XG4gICAgY29uc3QgcmVuZGVyZWRTdGF0ZSA9IHJlc29sdmVWYWx1ZXMoY2hpbGQsIHBhdGhLZXlzLCBvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICBjb25zdCB7IHgsIHksIGlkbGUsIGZpbGxDb2xvciwgc3Ryb2tlQ29sb3IsIG9wYWNpdHksIHBhdGgsIGxpbmVXaWR0aCB9ID0gcmVuZGVyZWRTdGF0ZTtcbiAgICBjaGlsZC5yZW5kZXJlZFN0YXRlID0gcmVuZGVyZWRTdGF0ZTtcbiAgICBjaGlsZC5vblByZURyYXc/LihjaGlsZC5yZW5kZXJlZFN0YXRlKTtcbiAgICBsZXQgcGF0aDJkO1xuICAgIGNvbnRleHQuZ2xvYmFsQWxwaGEgPSBvcGFjaXR5O1xuICAgIGlmIChmaWxsQ29sb3IgfHwgc3Ryb2tlQ29sb3IpIHtcbiAgICAgICAgY29udGV4dC5saW5lV2lkdGggPSBsaW5lV2lkdGg7XG4gICAgICAgIHBhdGgyZCA9IG5ldyBQYXRoMkQocGF0aCk7XG4gICAgICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUucGF0aCA9IHBhdGgyZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUucGF0aCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaWYgKGNoaWxkLmZpbGxDb2xvcikge1xuICAgICAgICBjb250ZXh0LnRyYW5zbGF0ZSh4LCB5KTtcbiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBmaWxsQ29sb3I7XG4gICAgICAgIGNvbnRleHQuZmlsbChwYXRoMmQpO1xuICAgICAgICBjb250ZXh0LnRyYW5zbGF0ZSgteCwgLXkpO1xuICAgIH1cbiAgICBpZiAoY2hpbGQuc3Ryb2tlQ29sb3IpIHtcbiAgICAgICAgY29udGV4dC50cmFuc2xhdGUoeCwgeSk7XG4gICAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBzdHJva2VDb2xvcjtcbiAgICAgICAgY29udGV4dC5zdHJva2UocGF0aDJkKTtcbiAgICAgICAgY29udGV4dC50cmFuc2xhdGUoLXgsIC15KTtcbiAgICB9XG4gICAgaWYgKGNoaWxkLmNsaXApIHtcbiAgICAgICAgY29udGV4dC50cmFuc2xhdGUoeCwgeSk7XG4gICAgICAgIGNvbnRleHQuY2xpcChwYXRoMmQpO1xuICAgICAgICBjb250ZXh0LnRyYW5zbGF0ZSgteCwgLXkpO1xuICAgIH1cbiAgICByZXR1cm4gaWRsZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJSZWd1bGFyUG9seWdvbihjb250ZXh0LCBjaGlsZCwgb2Zmc2V0WCwgb2Zmc2V0WSkge1xuICAgIGNvbnN0IHJlbmRlcmVkU3RhdGUgPSByZXNvbHZlVmFsdWVzKGNoaWxkLCByZWd1bGFyUG9seWdvbktleXMsIG9mZnNldFgsIG9mZnNldFkpO1xuICAgIGNvbnN0IHsgeCwgeSwgaWRsZSwgZmlsbENvbG9yLCBzdHJva2VDb2xvciwgb3BhY2l0eSwgc2lkZXMsIHJhZGl1cyB9ID0gcmVuZGVyZWRTdGF0ZTtcbiAgICBjaGlsZC5yZW5kZXJlZFN0YXRlID0gcmVuZGVyZWRTdGF0ZTtcbiAgICBjaGlsZC5vblByZURyYXc/LihjaGlsZC5yZW5kZXJlZFN0YXRlKTtcbiAgICBjb250ZXh0Lmdsb2JhbEFscGhhID0gb3BhY2l0eTtcbiAgICBpZiAocmVuZGVyZWRTdGF0ZS5zaWRlcyA8IDMpIHtcbiAgICAgICAgcmV0dXJuIGlkbGU7XG4gICAgfVxuICAgIGNvbnN0IHBhdGgyZCA9IG5ldyBQYXRoMkQoKTtcbiAgICBpZiAoZmlsbENvbG9yIHx8IHN0cm9rZUNvbG9yKSB7XG4gICAgICAgIGxldCBhbmdsZSA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2lkZXM7IGkrKykge1xuICAgICAgICAgICAgYW5nbGUgKz0gTWF0aC5QSSAvIChzaWRlcyAvIDIpO1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0WCA9IHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKTtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldFkgPSByYWRpdXMgKiBNYXRoLnNpbihhbmdsZSk7XG4gICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHBhdGgyZC5tb3ZlVG8odGFyZ2V0WCArIHJhZGl1cyArIHgsIHRhcmdldFkgKyByYWRpdXMgKyB5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhdGgyZC5saW5lVG8odGFyZ2V0WCArIHJhZGl1cyArIHgsIHRhcmdldFkgKyByYWRpdXMgKyB5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjaGlsZC5yZW5kZXJlZFN0YXRlLnBhdGggPSBwYXRoMmQ7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjaGlsZC5yZW5kZXJlZFN0YXRlLnBhdGggPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGRyYXdDYW52YXNQYXRoKGNoaWxkLCBjb250ZXh0LCBwYXRoMmQsIGZpbGxDb2xvciwgc3Ryb2tlQ29sb3IpO1xuICAgIHJldHVybiBpZGxlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlclRleHQoY29udGV4dCwgY2hpbGQsIG9mZnNldFgsIG9mZnNldFkpIHtcbiAgICBjb25zdCByZW5kZXJlZFN0YXRlID0gcmVzb2x2ZVZhbHVlcyhjaGlsZCwgdGV4dEtleXMsIG9mZnNldFgsIG9mZnNldFksIGZhbHNlKTtcbiAgICBsZXQgeyB4LCB5LCBpZGxlLCBmb250U2l6ZSA9IDE2LCB0ZXh0QmFzZWxpbmUsIGZvbnQsIGZpbGxDb2xvciwgc3Ryb2tlQ29sb3IsIG9wYWNpdHksIHRleHQsIGZvbnRXZWlnaHQsIHdpZHRoLCB3cmFwV2lkdGgsIGxpbmVIZWlnaHQsIG9yaWdpblggfSA9IHJlbmRlcmVkU3RhdGU7XG4gICAgaWYgKGNoaWxkLnJlbmRlcmVkU3RhdGU/LndpZHRoICYmICFyZW5kZXJlZFN0YXRlLndpZHRoKSB7XG4gICAgICAgIHJlbmRlcmVkU3RhdGUud2lkdGggPSBjaGlsZC5yZW5kZXJlZFN0YXRlLndpZHRoO1xuICAgIH1cbiAgICBpZiAoY2hpbGQucmVuZGVyZWRTdGF0ZT8ucmVhbFdpZHRoICYmICFyZW5kZXJlZFN0YXRlLnJlYWxXaWR0aCkge1xuICAgICAgICByZW5kZXJlZFN0YXRlLnJlYWxXaWR0aCA9IGNoaWxkLnJlbmRlcmVkU3RhdGUucmVhbFdpZHRoO1xuICAgIH1cbiAgICByZW5kZXJlZFN0YXRlLmxpbmVzID0gY2hpbGQucmVuZGVyZWRTdGF0ZT8ubGluZXM7XG4gICAgY2hpbGQucmVuZGVyZWRTdGF0ZSA9IHJlbmRlcmVkU3RhdGU7XG4gICAgY2hpbGQucmVuZGVyZWRTdGF0ZS5saW5lcyA9IGNoaWxkLnJlbmRlcmVkU3RhdGUubGluZXMgPz8gW107XG4gICAgbGV0IGxpbmVzID0gY2hpbGQucmVuZGVyZWRTdGF0ZS5saW5lcztcbiAgICBpZiAodGV4dEJhc2VsaW5lKSB7XG4gICAgICAgIGNvbnRleHQudGV4dEJhc2VsaW5lID0gdGV4dEJhc2VsaW5lO1xuICAgIH1cbiAgICBjb250ZXh0LmZvbnQgPSBgJHtmb250V2VpZ2h0ID8gZm9udFdlaWdodCArICcgJyA6ICcnfSR7Zm9udFNpemV9cHggJHtmb250ID8/ICdBcmlhbCd9YDtcbiAgICByZW5kZXJlZFN0YXRlLmhlaWdodCA9IGZvbnRTaXplO1xuICAgIGlmIChsaW5lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaWYgKHdyYXBXaWR0aCkge1xuICAgICAgICAgICAgY2hpbGQucmVuZGVyZWRTdGF0ZS5yZWFsV2lkdGggPSAwO1xuICAgICAgICAgICAgY29uc3QgcGllY2VzID0gdGV4dC5zcGxpdCgnICcpO1xuICAgICAgICAgICAgbGV0IGxpbmUgPSBwaWVjZXMuc2hpZnQoKTtcbiAgICAgICAgICAgIHdoaWxlIChwaWVjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVhc3VyZWRXaWR0aCA9IGNvbnRleHQubWVhc3VyZVRleHQobGluZSArICcgJyArIHBpZWNlc1swXSk7XG4gICAgICAgICAgICAgICAgaWYgKG1lYXN1cmVkV2lkdGgud2lkdGggPiBjaGlsZC5yZW5kZXJlZFN0YXRlLnJlYWxXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZC5yZW5kZXJlZFN0YXRlLnJlYWxXaWR0aCA9IG1lYXN1cmVkV2lkdGgud2lkdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZWFzdXJlZFdpZHRoIDw9IHdyYXBXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcgJyArIHBpZWNlcy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGluZXMucHVzaChsaW5lKTtcbiAgICAgICAgICAgICAgICAgICAgbGluZSA9IHBpZWNlcy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpbmVzLnB1c2gobGluZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXdpZHRoKSB7XG4gICAgICAgICAgICAgICAgY2hpbGQucmVuZGVyZWRTdGF0ZS5yZWFsV2lkdGggPSBjaGlsZC5yZW5kZXJlZFN0YXRlLndpZHRoID0gY29udGV4dC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUucmVhbFdpZHRoID0gY29udGV4dC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpbmVzLnB1c2godGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2hpbGQub25QcmVEcmF3Py4oY2hpbGQucmVuZGVyZWRTdGF0ZSk7XG4gICAgY29udGV4dC5nbG9iYWxBbHBoYSA9IG9wYWNpdHk7XG4gICAgaWYgKG9yaWdpblgpIHtcbiAgICAgICAgeCAtPSBNYXRoLm1pbihjaGlsZC5yZW5kZXJlZFN0YXRlLnJlYWxXaWR0aCwgY2hpbGQucmVuZGVyZWRTdGF0ZS53aWR0aCkgKiBvcmlnaW5YO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChmaWxsQ29sb3IpIHtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gZmlsbENvbG9yO1xuICAgICAgICAgICAgY29udGV4dC5maWxsVGV4dChsaW5lc1tpXSwgeCwgeSArIChsaW5lSGVpZ2h0ID8/IDE2KSAqIGksIHdpZHRoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3Ryb2tlQ29sb3IpIHtcbiAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBzdHJva2VDb2xvcjtcbiAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlVGV4dChsaW5lc1tpXSwgeCwgeSArIChsaW5lSGVpZ2h0ID8/IDE2KSAqIGksIHdpZHRoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaWRsZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJSZWN0YW5nbGUoY29udGV4dCwgY2hpbGQsIG9mZnNldFgsIG9mZnNldFkpIHtcbiAgICBjb25zdCByZW5kZXJlZFN0YXRlID0gcmVzb2x2ZVZhbHVlcyhjaGlsZCwgcmVjdGFuZ2xlS2V5cywgb2Zmc2V0WCwgb2Zmc2V0WSk7XG4gICAgY29uc3QgeyB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBpZGxlLCBmaWxsQ29sb3IsIHN0cm9rZUNvbG9yLCBvcGFjaXR5IH0gPSByZW5kZXJlZFN0YXRlO1xuICAgIGNoaWxkLnJlbmRlcmVkU3RhdGUgPSByZW5kZXJlZFN0YXRlO1xuICAgIGNoaWxkLm9uUHJlRHJhdz8uKGNoaWxkLnJlbmRlcmVkU3RhdGUpO1xuICAgIGlmIChvcGFjaXR5IDw9IDAgJiYgIWNoaWxkLmNsaXApIHtcbiAgICAgICAgcmV0dXJuIGlkbGU7XG4gICAgfVxuICAgIGNvbnRleHQuZ2xvYmFsQWxwaGEgPSBvcGFjaXR5O1xuICAgIGlmIChmaWxsQ29sb3IpIHtcbiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBmaWxsQ29sb3I7XG4gICAgICAgIGNvbnRleHQuZmlsbFJlY3QoeCwgeSwgd2lkdGgsIGhlaWdodCk7XG4gICAgfVxuICAgIGlmIChzdHJva2VDb2xvcikge1xuICAgICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gc3Ryb2tlQ29sb3I7XG4gICAgICAgIGNvbnRleHQuc3Ryb2tlUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9XG4gICAgaWYgKGNoaWxkLmNsaXApIHtcbiAgICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgICAgY29udGV4dC5yZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBjb250ZXh0LmNsaXAoKTtcbiAgICB9XG4gICAgcmV0dXJuIGlkbGU7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZVZhbHVlcyhub2RlLCBwcm9wcywgb2Zmc2V0WCwgb2Zmc2V0WSwgYXBwbHlPcmlnaW4gPSB0cnVlKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICBpZGxlOiB0cnVlLFxuICAgICAgICB4OiAwLFxuICAgICAgICB5OiAwXG4gICAgfTtcbiAgICBsZXQgaWRsZSA9IHRydWU7XG4gICAgZm9yIChjb25zdCBrZXkgb2YgcHJvcHMpIHtcbiAgICAgICAgY29uc3QgYmFzZVZhbHVlID0gZGVyZWYobm9kZVtrZXldKTtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSBub2RlLmFuaW1hdGlvblN0YXRlcz8uZmluZCgobikgPT4gbltrZXldICE9IHVuZGVmaW5lZCk7XG4gICAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICAgICAgbGV0IHByb2dyZXNzO1xuICAgICAgICAgICAgaWYgKCFzdGF0ZS50cmFuc2l0aW9uVGltZSkge1xuICAgICAgICAgICAgICAgIHByb2dyZXNzID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb2dyZXNzID0gTWF0aC5taW4oMSwgKERhdGUubm93KCkgLSBub2RlLmFuaW1hdGlvblRpbWUpIC8gZGVyZWYoc3RhdGUudHJhbnNpdGlvblRpbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHRhcmdldFZhbHVlID0gc3RhdGVba2V5XTtcbiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gYmFzZVZhbHVlICsgKHRhcmdldFZhbHVlIC0gYmFzZVZhbHVlKSAqIHByb2dyZXNzO1xuICAgICAgICAgICAgaWYgKHByb2dyZXNzIDwgMSkge1xuICAgICAgICAgICAgICAgIGlkbGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gYmFzZVZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlc3VsdC54ICs9IG9mZnNldFg7XG4gICAgcmVzdWx0LnkgKz0gb2Zmc2V0WTtcbiAgICBpZiAoYXBwbHlPcmlnaW4pIHtcbiAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgIGlmIChyZXN1bHQub3JpZ2luWCAmJiByZXN1bHQud2lkdGgpIHtcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgcmVzdWx0LnggLT0gcmVzdWx0LndpZHRoICogcmVzdWx0Lm9yaWdpblg7XG4gICAgICAgIH1cbiAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgIGlmIChyZXN1bHQub3JpZ2luWSAmJiByZXN1bHQuaGVpZ2h0KSB7XG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgIHJlc3VsdC55IC09IHJlc3VsdC5oZWlnaHQgKiByZXN1bHQub3JpZ2luWTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoJ3R4JyBpbiByZXN1bHQpIHtcbiAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgIHJlc3VsdC50eCArPSBvZmZzZXRYO1xuICAgIH1cbiAgICBpZiAoJ3R5JyBpbiByZXN1bHQpIHtcbiAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgIHJlc3VsdC50eSArPSBvZmZzZXRZO1xuICAgIH1cbiAgICBpZiAoJ2N4JyBpbiByZXN1bHQpIHtcbiAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgIHJlc3VsdC5jeCArPSBvZmZzZXRYO1xuICAgIH1cbiAgICBpZiAoJ2N5JyBpbiByZXN1bHQpIHtcbiAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgIHJlc3VsdC5jeSArPSBvZmZzZXRZO1xuICAgIH1cbiAgICBpZiAoJ2MyeCcgaW4gcmVzdWx0KSB7XG4gICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICByZXN1bHQuYzJ4ICs9IG9mZnNldFg7XG4gICAgfVxuICAgIGlmICgnYzJ5JyBpbiByZXN1bHQpIHtcbiAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgIHJlc3VsdC5jMnkgKz0gb2Zmc2V0WTtcbiAgICB9XG4gICAgcmVzdWx0LmlkbGUgPSBpZGxlO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yZW5kZXJpbmcuanMubWFwIiwiaW1wb3J0IHsgRGF0YVNvdXJjZSB9IGZyb20gJ2F1cnVtanMnO1xuZXhwb3J0IGZ1bmN0aW9uIGRlcmVmKHNvdXJjZSkge1xuICAgIGlmIChzb3VyY2UgaW5zdGFuY2VvZiBEYXRhU291cmNlKSB7XG4gICAgICAgIHJldHVybiBzb3VyY2UudmFsdWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gc291cmNlO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXV0aWxpdGllcy5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=