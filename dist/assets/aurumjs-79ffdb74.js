var C=Object.defineProperty;var k=(i,e,t)=>e in i?C(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(k(i,typeof e!="symbol"?e+"":e,t),t);import{D as p,c as N,a as b,A as g,b as E,d as w,e as c,C as m,E as v,h as M,f as x,g as T}from"./index-71023b0b.js";import{i as B,k as H,r as K,av as j,aw as U,t as $,y as q,v as z,H as J,F as G,L as Q,J as X,M as Y,Q as Z,aC as _,R as ee,z as te,s as se,K as ae,S as ie,B as re,G as oe,aR as ne,aD as de,u as le,w as ce,x as ue,U as he,aV as fe,aH as me,aK as pe,l as ye,m as be,aO as we,aM as ve,aL as Ae,aN as De,j as Se,ay as Ce,aA as ke,ax as Ne,az as ge,aB as Ee,n as Me,au as xe,a9 as Te,ab as Oe,aa as Re,ak as Fe,N as Le,a5 as Ve,a6 as Ie,af as We,ae as Pe,X as Be,$ as He,Z as Ke,_ as je,V as Ue,O as $e,ao as qe,ar as ze,ai as Je,as as Ge,T as Qe,W as Xe,a2 as Ye,ag as Ze,a1 as _e,a0 as et,al as tt,am as st,at,an as it,ac as rt,a7 as ot,a4 as nt,a3 as dt,ad as lt,aq as ct,aj as ut,ah as ht,ap as ft,a8 as mt,Y as pt,o as yt,p as bt,q as wt,aE as vt,aS as At,I as Dt,P as St,aX as Ct,aJ as kt,aQ as Nt,aT as gt,aW as Et,aI as Mt,aP as xt,aF as Tt,aU as Ot,aG as Rt}from"./index-71023b0b.js";function V(i,e){return customElements.define(i.name,class extends(i.baseClass??HTMLElement){constructor(){super();l(this,"api");l(this,"session");l(this,"props");i.observedAttributes===void 0&&(i.observedAttributes=[]),this.props={};for(const s of i.observedAttributes)this.props[s]=new p}static get observedAttributes(){return i.observedAttributes}attributeChangedCallback(s,r,o){r!==o&&this.props[s].update(o)}connectedCallback(){const s=document.createDocumentFragment();this.session=N(),this.api=b(this.session);const r=e(this.props,this.api);for(const o of this.session.attachCalls)o();g.attach(r,s),this.attachShadow({mode:i.shadowRootMode??"open",delegatesFocus:i.shadowRootDelegatesFocus}).appendChild(s)}disconnectedCallback(){this.session.sessionToken.cancel()}}),E(i.name,i.observedAttributes,void 0,(t,s)=>{for(const r in s)r in t.props||(t.props[r]=s[r])})}async function f(i,e={}){if(i==null)return"";if(Array.isArray(i)){const t=[];for(const s of i)t.push(await f(s));return t.join("")}if(i instanceof Promise)return f(await i);if(["number","string","bigint","boolean"].includes(typeof i))return i.toString();if(i instanceof p)return f(i.value);if(i instanceof w)return f(i.value);if(i instanceof c)return f(i.getData());{const t=i;if(!t.isIntrinsic)return f(t.factory(t.props,t.children,b({attachCalls:[],sessionToken:new m,tokens:[]})));if(e.tagBlacklist&&e.tagBlacklist.includes(t.name)||e.tagWhitelist&&!e.tagWhitelist.includes(t.name))return"";let s=" ",r="";t.children&&(r=await f(t.children));for(const o in t.props)e.attributeBlacklist&&e.attributeBlacklist.includes(o)||e.attributeWhitelist&&!e.attributeWhitelist.includes(o)||t.props[o]!=null&&(s+=`${o}="${t.props[o].toString()}" `);return`<${t.name}${s.trimEnd()}>${r}</${t.name}>`}}class O{constructor(e){l(this,"roots");l(this,"onChange");l(this,"sessionToken");this.roots=e.vdom,this.sessionToken=e.sessionToken,this.onChange=new v}*[Symbol.iterator](){for(const e of this.roots)yield*this.iterateVDOM(e,void 0)}*iterateVDOM(e,t){if(e.type==="virtual"){for(const s of e.children)yield*this.iterateVDOM(s,t);return}if(yield{node:e,parent:t},e.children)for(const s of e.children)yield*this.iterateVDOM(s,e)}}function I(i,e){const t=new O({vdom:[],sessionToken:e});let s=new m;e.addCancelable(()=>{s&&s.cancel()});const r={type:"virtual",children:[]};return u(i,s,t.onChange,r),t.roots=r.children,t}function u(i,e,t,s){var r,o;if(i==null)return{tokens:[]};if(Array.isArray(i)){const a={insertAt:-1,insertCount:0,tokens:[]};for(const n of i){const d=u(n,e,t,s);a.tokens.push(...d.tokens)}return a}if(i instanceof Promise){const a={type:"virtual",children:[]};return i.then(n=>{u(n,e,t,a),t.fire({changedNode:s})}),s.children.push(a),{tokens:[]}}if(["number","string","bigint","boolean"].includes(typeof i))return s.children.push({type:"text",text:i.toString()}),{tokens:[]};if(i instanceof p||i instanceof w){const a={type:"virtual",children:[]};i.listen(d=>{a.children=[],n.tokens.forEach(h=>h.cancel()),n=u(d,e,t,a),t.fire({changedNode:s})},e),s.children.push(a);let n=u(i.value,e,t,a);return n}else if(i instanceof c){const a={type:"virtual",children:[]};i.listen(()=>{a.children=[],n.tokens.forEach(d=>d.cancel()),n=u(i.getData(),e,t,a),t.fire({changedNode:s})},e),s.children.push(a);let n=u(i.getData(),e,t,a);return n}else{const a=i;if(!a.isIntrinsic){const d=new m,h={attachCalls:[],sessionToken:d,tokens:[]},D=b(h);e.addCancelable(()=>{d.cancel()}),d.addCancelable(()=>{for(const y of h.tokens)y.cancel()});const S=u(a.factory(a.props,a.children,D),d,t,s);for(const y of h.attachCalls)y();return{tokens:[...S.tokens,d]}}const n={type:"element",tag:a.name,children:[]};return n.attributes=a.props?R(n,a.props,e,t):void 0,s.children.push(n),(r=a.props)!=null&&r.onAttach&&a.props.onAttach(),(o=a.props)!=null&&o.onDetach&&e.addCancelable(()=>{a.props.onDetach()}),a.children&&u(a.children,e,t,n),{tokens:[]}}}function R(i,e,t,s){const r={};for(const o in e){let a;e.hasOwnProperty(o)&&(o==="style"?a=M(e[o],t):o==="class"?a=x(e[o],t):a=e[o],a instanceof p?(a.listen(()=>{r[o]=a.value,s.fire({changedNode:i})},t),r[o]=a.value):a instanceof w?(a.listen(()=>{r[o]=a.value,s.fire({changedNode:i})},t),r[o]=a.value):a instanceof c?(a.listen(()=>{r[o]=a.getData().join(";"),s.fire({changedNode:i})},t),r[o]=a.getData().join(";")):r[o]=a)}return r}class A{constructor(e,t){l(this,"childrenKey");l(this,"roots");l(this,"updateEvent");l(this,"watchCount",0);l(this,"watchToken");this.childrenKey=e,this.roots=c.toArrayDataSource(t),this.updateEvent=new v}watch(e){if(this.watchCount++,e.addCancelable(()=>{this.watchCount--,this.watchCount===0&&(this.watchToken.cancel(),this.watchToken=void 0)}),!this.watchToken){this.watchToken=new m;const t=new Map;this.roots instanceof c&&this.roots.listen(s=>{this.watchHandleChange(s,void 0,t)},this.watchToken);for(const s of this.roots)for(const{node:r}of this.iterateLevelWithMetaData(s,this.roots.length.value))r[this.childrenKey]instanceof c&&(t.set(r,new m),this.watchToken.chain(t.get(r)),r[this.childrenKey].listenAndRepeat(o=>{this.watchHandleChange(o,r,t)},t.get(r)))}}watchHandleChange(e,t,s){var r;switch(e.operation){case"add":let o=0;for(const n of e.items)this.updateEvent.fire({changedNode:n,index:e.index+o++,parentNode:t,operation:"added"}),n[this.childrenKey]instanceof c&&(s.set(n,new m),this.watchToken.chain(s.get(n)),n[this.childrenKey].listenAndRepeat(d=>{this.watchHandleChange(d,n,s)},s.get(n)));break;case"remove":let a=0;for(const n of e.items)(r=s.get(n))==null||r.cancel(),this.updateEvent.fire({changedNode:n,index:e.index+a++,parentNode:t,operation:"deleted"});break;case"merge":throw new Error("Not implemented");case"replace":this.updateEvent.fire({changedNode:e.target,index:e.index,parentNode:t,operation:"deleted"}),this.updateEvent.fire({changedNode:e.items[0],index:e.index,parentNode:t,operation:"added"});break}}listen(e,t){return this.watch(t),this.updateEvent.subscribe(e,t).cancel}listenAndRepeat(e,t){for(const{parent:s,node:r,index:o}of this.iterateLevelWithMetaData(this.roots,0))e({changedNode:r,index:o,parentNode:s,operation:"added"});return this.listen(e,t)}adaptNodeList(e,t,s=new c){const r=new Map;return e.listenAndRepeat(o=>{switch(o.operation){case"add":for(const a of o.items)this.addItem(r,t,a,s);break;case"remove":for(const a of o.items)this.removeItem(s,r,a);break;case"merge":throw new Error("Not implemented");case"replace":this.removeItem(s,r,o.target),this.addItem(r,t,o.items[0],s);break}},t),s}adaptNodeTree(e,t,s,r,o){t=c.toArrayDataSource(t);const a=t.map(s);return e&&(e[r]=a),t.listenAndRepeat(n=>{switch(n.operation){case"add":let d=n.index;for(const h of n.items)this.adaptNodeTree(a.get(d++),h[r],s,r,o);break;case"merge":throw new Error("Not implemented");case"replace":this.adaptNodeTree(a[n.index],n.items[0][r],s,r,o);break}},o),a}map(e,t=this.childrenKey,s){return new A(t,this.adaptNodeTree(void 0,this.roots,e,t,s))}addItem(e,t,s,r){r.push(s),e.set(s,new m),t.chain(e.get(s));const o=c.toArrayDataSource(s[this.childrenKey]);this.adaptNodeList(o,e.get(s),r)}removeItem(e,t,s){t.get(s).cancel(),e.remove(s)}createArrayDataSourceOfNodes(e){return this.adaptNodeList(this.roots,e)}*[Symbol.iterator](){for(const e of this.roots)yield*this.iterateLevel(e)}*iterateWithMetaData(){let e=0;for(const t of this.roots)yield*this.iterateLevelWithMetaData(t,this.roots.length.value,void 0,e)}*iterateLevelWithMetaData(e,t,s,r=0,o=0){yield{node:e,parent:s,index:r,level:o,lastIndex:t};let a=0;for(const n of e[this.childrenKey])yield*this.iterateLevelWithMetaData(n,T(e[this.childrenKey].length),e,a++,o+1)}*iterateLevel(e){yield e;for(const t of e[this.childrenKey])yield*this.iterateLevel(t)}}export{B as ArrayAurumElement,c as ArrayDataSource,g as Aurum,H as AurumElement,K as AurumRouter,m as CancellationToken,j as DataFlow,U as DataFlowBoth,p as DataSource,$ as DefaultRoute,q as DefaultSwitchCase,w as DuplexDataSource,z as ErrorBoundary,v as EventEmitter,J as FilteredArrayView,G as FlattenedArrayView,Q as LimitedArrayView,X as MapDataSource,Y as MappedArrayView,Z as ObjectDataSource,_ as OperationType,ee as RemoteProtocol,te as ReversedArrayView,se as Route,ae as SetDataSource,ie as SingularAurumElement,re as SlicedArrayView,oe as SortedArrayView,ne as StorageStream,de as Stream,le as Suspense,ce as Switch,ue as SwitchCase,A as TreeDataSource,he as UniqueArrayView,fe as UrlStorage,O as VDOM,V as Webcomponent,me as animate,pe as aurumClassName,ye as aurumElementModelIdentitiy,be as aurumToHTML,f as aurumToString,I as aurumToVDOM,we as camelCaseToKebabCase,ve as combineAttribute,Ae as combineClass,De as combineStyle,b as createAPI,Se as createLifeCycle,N as createRenderSession,Ce as ddsDebounce,ke as ddsFilter,Ne as ddsMap,ge as ddsOneWayFlow,Ee as ddsUnique,Me as debugMode,xe as dsAccumulate,Te as dsAwait,Oe as dsAwaitLatest,Re as dsAwaitOrdered,Fe as dsBuffer,Le as dsCriticalSection,Ve as dsCutOff,Ie as dsCutOffDynamic,We as dsDebounce,Pe as dsDelay,Be as dsDiff,He as dsEven,Ke as dsFilter,je as dsFilterAsync,Ue as dsFork,$e as dsForkInline,qe as dsHistory,ze as dsLoadBalance,Je as dsLock,Ge as dsLog,Qe as dsMap,Xe as dsMapAsync,Ye as dsMax,Ze as dsMicroDebounce,_e as dsMin,et as dsOdd,tt as dsPick,st as dsPipe,at as dsPipeAll,it as dsPipeUp,rt as dsReduce,ot as dsSemaphore,nt as dsSkip,dt as dsSkipDynamic,lt as dsStringJoin,ct as dsTap,ut as dsThrottle,ht as dsThrottleFrame,ft as dsThroughputMeter,mt as dsUnique,pt as dsUpdateToken,yt as enableDebugMode,bt as enableDiagnosticMode,wt as getRemoteFunction,T as getValueOf,vt as intervalEmitter,At as localStorageStream,Dt as processTransform,St as processTransformDuplex,Ct as promiseIterator,kt as registerAnimationLoop,Nt as resolveChildren,gt as sessionStorageStream,Et as transformAsyncIterator,Mt as tweenEmitter,xt as unwrapObjectRecursive,Tt as urlHashEmitter,Ot as urlStorageStream,Rt as windowSizeEmitter};
